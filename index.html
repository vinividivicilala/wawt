
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Life Is What It Is Learn</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600&display=swap');

   body {
  margin: 0;
  background-color: #000;
  font-family: 'Plus Jakarta Sans', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh; /* ganti dari height */
  padding-top: 40px;
}


    .header {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      background-color: #000;
      color: white;
      margin-bottom: 40px;
      margin-right: 850px;
    }

    .logo {
      width: 70px;
      height: 70px;
      margin-right: 12px;
      border-radius: 8px;
      object-fit: cover;
    }

    .title {
      font-size: 29px;
      font-weight: 600;
      white-space: nowrap;
    }

    .line-box {
      width: 1630px;
      height: auto;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 50px;
      padding: 40px;
	  margin-left: 150px;
    }

    /* Halaman 1 */
    .card {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
    }

    .card img {
      width: 400px;
      height: auto;
	   border-radius: 30px;
    }

    .card-title {
      margin-top: 20px;
      color: white;
      font-size: 30px;
      font-weight: 600;
      padding: 10px 30px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      display: inline-block;
      margin-right: 300px;
    }

    .bottom-line {
      width: 100vw;
      border-top: 2px solid rgba(255, 255, 255, 0.2);
      margin-top: 90px;
      position: relative;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
    }

    .bottom-text {
      color: white;
      margin-top: 30px;
      font-size: 18px;
      text-align: left;
      line-height: 1.6;
      margin-right: 1000px;
      margin-bottom: 40px;
	  	  margin-left: 150px;

    }

    .bottom-text a {
      color: #fff;
      text-decoration: none;
    }

    .bottom-text a:hover {
      text-decoration: underline;
    }

    #page2 {
      display: none;
    }

    .page2-content {
      display: flex;
      gap: 50px;
      align-items: flex-start;
    }

    .page2-left {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .page2-left img {
      width: 400px;
      height: auto;
	   border-radius: 30px;
    }

    .bab-cards {
      display: flex;
      flex-direction: column; /* ke bawah */
      gap: 20px;
    }

    /* Kalau mau bab-babnya memanjang ke samping dalam satu baris, ubah ke flex-direction: row; */

    .bab-card {
      display: flex;
      flex-direction: row;
      gap: 20px;
      align-items: flex-start;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
    }

    .bab-title-box {
      font-size: 20px;
      font-weight: 600;
      padding: 8px 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      flex-shrink: 0;
    }

    .bab-desc-box {
      font-size: 16px;
      line-height: 1.5;
    }

    .page2-right {
      color: white;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .title-box {
      font-size: 36px;
      padding: 10px 30px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      display: inline-block;
	   color: #fff;
    }

    .desc-box {
      font-size: 18px;
      line-height: 1.6;
      padding: 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
    }
	
	.nav-link {
  position: fixed;  /* atau absolute sesuai kebutuhan */
  bottom: 20px;     /* jarak dari bawah halaman */
  left: 20px;       /* jarak dari kiri halaman */
}

.nav-link a {
  display: inline-flex;   /* agar icon dan teks sejajar */
  align-items: center;    /* vertikal rata tengah */
  color: white;           /* warna teks */
  text-decoration: none;  /* hilangkan underline */
  font-size: 16px;        /* ukuran teks */
  font-weight: 500;       /* ketebalan teks */
}

.nav-link a:hover {
  opacity: 0.8;  /* efek hover */
}

.nav-link svg {
  margin-right: 8px;   /* jarak antara icon dan teks */
}

#page2, #page3 {
      display: none;
    }
	
	
	#page4, #page5 {
      display: none;
    }



.bab-card svg {
  width: 48px;
  height: 48px;
  flex-shrink: 0;
}



@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}


/* Animasi untuk feedback item */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .feedback-item {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 15px;
    animation: fadeInUp 0.5s ease-out;
    transition: all 0.3s;
  }
  
  .feedback-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  
  .feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .feedback-user {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .feedback-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #4ea1ff;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }
  
  .feedback-time {
    color: #ccc;
    font-size: 14px;
  }
  
  .feedback-title {
    color: white;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 18px;
  }
  
  .feedback-category {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 12px;
    margin-bottom: 10px;
  }
  
  .category-design {
    background: rgba(78, 161, 255, 0.2);
    color: #4ea1ff;
  }
  
  .category-feature {
    background: rgba(76, 175, 80, 0.2);
    color: #4CAF50;
  }
  
  .category-content {
    background: rgba(255, 193, 7, 0.2);
    color: #FFC107;
  }
  
  .category-bug {
    background: rgba(244, 67, 54, 0.2);
    color: #F44336;
  }
  
  .category-other {
    background: rgba(156, 39, 176, 0.2);
    color: #9C27B0;
  }
  
  .feedback-content {
    color: #ddd;
    line-height: 1.6;
  }
  
  /* Animasi tombol submit */
  #submitFeedback {
    position: relative;
    overflow: hidden;
  }
  
  #submitFeedback:after {
    content: "";
    position: absolute;
    top: -50%;
    left: -60%;
    width: 200%;
    height: 200%;
    background: rgba(255,255,255,0.1);
    transform: rotate(30deg);
    transition: all 0.3s;
  }
  
  #submitFeedback:hover:after {
    left: 100%;
  }
  
  /* Animasi loading */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
    margin-left: 8px;
  }
  
  
  .feedback-time {
  color: #ccc;
  font-size: 14px;
  white-space: nowrap;
  text-align: right;
  min-width: 150px;
}

.feedback-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 10px;
  gap: 15px;
}

.feedback-user {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-grow: 1;
}

.feedback-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: #4ea1ff;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  flex-shrink: 0;
}



/* Tambahkan di bagian style */
.discussion-item {
  margin-bottom: 20px;
  padding: 20px;
  transition: all 0.3s;
  cursor: pointer;
  position: relative;
}

.discussion-item:not(:last-child)::after {
  content: "";
  position: absolute;
  bottom: -10px;
  left: 20px;
  right: 20px;
  height: 1px;
  background: rgba(255,255,255,0.1);
}

.hot-discussion {
  border-left: 3px solid #F44336;
  padding-left: 17px;
}

.latest-discussion {
  border-left: 3px solid #4ea1ff;
  padding-left: 17px;
}


.forum-header {
  display: flex;
  justify-content: space-between;
  width: 100%;
  max-width: 1200px; /* atau sesuai lebar kontainer kamu */
  margin: 0 auto;
  padding: 10px 20px;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
  font-size: 16px;
}

.forum-column {
  flex: 1;
  text-align: left;
}

/* Atur agar kolom kanan rata kanan */
.forum-column:nth-child(2),
.forum-column:nth-child(3),
.forum-column:nth-child(4) {
  text-align: right;
}

.forum-header-line {
  width: 100%;
  max-width: 1200px; /* atau sesuai lebar kontainer */
  margin: 0 auto;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  margin-bottom: 20px; /* jarak ke bawah */
}



#newDiscussionModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    justify-content: center;
    align-items: center;
}

/* Style untuk konten modal */
#newDiscussionModal > div {
    background: #1a1a1a;
    border-radius: 15px;
    padding: 30px;
    width: 600px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}




  .admin-badge {
    display: inline-block;
    background: linear-gradient(135deg, #ff6b6b, #ff3838);
    color: white;
    font-size: 12px;
    font-weight: bold;
    padding: 3px 8px;
    border-radius: 10px;
    margin-left: 8px;
    vertical-align: middle;
  }
  
  .pinned-announcement {
    position: relative;
    background: rgba(255, 184, 78, 0.1);
    border: 1px solid rgba(255, 184, 78, 0.3);
    border-radius: 12px;
    padding: 20px;
  }
  
  .pinned-announcement::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(to bottom, #ffb84e, #ff8800);
    border-radius: 12px 0 0 12px;
  }
  
  .announcement-link {
    color: #4ea1ff;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    margin-top: 10px;
  }
  
  .announcement-link:hover {
    text-decoration: underline;
  }



.announcement-item {
  position: relative;
}

.announcement-item::before {
  content: "PENGUMUMAN RESMI";
  position: absolute;
  top: 10px;
  right: 10px;
  background: #ff6b6b;
  color: white;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
}




.announcement-item {
    position: relative;
    border-left: 4px solid #ff6b6b !important;
    background: rgba(255, 107, 107, 0.05) !important;
}

.announcement-item .feedback-title {
    color: #ff6b6b !important;
    font-size: 18px !important;
}

.announcement-item .feedback-avatar {
    background: #ff6b6b !important;
}

.pinned-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ff6b6b;
    color: white;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
}


.feedback-item {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 30px; /* dari semula 10px/8px */
  padding: 20px;
  margin-bottom: 20px;
  width: 100%;
  max-width: 100%; /* agar penuh */
  box-sizing: border-box;
}



.feedback-category {
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: bold;
  display: inline-block;
  margin-top: 10px;
}

.category-design { background: #4ea1ff21; color: #4ea1ff; }
.category-feature { background: #34d39921; color: #34d399; }
.category-bug { background: #f8717121; color: #f87171; }
.category-content { background: #facc1521; color: #facc15; }
.category-announcement { background: #ff6b6b21; color: #ff6b6b; }
.category-other { background: #9ca3af21; color: #9ca3af; }
















.pin-icon {
    width: 16px;
    height: 16px;
    margin-right: 6px;
    fill: #ff6b6b;
    vertical-align: middle;
  }
  .pinned-item {
    position: relative;
    border-left: 4px solid #ff6b6b;
    background: rgba(255, 107, 107, 0.08);
  }
  .pinned-item::before {
    content: '';
    position: absolute;
    top: 10px;
    right: 10px;
    width: 24px;
    height: 24px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff6b6b'%3E%3Cpath d='M16 12V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v8l-2 2v1h15v-1l-2-2z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-size: contain;
    opacity: 0.7;
  }


/* Tambahkan di CSS Anda */
.feedback-item {
  transition: all 0.2s ease;
  cursor: pointer;
}

.feedback-item:hover {
  background: rgba(255, 255, 255, 0.08) !important;
}

.announcement-item {
  border-left: 4px solid #ff6b6b;
  background: rgba(255, 107, 107, 0.05);
}

.feedback-avatar {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(78, 161, 255, 0.2);
  color: white;
  font-weight: bold;
  margin-right: 15px;
}



/* Style untuk item pengumuman yang bisa diklik */
.pinned-item {
    cursor: pointer;
    transition: all 0.2s ease;
}

.pinned-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

/* Style untuk tombol di dalam item yang tidak trigger klik */
.pinned-item button {
    cursor: default;
    pointer-events: auto;
}







/* Style untuk history changes */
.edit-highlight {
  background-color: rgba(255, 255, 0, 0.1);
  border-left: 3px solid #ff6b6b;
  padding-left: 10px;
  transition: all 0.3s ease;
}

.history-item {
  border-left: 3px solid #4ea1ff;
  margin-bottom: 10px;
  padding-left: 10px;
}

#editHistoryList::-webkit-scrollbar {
  width: 6px;
}

#editHistoryList::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
}

#editHistoryList::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
}

/* Style untuk modal perbandingan */
#editComparisonModal h3 {
  margin-top: 0;
}

#editComparisonModal div[style*="padding: 10px"] {
  margin-bottom: 15px;
}

#beforeEditContent, #afterEditContent {
  max-height: 60vh;
  overflow-y: auto;
  padding-right: 10px;
}

#beforeEditContent::-webkit-scrollbar, 
#afterEditContent::-webkit-scrollbar {
  width: 6px;
}

#beforeEditContent::-webkit-scrollbar-track,
#afterEditContent::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
}

#beforeEditContent::-webkit-scrollbar-thumb,
#afterEditContent::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
}

/* Highlight untuk perubahan */
.highlight-added {
  background-color: rgba(78,161,255,0.3);
  border-left: 2px solid #4ea1ff;
  padding-left: 4px;
}

.highlight-removed {
  background-color: rgba(255,107,107,0.3);
  border-left: 2px solid #ff6b6b;
  padding-left: 4px;
  text-decoration: line-through;
}

/* Style untuk modal perbandingan yang baru */
#editComparisonModal {
  backdrop-filter: blur(5px);
}

#editComparisonModal > div {
  animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

#beforeEditContent, #afterEditContent {
  max-height: 50vh;
  overflow-y: auto;
  padding-right: 10px;
}







.text-diff-added {
  border-left: 3px solid #4ea1ff;
  padding-left: 5px;
  margin-left: 2px;
}

.text-diff-removed {
  border-left: 3px solid #ff6b6b;
  padding-left: 5px;
  margin-left: 2px;
  text-decoration: line-through;
}

/* Untuk kontainer utama */
.diff-container {
  padding: 8px;
  background: rgba(255,255,255,0.05);
  border-radius: 4px;
  white-space: pre-wrap;
  line-height: 1.6;
}







/* Efek hover untuk header */
#announcementHeader:hover {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 5px 10px;
  margin: -5px -10px;
  transition: all 0.2s ease;
}

  .edit-comparison-user {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .edit-comparison-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  .edit-comparison-date {
    color: #aaa;
    font-size: 12px;
    margin-top: 5px;
  }






/* Style untuk highlight perubahan */
.highlight-added {
  background-color: rgba(78,161,255,0.3);
  border-left: 2px solid #4ea1ff;
  padding: 0 2px;
  border-radius: 3px;
  margin: 0 1px;
  position: relative;
}

.highlight-added::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 0;
  background: #2a2a2a;
  color: #ddd;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 12px;
  white-space: nowrap;
  display: none;
}

.highlight-added:hover::after {
  display: block;
}

.highlight-removed {
  background-color: rgba(255,107,107,0.3);
  border-left: 2px dashed #ff6b6b;
  padding: 0 2px;
  border-radius: 3px;
  margin: 0 1px;
  text-decoration: line-through;
  position: relative;
}

.highlight-removed::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 0;
  background: #2a2a2a;
  color: #ddd;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 12px;
  white-space: nowrap;
  display: none;
}

.highlight-removed:hover::after {
  display: block;
}

/* Style untuk emoticon */
.emoticon-highlight {
  background: rgba(255,255,255,0.1);
  padding: 2px;
  border-radius: 4px;
  position: relative;
}

.emoticon-highlight::after {
  content: "Emoticon";
  position: absolute;
  bottom: 100%;
  left: 0;
  background: #2a2a2a;
  color: #ddd;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 12px;
  white-space: nowrap;
  display: none;
}

.emoticon-highlight:hover::after {
  display: block;
}






/* Gaya dasar untuk perbandingan */
.diff-container {
  padding: 10px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 5px;
  line-height: 1.6;
  white-space: pre-wrap;
}

/* Teks yang ditambahkan */
.diff-added {
  background-color: rgba(78, 161, 255, 0.3);
  border-left: 2px solid #4ea1ff;
  padding: 0 2px;
  margin: 0 1px;
  border-radius: 2px;
}

/* Teks yang dihapus */
.diff-removed {
  background-color: rgba(255, 107, 107, 0.3);
  border-left: 2px dashed #ff6b6b;
  padding: 0 2px;
  margin: 0 1px;
  border-radius: 2px;
  text-decoration: line-through;
}

/* Khusus emoticon */
.diff-emoticon {
  padding: 2px 4px !important;
  border-radius: 4px !important;
  background: rgba(255, 215, 0, 0.2) !important;
  border: 1px dotted rgba(255, 215, 0, 0.5) !important;
}

/* Khusus link */
.diff-link {
  color: #4ea1ff;
  text-decoration: underline;
}

.diff-removed.diff-link {
  color: #ff6b6b;
}

/* Container tanpa perubahan */
.no-changes {
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 5px;
}

/* Error state */
.diff-error {
  color: #ff6b6b;
  padding: 10px;
  border: 1px dashed #ff6b6b;
}



/* Style untuk modal perbandingan */
#editComparisonModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 1000;
  display: none;
  padding: 20px;
  overflow-y: auto;
}

#editComparisonModal > div {
  background: #2a2a2a;
  border-radius: 10px;
  max-width: 1000px;
  margin: 0 auto;
  padding: 25px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

.comparison-section {
  margin-bottom: 20px;
}

.comparison-section h4 {
  color: #aaa;
  margin-top: 0;
  margin-bottom: 8px;
}

.original-text {
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 5px;
  white-space: pre-wrap;
}

.comparison-guide {
  margin-top: 30px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
}

.comparison-guide h4 {
  margin-top: 0;
  color: #ddd;
}

.color-sample {
  display: inline-block;
  width: 16px;
  height: 16px;
  border-radius: 3px;
  margin-right: 8px;
  vertical-align: middle;
}

.diff-added-sample {
  background-color: rgba(78, 161, 255, 0.3);
  border: 1px solid #4ea1ff;
}

.diff-removed-sample {
  background-color: rgba(255, 107, 107, 0.3);
  border: 1px dashed #ff6b6b;
}

.diff-emoticon-sample {
  background: rgba(255, 215, 0, 0.2);
  border: 1px dotted rgba(255, 215, 0, 0.5);
}

.diff-link-sample {
  background: rgba(78, 161, 255, 0.2);
  border: 1px solid #4ea1ff;
}






/* Layout Container */
.page10-container {
  display: flex;
  padding: 20px;
  margin: 0 100px;
  gap: 30px;
}

.page10-sidebar {
  flex: 0 0 250px;
  position: sticky;
  top: 20px;
  align-self: flex-start;
  height: calc(100vh - 100px);
  overflow-y: auto;
}

.page10-main-content {
  flex: 1;
  max-width: 800px;
}

/* Linebox Style */
.linebox {
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 29px;
  padding: 25px;
  background: rgba(0, 0, 0, 0.2);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  margin-bottom: 30px;
}

/* Garis-garis putih */
.title-line-white {
  height: 2px;
  background: linear-gradient(90deg, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
  width: 60%;
  margin: 0 auto;
  margin-top: -10px;
}

.title-line-small-white {
  height: 2px;
  background: linear-gradient(90deg, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
  width: 100%;
  margin-bottom: 25px;
}

.bottom-line-white {
  height: 1px;
  background: rgba(255, 255, 255, 0.2);
  width: 80%;
  margin: 30px auto;
}

.timeline-track-white {
  position: absolute;
  left: 25px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: rgba(255, 255, 255, 0.3);
  z-index: 1;
}

.scroll-indicator-white {
  position: absolute;
  left: 25px;
  top: 0;
  width: 2px;
  background: white;
  z-index: 2;
  transition: height 0.3s ease-out;
}

.timeline-line-white {
  height: 2px;
  background: rgba(255, 255, 255, 0.3);
  width: 100%;
  margin-top: 20px;
}

.sidebar-line-white {
  height: 2px;
  background: linear-gradient(90deg, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
  margin-bottom: 15px;
}

/* Sidebar Style */
.sidebar-content {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 20px;
}

.sidebar-title {
  color: white;
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 500;
}

.content-nav {
  list-style: none;
  padding: 0;
  margin: 0;
}

.content-link {
  display: block;
  padding: 12px 15px;
  margin-bottom: 8px;
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  border-radius: 8px;
  transition: all 0.3s;
  position: relative;
  font-size: 15px;
}

.content-link::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: white;
  opacity: 0;
  transition: opacity 0.3s;
  border-radius: 3px;
}

.content-link:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.content-link.active {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  font-weight: 500;
}

.content-link.active::before {
  opacity: 1;
}

/* Timeline Style */
.history-timeline {
  position: relative;
  padding-left: 50px;
}

.timeline-item {
  position: relative;
  margin-bottom: 30px;
  padding: 25px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s;
  z-index: 3;
}

.timeline-item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(5px);
}

.timeline-number-white {
  position: absolute;
  left: -40px;
  top: 25px;
  width: 30px;
  height: 30px;
  background: white;
  color: #333;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  z-index: 4;
}

.timeline-content h3 {
  color: white;
  margin-bottom: 15px;
  font-size: 18px;
  font-weight: 500;
}

.timeline-content p {
  line-height: 1.7;
  color: rgba(255,255,255,0.8);
  font-size: 15px;
  margin-bottom: 10px;
}

.title-box-white {
  color: white;
  font-size: 22px;
  margin-bottom: 15px;
}

/* Animasi */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.timeline-item {
  animation: fadeInUp 0.6s ease-out forwards;
  opacity: 0;
}

.timeline-item:nth-child(1) { animation-delay: 0.1s; }
.timeline-item:nth-child(2) { animation-delay: 0.3s; }
.timeline-item:nth-child(3) { animation-delay: 0.5s; }
.timeline-item:nth-child(4) { animation-delay: 0.7s; }
.timeline-item:nth-child(5) { animation-delay: 0.9s; }
.timeline-item:nth-child(6) { animation-delay: 1.1s; }
.timeline-item:nth-child(7) { animation-delay: 1.3s; }
.timeline-item:nth-child(8) { animation-delay: 1.5s; }
.timeline-item:nth-child(9) { animation-delay: 1.7s; }





















.bab-card {
  cursor: pointer;
  transition: all 0.3s;
}

.bab-card:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-5px);
}

.sejarah-card {
  position: relative;
}

.sejarah-card::after {
  content: 'Klik untuk detail';
  position: absolute;
  bottom: 10px;
  right: 10px;
  font-size: 12px;
  color: rgba(255,255,255,0.6);
}



/* Tambahkan di bagian CSS */
.video-container {
  padding: 25px;
}

.video-wrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
  height: 0;
  overflow: hidden;
  margin: 20px 0;
}

.video-wrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.video-description {
  padding: 0 10px;
}





/* Footnote Styles */
.footnotes-container {
  margin-top: 50px;
  padding: 25px;
}

.footnotes-list {
  padding: 10px;
}

.footnote-item {
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  line-height: 1.6;
}

.footnote-number {
  color: white;
  font-weight: bold;
  margin-right: 8px;
}

.footnote-text {
  color: rgba(255, 255, 255, 0.8);
  font-size: 14px;
}

a.footnote-link {
  color: #4dabf7;
  text-decoration: none;
  transition: color 0.3s;
}

a.footnote-link:hover {
  color: #a5d8ff;
  text-decoration: underline;
}



/* Emoji Reaction Styles */
.emoji-reactions {
  display: flex;
  justify-content: space-around;
  padding: 20px 0;
}

.emoji-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s;
  padding: 10px;
  border-radius: 10px;
}

.emoji-option:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: scale(1.1);
}

.emoji {
  font-size: 32px;
  margin-bottom: 5px;
}

.emoji-count {
  color: white;
  font-size: 14px;
}

.emoji-option.selected {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.emoji-option.selected .emoji {
  filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
}









 /* CSS untuk komentar */
  .comments-container {
    margin: 30px auto;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
  }
  
  .comment-form {
    margin-bottom: 20px;
  }
  
  .comment-form textarea {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #444;
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    font-size: 16px;
    resize: vertical;
    margin-bottom: 10px;
  }
  
  .comment-submit-btn {
    background: #009688;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
  }
  
  .comment-submit-btn:hover {
    background: #00796b;
  }
  
  .comment-filters {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .filter-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 5px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
  }
  
  .filter-btn.active {
    background: #009688;
  }
  
  .comment-count-info {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    margin-bottom: 15px;
  }
  
  .comments-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .comment-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    position: relative;
  }
  
  .comment-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .comment-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #009688;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
    color: white;
    font-weight: bold;
  }
  
  .comment-user {
    font-weight: bold;
    color: white;
  }
  
  .comment-time {
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
    margin-left: 10px;
  }
  
  .comment-content {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 10px;
    line-height: 1.5;
  }
  
  .comment-actions {
    display: flex;
    gap: 15px;
  }
  
  .comment-action {
    color: rgba(255, 255, 255, 0.7);
    font-size: 13px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .comment-action:hover {
    color: #009688;
  }
  
  .replies-container {
    margin-top: 15px;
    padding-left: 20px;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
  }
  
  .reply-form {
    margin-top: 10px;
    display: none;
  }
  
  .reply-form.active {
    display: block;
  }
  
  .reply-form textarea {
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #444;
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    font-size: 14px;
    resize: vertical;
    margin-bottom: 5px;
  }
  
  .reply-submit-btn {
    background: rgba(0, 150, 136, 0.7);
    color: white;
    border: none;
    padding: 5px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
  }
  
  .reply-submit-btn:hover {
    background: rgba(0, 150, 136, 1);
  }
  
  .new-badge {
    background: #ff5722;
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 5px;
  }




/* Admin Button Styles */
#toggleAdminBtn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  padding: 15px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

#toggleAdminBtn:hover {
  background: #45a049;
  transform: scale(1.1);
  box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}

/* Admin Form Container */
#adminFormContainer {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 800px;
  max-width: 90vw;
  height: 80vh;
  max-height: 90vh;
  background: rgba(0,0,0,0.95);
  border-radius: 15px;
  padding: 25px;
  z-index: 1001;
  box-shadow: 0 0 30px rgba(0,0,0,0.7);
  border: 1px solid #444;
  display: flex;
  flex-direction: column;
}

/* Form Header */
#adminFormContainer h2 {
  color: white;
  text-align: center;
  margin-bottom: 20px;
  font-size: 28px;
  border-bottom: 1px solid #444;
  padding-bottom: 15px;
}

/* Form Content Area */
#adminControls {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Tabs Navigation */
.admin-tabs {
  display: flex;
  margin-bottom: 20px;
  border-bottom: 1px solid #444;
}

.admin-tab {
  padding: 12px 20px;
  background: transparent;
  color: #aaa;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.3s ease;
}

.admin-tab.active {
  color: white;
  border-bottom: 3px solid #4CAF50;
}

/* Tab Content */
.admin-tab-content {
  flex: 1;
  display: none;
  overflow: hidden;
  flex-direction: column;
}

.admin-tab-content.active {
  display: flex;
}

/* Section Selection */
#contentSection {
  width: 100%;
  padding: 12px;
  border-radius: 6px;
  background: #333;
  color: white;
  border: 1px solid #555;
  margin-bottom: 20px;
  font-size: 16px;
}

/* Content Editor */
#adminContentEditor {
  flex: 1;
  width: 100%;
  padding: 15px;
  border-radius: 8px;
  background: #222;
  color: white;
  border: 1px solid #555;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 18px;
  line-height: 1.6;
  resize: none;
  margin-bottom: 20px;
}

/* Action Buttons */
#adminFormContainer .action-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
}

#adminFormContainer .action-buttons button {
  padding: 12px 25px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
}

#adminPreviewBtn {
  background: #2196F3;
  color: white;
}

#adminSaveBtn {
  background: #4CAF50;
  color: white;
}

#adminCancelBtn {
  background: #f44336;
  color: white;
}

/* Status Message */
#adminStatus {
  margin-top: 15px;
  padding: 12px;
  border-radius: 6px;
  text-align: center;
  font-size: 16px;
}

/* Overlay */
#adminOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  display: none;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  #adminFormContainer {
    width: 95vw;
    height: 90vh;
    padding: 15px;
  }
  
  #adminContentEditor {
    font-size: 16px;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons button {
    width: 100%;
  }
}


/* CSS untuk Dashboard */
  .dashboard-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
    color: white;
  }
  
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .dashboard-notification-bell {
    position: relative;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background-color 0.3s;
  }
  
  .dashboard-notification-bell:hover {
    background-color: rgba(255,255,255,0.1);
  }
  
  .notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: #ff4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
  }
  
  .dashboard-profile, .dashboard-notifications, .dashboard-activity {
    background-color: rgba(0,0,0,0.3);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .profile-header, .notifications-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .edit-btn, .small-btn {
    background-color: rgba(255,255,255,0.1);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
    transition: background-color 0.3s;
  }
  
  .edit-btn:hover, .small-btn:hover {
    background-color: rgba(255,255,255,0.2);
  }
  
  .profile-picture-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
  }
  
  .profile-picture {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255,255,255,0.2);
  }
  
  .profile-detail {
    margin-bottom: 10px;
    display: flex;
  }
  
  .detail-label {
    color: rgba(255,255,255,0.7);
    width: 120px;
  }
  
  .detail-value {
    color: white;
    flex: 1;
  }
  
  .social-links-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .social-link-input {
    display: flex;
    align-items: center;
  }
  
  .social-icon {
    margin-right: 10px;
    color: rgba(255,255,255,0.7);
  }
  
  .social-links {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .social-link {
    color: #4CAF50;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .social-link:hover {
    text-decoration: underline;
  }
  
  .save-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .save-btn:hover {
    background-color: #3e8e41;
  }
  
  .cancel-btn {
    background-color: rgba(255,255,255,0.1);
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .cancel-btn:hover {
    background-color: rgba(255,255,255,0.2);
  }
  
  .back-btn {
    background-color: rgba(255,255,255,0.1);
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background-color 0.3s;
  }
  
  .back-btn:hover {
    background-color: rgba(255,255,255,0.2);
  }
  
  .notification-actions {
    display: flex;
    gap: 10px;
  }
  
  .notifications-list {
    max-height: 300px;
    overflow-y: auto;
  }
  
  .notification-item {
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
  }
  
  .notification-item.unread {
    background-color: rgba(66, 133, 244, 0.1);
  }
  
  .notification-icon {
    margin-right: 10px;
    color: #4CAF50;
  }
  
  .notification-content {
    flex: 1;
  }
  
  .notification-time {
    color: rgba(255,255,255,0.5);
    font-size: 12px;
    margin-top: 3px;
  }
  
  .activity-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    margin-bottom: 15px;
  }
  
  .activity-tab {
    background: none;
    border: none;
    color: rgba(255,255,255,0.7);
    padding: 8px 15px;
    cursor: pointer;
    position: relative;
  }
  
  .activity-tab.active {
    color: white;
  }
  
  .activity-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #4CAF50;
  }
  
  .activity-item {
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .activity-time {
    color: rgba(255,255,255,0.5);
    font-size: 12px;
    margin-top: 3px;
  }
  
  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
  }
  
  .modal-content {
    background-color: rgba(0,0,0,0.9);
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #444;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .close-modal {
    color: rgba(255,255,255,0.7);
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  
  .close-modal:hover {
    color: white;
  }
  
  .setting-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
    margin-right: 10px;
  }
  
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
  }
  
  .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }
  
  input:checked + .slider {
    background-color: #4CAF50;
  }
  
  input:checked + .slider:before {
    transform: translateX(26px);
  }
  
  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }







.notification-item {
    padding: 12px 15px;
    border-bottom: 1px solid #444;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
}

.notification-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.notification-item.unread {
    background-color: rgba(77, 166, 255, 0.1);
}

.notification-icon {
    font-size: 20px;
    margin-right: 15px;
    width: 30px;
    text-align: center;
}

.notification-content {
    flex: 1;
}

.notification-time {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 3px;
}

.notification-action {
    display: inline-block;
    margin-top: 5px;
    padding: 3px 8px;
    background-color: #4da6ff;
    color: white;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
}

.highlight-comment {
    animation: highlight 3s;
    border-left: 3px solid #4da6ff;
    padding-left: 10px;
}

.highlight-reply {
    animation: highlight 3s;
    background-color: rgba(77, 166, 255, 0.1);
}

@keyframes highlight {
    0% { background-color: rgba(77, 166, 255, 0.3); }
    100% { background-color: transparent; }
}




/* Notifikasi */
.notification-item {
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.notification-item.unread {
    background: rgba(77, 166, 255, 0.15);
    border-left: 3px solid #4da6ff;
}

.notification-item:hover {
    background: rgba(255,255,255,0.1);
}

.notification-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.notification-content {
    flex-grow: 1;
}

.notification-content small {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
    display: block;
    margin-top: 4px;
}

/* Aktivitas */
.activity-item {
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    display: flex;
    cursor: pointer;
    transition: all 0.3s ease;
}

.activity-item:hover {
    background: rgba(255,255,255,0.1);
}

.activity-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.activity-content {
    flex-grow: 1;
}

.activity-content h4 {
    margin: 0 0 4px 0;
    color: #4da6ff;
}

.activity-content p {
    margin: 0 0 4px 0;
    color: rgba(255,255,255,0.8);
}

.activity-content small {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
}






/* Notifikasi */
.notification-item {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: flex-start;
}

.notification-item:hover {
    background: rgba(255,255,255,0.05);
}

.notification-item.unread {
    background: rgba(41, 98, 255, 0.1);
}

.notification-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.notification-content {
    flex-grow: 1;
}

.notification-content p {
    margin: 0 0 5px 0;
    color: white;
}

.notification-content small {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
}

/* Aktivitas Terkini */
.activity-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    margin-bottom: 15px;
}

.activity-tab {
    padding: 8px 15px;
    background: none;
    border: none;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    font-size: 13px;
    position: relative;
}

.activity-tab.active {
    color: white;
    font-weight: bold;
}

.activity-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: #4da6ff;
}

.activity-item {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: flex-start;
}

.activity-item:hover {
    background: rgba(255,255,255,0.05);
}

.activity-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.activity-content {
    flex-grow: 1;
}

.activity-content p {
    margin: 0 0 5px 0;
    color: rgba(255,255,255,0.8);
    font-size: 13px;
}

.activity-content small {
    color: rgba(255,255,255,0.6);
    font-size: 11px;
}



/* Gaya untuk notifikasi dan aktivitas */
.notification-item, .activity-item {
    padding: 12px;
    margin: 5px 0;
    border-radius: 8px;
    background: rgba(255,255,255,0.03);
    transition: all 0.3s ease;
}

.notification-item.unread {
    background: rgba(41, 98, 255, 0.1);
    border-left: 3px solid #4da6ff;
}

.notification-item:hover, .activity-item:hover {
    background: rgba(255,255,255,0.08);
    transform: translateX(2px);
}

.activity-tab-content {
    display: none;
    max-height: 300px;
    overflow-y: auto;
}

.activity-tab-content.active {
    display: block;
}

/* Animasi untuk notifikasi baru */
@keyframes newNotification {
    0% { transform: scale(0.95); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.new-notification {
    animation: newNotification 0.3s ease-out;
}




/* Notifikasi */
.notifications-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

.notification-item {
    display: flex;
    align-items: flex-start;
    padding: 12px;
    margin-bottom: 8px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: background 0.2s;
    position: relative;
}

.notification-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.notification-item.unread {
    background: rgba(41, 98, 255, 0.1);
}

.notification-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.notification-content {
    flex-grow: 1;
}

.notification-content p {
    margin: 0 0 4px 0;
    color: white;
}

.notification-content small {
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
}

.notification-unread-dot {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4CAF50;
}

/* Aktivitas */
.activity-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 15px;
}

.activity-tab {
    padding: 8px 16px;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    font-size: 14px;
    position: relative;
}

.activity-tab.active {
    color: white;
    font-weight: 500;
}

.activity-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: #4CAF50;
}

.activity-tab-content {
    display: none;
}

.activity-tab-content.active {
    display: block;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    padding: 12px;
    margin-bottom: 8px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: background 0.2s;
}

.activity-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.activity-icon {
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
}

.activity-content {
    flex-grow: 1;
}

.activity-content p {
    margin: 0 0 4px 0;
    color: white;
}

.activity-content small {
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
}

/* Loader */
.loader {
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top: 3px solid #4CAF50;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    margin: 0 auto 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.notification-loader,
.activity-loader {
    text-align: center;
    padding: 20px;
    color: rgba(255, 255, 255, 0.7);
}

/* Toast */
.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #4CAF50;
    color: white;
    padding: 12px 24px;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
}

.toast.error {
    background: #f44336;
}

.toast.warning {
    background: #ff9800;
}

@keyframes slideIn {
    from { bottom: -50px; opacity: 0; }
    to { bottom: 20px; opacity: 1; }
}

.fade-out {
    animation: fadeOut 0.5s ease-out forwards;
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}



/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
}

.modal-content {
    background-color: #2a2a2a;
    margin: 5% auto;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 600px;
    color: white;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-header h3 {
    margin: 0;
}

.close-modal {
    font-size: 28px;
    cursor: pointer;
}

/* Activity Items */
.activity-item {
    display: flex;
    padding: 12px;
    margin-bottom: 10px;
    background-color: #333;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.activity-item:hover {
    background-color: #444;
}

.activity-icon {
    font-size: 24px;
    margin-right: 15px;
}

.activity-content {
    flex: 1;
}

.activity-content p {
    margin: 5px 0;
}

.activity-content small {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
}

.view-detail-btn {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    margin-top: 5px;
}

/* Detail Content */
.comment-detail, .reaction-detail, .post-detail {
    padding: 15px;
    background-color: #333;
    border-radius: 6px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    background-color: #4CAF50;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 10px;
}

.user-info {
    flex: 1;
}

.user-info h4 {
    margin: 0;
}

.user-info small {
    color: rgba(255,255,255,0.6);
    font-size: 12px;
}

.comment-header, .reaction-header, .post-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.view-original-btn {
    display: inline-block;
    background-color: #2196F3;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 12px;
    margin-left: 10px;
}

.like-btn {
    background-color: transparent;
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    display: inline-flex;
    align-items: center;
}

.like-btn svg {
    margin-right: 5px;
}

/* Empty State */
.empty-state, .empty-notifications {
    padding: 20px;
    text-align: center;
    color: rgba(255,255,255,0.7);
}

/* Notification Badge */
.notification-badge {
    background-color: #f44336;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
    position: absolute;
    top: -5px;
    right: -5px;
    display: none;
}

.unread {
    background-color: rgba(74, 144, 226, 0.1);
}






/* Style untuk halaman sponsor */
.sponsor-video {
  transition: transform 0.3s;
}

.sponsor-video:hover {
  transform: scale(1.02);
}

.video-caption {
  transition: opacity 0.3s;
}

.sponsor-video-item {
  transition: all 0.3s;
}

.sponsor-video-item:hover {
  transform: translateY(-5px);
}


.sponsorLink {
  color: #fff;
  text-decoration: none;
  display: flex;
  align-items: center;
}

.sponsorLink:hover {
  text-decoration: underline;
}




/* Efek hover untuk video TikTok */
iframe {
  transition: transform 0.3s ease;
}

iframe:hover {
  transform: scale(1.02);
}

/* Style untuk tombol hubungi sponsor */
#contactSponsorBtn {
  transition: all 0.3s ease;
}

#contactSponsorBtn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(0,102,255,0.3);
}










	
	
  </style>
</head>
<body>
  <div class="header">
    <img src="images/5.jpg" alt="Logo" class="logo" />
	<div class="title">Life Is What It Is Learn</div>
  </div>
  
  <div id="authArea" style="position: absolute; top: 10px; right: 20px; z-index: 999; display: flex; align-items: center; gap: 15px;">
  <button id="loginBtn" style="display: flex; align-items: center; background: none; border: 2px solid #9fc1d5; color: #9fc1d5; font-weight: bold; font-size: 29px; border-radius: 30px; padding: 10px 20px; cursor: pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 48 48" width="24">
      <path fill="#4285F4" d="M24 9.5c3.54 0 6.36 1.38 8.32 3.19l6.14-6.14C34.9 2.52 29.88 0 24 0 14.96 0 7.18 5.72 3.74 13.85l7.36 5.73C13 12.33 18.12 9.5 24 9.5z"/>
      <path fill="#34A853" d="M46.36 24.6c0-1.74-.16-3.41-.45-5.03H24v9.52h12.57c-.55 3-2.2 5.51-4.71 7.19v5.98h7.62c4.46-4.12 6.98-10.18 6.98-17.66z"/>
      <path fill="#FBBC05" d="M10.59 28.45c-1.07-3.2-1.07-6.64 0-9.84v-6.02H3.23a23.91 23.91 0 000 21.88l7.36-5.73z"/>
      <path fill="#EA4335" d="M24 48c6.48 0 11.92-2.13 15.9-5.78l-7.62-5.98C29.93 38.67 27.13 39.5 24 39.5c-5.88 0-10.98-3.84-12.9-9.14l-7.36 5.73C7.18 42.28 14.96 48 24 48z"/>
    </svg>
    <span style="margin-left: 10px;">Masuk dengan Google</span>
  </button>

  <button id="logoutBtn" style="display: none; background: none; border: 2px solid white; color: white; padding: 10px 15px; border-radius: 20px; font-size: 29px; cursor: pointer;">
    Keluar
  </button>

  <span id="greeting" style="color: white; font-size: 29px; margin-left: 15px;"></span>
</div>



<!-- Halaman 1 - Utama -->
  <div id="page1">
    <!-- Konten halaman utama -->
    <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
    <h1 style="color: white; font-size: 28px; margin-bottom: 20px; margin-left: 180px;">Halaman Utama</h1>
    <div class="line-box">
      <!-- Kartu-kartu konten -->
      <div class="card" id="card-arduino">
        <img src="images/5.jpg" alt="Foto Arduino" />
        <div class="card-title">
          Arduino 
          <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </div>
      </div>

      <div class="card" id="card-iot">
        <img src="images/5.jpg" alt="Foto IOT" />
        <div class="card-title">
          IOT 
          <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </div>
      </div>

      <div class="card" id="card-blog">
        <img src="images/5.jpg" alt="Foto Blog" />
        <div class="card-title">
          Blog
          <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </div>
      </div>
    </div>
	
	
   <div class="bottom-text">
  <div>
    <a href="#" class="tentangLink">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
      </svg>
      Tentang Kami
    </a>
  </div>
  <div>
    <a href="#" class="masukanLink">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
      </svg>
      Masukan
    </a>
  </div>
  <div>
    <a href="#" class="forumLink">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
      </svg>
      Forum Diskusi
    </a>
  </div>
  <div>
    <a href="#" class="sponsorLink">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
      </svg>
      Sponsor
    </a>
  </div>
</div>
</div>	
 















<!-- Halaman 2 - Arduino -->
  <div id="page2">
   <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>

    <h1 style="color: white; font-size: 28px; margin-bottom: 20px; margin-left: 180px;">Halaman Arduino</h1>
    <div class="line-box page2-content">
      <div class="page2-left">
        <img src="images/5.jpg" alt="Foto Arduino Detail" />
        <div class="bab-cards">
		<div class="bab-card sejarah-card">
    <div class="bab-title-box">Sejarah Arduino</div>
    <div class="bab-desc-box">Arduino pertama kali dikembangkan pada tahun 2005 di Italia untuk mempermudah pengajaran elektronika dan pemrograman.</div>
    <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
    </svg>
</div>

          <div class="bab-card">
            <div class="bab-title-box">Project Arduino</div>
            <div class="bab-desc-box">Dengan Arduino, banyak project dibuat seperti robotika, IoT, otomasi rumah, hingga alat bantu belajar interaktif.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Jenis Arduino</div>
            <div class="bab-desc-box">Terdapat banyak jenis board Arduino seperti Uno, Mega, Nano, yang memiliki spesifikasi berbeda sesuai kebutuhan.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Bahasa Pemrograman</div>
            <div class="bab-desc-box">Arduino menggunakan bahasa pemrograman C/C++ dengan IDE Arduino yang mudah dipelajari pemula.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Sensor & Modul</div>
            <div class="bab-desc-box">Arduino mendukung berbagai sensor & modul seperti sensor suhu, cahaya, motor driver, WiFi, dan lainnya.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
		  <!-- Contoh card untuk membuka dashboard -->
<div class="bab-card" id="dashboardCard">
  <div class="bab-title-box">Dashboard Saya</div>
  <div class="bab-desc-box">Kelola profil, notifikasi, dan aktivitas Anda</div>
  <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="5" y1="12" x2="19" y2="12"></line>
    <polyline points="12 5 19 12 12 19"></polyline>
  </svg>
</div>
		  
        </div>
      </div>
	  
	  
      <div class="page2-right">
        <h1 class="title-box">Arduino</h1>
        <p class="desc-box">
          Arduino adalah papan mikrokontroler open-source yang digunakan untuk membuat proyek elektronik interaktif.
          Dengan Arduino, Anda dapat mempelajari dasar-dasar pemrograman, sensor, dan aktuator dengan mudah.
          Cocok untuk pemula maupun profesional yang ingin membuat prototipe cepat.
        </p>
      </div>
	   <a href="https://faridardiansyah.netlify.app/#" target="_blank" style="
  position: fixed;
  bottom: 20px;
  right: 30px;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  padding: 10px 20px;
  color: white;
  font-size: 16px;
  font-weight: 500;
  text-decoration: none;
  z-index: 999;
">
  Powered by: Manusia
</a>


    </div>
    
    <div class="bottom-line"></div>

    <div class="bottom-text">
      <div>
        <a href="#" class="tentangLink">

          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Tentang Kami
        </a>
      </div>
      <div>
       <a href="#" class="masukanLink">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Masukan
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Saran
        </a>
      </div>
    </div>

    <div class="nav-link">
      <a href="#" id="back">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 5 5 12 12 19"></polyline>
        </svg>
        Kembali
      </a>
    </div>
  </div>
  
  
  
  
  
  
  
  
  
  

  <!-- Halaman 3 - IoT -->
  <div id="page3">
   <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>

    <h1 style="color: white; font-size: 28px; margin-bottom: 20px; margin-left: 180px;">Halaman IoT</h1>
    <div class="line-box page2-content">
      <div class="page2-left">
        <img src="images/5.jpg" alt="Foto IOT" />
        <div class="bab-cards">
          <div class="bab-card">
            <div class="bab-title-box">Pengertian IoT</div>
            <div class="bab-desc-box">Internet of Things (IoT) adalah konsep menghubungkan perangkat fisik ke internet agar dapat saling berkomunikasi dan bertukar data.</div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Contoh Penerapan</div>
            <div class="bab-desc-box">Contoh umum IoT meliputi smart home, smart city, kendaraan pintar, dan perangkat wearable.</div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Komponen IoT</div>
            <div class="bab-desc-box">IoT terdiri dari sensor, perangkat, konektivitas jaringan, dan sistem cloud untuk pemrosesan data.</div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Keamanan IoT</div>
            <div class="bab-desc-box">Aspek penting dari IoT adalah menjaga keamanan dan privasi data yang dikirim antar perangkat.</div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Platform Populer</div>
            <div class="bab-desc-box">Beberapa platform IoT yang populer adalah Blynk, Thingspeak, dan Google Cloud IoT Core.</div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
        </div>
      </div>
      <div class="page2-right">
        <h1 class="title-box">Internet of Things</h1>
        <p class="desc-box">
          IoT memungkinkan perangkat fisik terhubung ke jaringan internet untuk bertukar informasi dan memberikan kontrol secara jarak jauh.
          Teknologi ini semakin berkembang dan digunakan di berbagai bidang seperti industri, pertanian, kesehatan, dan rumah tangga.
        </p>
      </div>
	    <a href="https://faridardiansyah.netlify.app/#" target="_blank" style="
  position: fixed;
  bottom: 20px;
  right: 30px;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  padding: 10px 20px;
  color: white;
  font-size: 16px;
  font-weight: 500;
  text-decoration: none;
  z-index: 999;
">
  Powered by: Manusia
</a>


    </div>

    <div class="bottom-line"></div>

    <div class="bottom-text">
      <div>
        <a href="#" class="tentangLink">

          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Tentang Kami
        </a>
      </div>
      <div>
        <a href="#" class="masukanLink">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Masukan
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Saran
        </a>
      </div>
    </div>

    <div class="nav-link">
      <a href="#" id="back-iot">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 5 5 12 12 19"></polyline>
        </svg>
        Kembali
      </a>
    </div>
  </div>



<!-- Pop-up Halaman Penuh -->
<div id="popup-dev" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.95);
  color: white;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  padding: 20px;
">

  <!-- SVG animasi gear -->
  <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#00ffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
    style="animation: spin 2s linear infinite; margin-bottom: 30px;">
    <circle cx="12" cy="12" r="3"></circle>
    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 8.6 15a1.65 1.65 0 0 0-1.82-.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 15.4 9a1.65 1.65 0 0 0 1.82.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 15z"></path>
  </svg>

  <h2 style="font-size: 28px; margin-bottom: 15px;">Website ini sedang dalam perkembangan</h2>
  <p style="font-size: 18px; color: #ccc;">Fitur dan tampilan mungkin akan berubah seiring waktu.</p>
  
  <button onclick="document.getElementById('popup-dev').style.display='none'" style="
    margin-top: 30px;
    padding: 10px 20px;
    background: none;
    border: 2px solid #00ffff;
    color: #00ffff;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
  ">Saya Mengerti</button>
</div>






<!-- Halaman 4 - Blog -->
<div id="page4">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 28px; margin-bottom: 20px; margin-left: 180px;">Halaman Blog</h1>
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 30px;">
    <h1 class="title-box">Blog Terbaru</h1>
    
    <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
      <p style="color: #ccc; margin: 0;">Artikel terbaru dari berbagai topik</p>
      <a href="#" id="lihatSemuaBlog" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: flex; align-items: center;">
        Lihat semua blog 
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
      </a>
    </div>
    
    <div class="bab-card" style="width: 100%; display: flex; gap: 20px; align-items: center;">
      <img src="images/5.jpg" alt="Blog 1" style="width: 200px; height: 120px; object-fit: cover; border-radius: 15px;" />
      <div style="flex: 1;">
        <div style="color: #ccc; font-size: 14px;">14 Juli 2025 • 60 min read</div>
        <h3 style="color: white; font-weight: bold; font-size: 20px; margin: 8px 0;">
         Siapa Farid Ardiansyah?
        </h3>
        <p style="color: #ccc; margin: 8px 0; line-height: 1.5;">
          Kalau Kamu tidak tau siapa farid ardiansyah, saya menjelaskan secara detail...
        </p>
        <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center;">
          Baca selengkapnya
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>
    </div>
    
    <div class="bab-card" style="width: 100%; display: flex; gap: 20px; align-items: center;">
      <img src="images/5.jpg" alt="Blog 2" style="width: 200px; height: 120px; object-fit: cover; border-radius: 15px;" />
      <div style="flex: 1;">
        <div style="color: #ccc; font-size: 14px;">14 Juli 2025 • 60 min read</div>
        <h3 style="color: white; font-weight: bold; font-size: 20px; margin: 8px 0;">
          Apakah Kuliah di Universitas Gunadarma worth it sebanding harga UKT?
        </h3>
        <p style="color: #ccc; margin: 8px 0; line-height: 1.5;">
          Saya adalah alumnie univrsitas gunadarma, saya menjelaskan secara detail sesuai pengalaman kuliah 4 tahun...
        </p>
        <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center;">
          Baca selengkapnya
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>
    </div>
    
    <div class="bab-card" style="width: 100%; display: flex; gap: 20px; align-items: center;">
      <img src="images/5.jpg" alt="Blog 3" style="width: 200px; height: 120px; object-fit: cover; border-radius: 15px;" />
      <div style="flex: 1;">
        <div style="color: #ccc; font-size: 14px;">14 Juli 2025 • 60 min read</div>
        <h3 style="color: white; font-weight: bold; font-size: 20px; margin: 8px 0;">
          Apakah saya membutuhkan pasangan dalam hidup?
        </h3>
        <p style="color: #ccc; margin: 8px 0; line-height: 1.5;">
          saya menjelaskan secara detail sesuai dengan pengalaman hidup...
        </p>
        <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center;">
          Baca selengkapnya
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>
    </div>
  </div>
  
  
  <div class="bottom-line"></div>

    <div class="bottom-text">
      <div>
        <a href="#" class="tentangLink">

          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Tentang Kami
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Masukan
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Saran
        </a>
      </div>
    </div>

  <div class="nav-link">
    <a href="#" id="back-blog">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
  
  <a href="https://faridardiansyah.netlify.app/#" target="_blank" style="
    position: fixed;
    bottom: 20px;
    right: 30px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 10px 20px;
    color: white;
    font-size: 16px;
    font-weight: 500;
    text-decoration: none;
    z-index: 999;
  ">
    Powered by: Manusia
  </a>
</div>







<!-- Halaman 5 - Kumpulan Blog -->
<div id="page5">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 28px; margin: 30px 0 10px 180px;">Kumpulan Blog</h1>
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 20px;">
    <!-- Header dengan info jumlah blog -->
    <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div id="blogCountDisplay" style="color: #ccc; font-size: 16px;">
        Menampilkan 6 dari 25 Blog
      </div>
      <div style="display: flex; gap: 10px; align-items: center;">
        <div style="position: relative;">
          <input type="text" id="blogSearch" placeholder="Cari blog..." style="
            padding: 10px 15px;
            padding-right: 40px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
            font-size: 14px;
            width: 250px;
          ">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
          ">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </div>
        <button id="searchBtn" style="
          padding: 10px 15px;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          border-radius: 20px;
          color: #4ea1ff;
          font-size: 14px;
          cursor: pointer;
          transition: all 0.3s;
        ">
          Cari
        </button>
      </div>
    </div>
    
    <!-- Daftar blog -->
    <div id="blogList" style="width: 100%; display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
      <!-- Blog 1 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="BMKG: Cuaca Ekstrem Masih Mengintai, Musim Kemarau Belum Dominan" data-date="2025-07-12" data-category="Berita" data-tags="cuaca, bmkg, iklim">
        <img src="images/5.jpg" alt="Blog 1" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: red; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;">Farid Ardiansyah</span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
            Siapa Farid Ardiansyah?
          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
            Kalau Kamu tidak tau siapa farid ardiansyah, saya menjelaskan secara detail.....
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Blog 2 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="Tutorial Arduino: Membuat Sistem Monitoring Suhu dan Kelembaban" data-date="2025-07-10" data-category="Tutorial" data-tags="arduino, sensor, pemrograman">
        <img src="images/5.jpg" alt="Blog 2" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: blue; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;">Universitas Gunadarma </span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
            Apakah Kuliah di Universitas Gunadarma worth it sebanding harga UKT?

          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
            Saya adalah alumnie univrsitas gunadarma, saya menjelaskan secara detail sesuai pengalaman kuliah 4 tahun......
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Blog 3 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="IoT dalam Pertanian: Meningkatkan Produktivitas dengan Teknologi" data-date="2025-07-08" data-category="Teknologi" data-tags="iot, pertanian, smart-farming">
        <img src="images/5.jpg" alt="Blog 3" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: green; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;">pasangan</span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
		  Apakah saya membutuhkan pasangan dalam hidup?

          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
            saya menjelaskan secara detail sesuai dengan pengalaman hidup......
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Blog 4 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="Review Modul ESP32: Kelebihan dan Kekurangan untuk Project IoT" data-date="2025-07-05" data-category="Review" data-tags="esp32, iot, review">
        <img src="images/5.jpg" alt="Blog 4" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: red; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;"> Belum dibikin blog nya, sabar ya</span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
            Belum dibikin blog nya, sabar ya
          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
            saya bakal bikin blog nya sesuai waktu ya
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Blog 5 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="Panduan Lengkap Pemrograman Arduino untuk Pemula" data-date="2025-07-03" data-category="Tutorial" data-tags="arduino, pemrograman, dasar">
        <img src="images/5.jpg" alt="Blog 5" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: yellow; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;">  Belum dibikin blog nya, sabar ya</span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
             Belum dibikin blog nya, sabar ya
          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
                        saya bakal bikin blog nya sesuai waktu ya...
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Blog 6 -->
      <div class="bab-card blog-item" style="display: flex; flex-direction: column; height: 100%; transition: transform 0.3s;" data-title="Teknologi Smart Home: Mengontrol Rumah dari Smartphone" data-date="2025-07-01" data-category="Teknologi" data-tags="smart-home, iot, otomasi">
        <img src="images/5.jpg" alt="Blog 6" style="width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 15px;" />
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="color: green; font-size: 12px; font-weight: bold; background: rgba(78, 161, 255, 0.1); padding: 4px 8px; border-radius: 10px;"> Belum dibikin blog nya, sabar ya</span>
            <span style="color: #ccc; font-size: 12px;">14 Juli 2025</span>
          </div>
          <h3 style="color: white; font-weight: bold; font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;">
             Belum dibikin blog nya, sabar ya
          </h3>
          <p style="color: #ccc; margin: 0 0 15px 0; line-height: 1.5; font-size: 14px; flex-grow: 1;">
             saya bakal bikin blog nya sesuai waktu ya......
          </p>
          <a href="#" style="color: #4ea1ff; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; margin-top: auto;">
            Baca selengkapnya
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
      <button id="prevPage" style="
        padding: 8px 16px;
        background: transparent;
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
      ">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Sebelumnya
      </button>
      
      <div style="display: flex; gap: 5px;">
        <button class="page-btn active" data-page="1" style="
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          color: white;
          cursor: pointer;
          transition: all 0.3s;
        ">1</button>
        <button class="page-btn" data-page="2" style="
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background: transparent;
          border: 1px solid rgba(255,255,255,0.2);
          color: white;
          cursor: pointer;
          transition: all 0.3s;
        ">2</button>
        <button class="page-btn" data-page="3" style="
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background: transparent;
          border: 1px solid rgba(255,255,255,0.2);
          color: white;
          cursor: pointer;
          transition: all 0.3s;
        ">3</button>
        <span style="color: white; display: flex; align-items: center; padding: 0 10px;">...</span>
        <button class="page-btn" data-page="8" style="
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background: transparent;
          border: 1px solid rgba(255,255,255,0.2);
          color: white;
          cursor: pointer;
          transition: all 0.3s;
        ">8</button>
      </div>
      
      <button id="nextPage" style="
        padding: 8px 16px;
        background: transparent;
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
      ">
        Selanjutnya
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
      </button>
    </div>
  </div>
  
  <div class="bottom-line"></div>

    <div class="bottom-text">
      <div>
        <a href="#" class="tentangLink">

          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Tentang Kami
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Masukan
        </a>
      </div>
      <div>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Saran
        </a>
      </div>
    </div>

  <div class="nav-link">
    <a href="#" id="back-page5">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
  
  <a href="https://faridardiansyah.netlify.app/#" target="_blank" style="
    position: fixed;
    bottom: 20px;
    right: 30px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 10px 20px;
    color: white;
    font-size: 16px;
    font-weight: 500;
    text-decoration: none;
    z-index: 999;
  ">
    Powered by: Manusia
  </a>
</div>


<!-- Halaman 6 - Tentang Kami -->
<div id="page6" style="display:none;">
  
  <h1 style="color: white; font-size: 39px; margin: 20px 0 30px 180px;">Tentang Kami</h1>
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 30px;">
  
    <div style="color: white; font-size: 25px;">
      Diperbarui <span id="tentangKamiTime">baru saja</span>
    </div>
  

  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;">
    Life Is What It Is Learn
  </div>

    <div style="color: white; font-size: 29px; line-height: 1.7;">
     Life Is What It Is Learn adalah website pengalaman hidup yang terus menerus tetap berjalan tanpa ada satupun yang support saya dalam hal apapun, maka nya saya terus belajar sampai meninggal, melupakan orang lain dan melupakan nyari pasangan. <br><br>
      Kunjungi Portfolio saya: 
      <a href="https://faridardiansyah.netlify.app/" target="_blank" style="color: red;">Portfolio Farid Ardiansyah</a>
    </div>
	
	<div style="color: white; font-size: 29px; line-height: 1.7;">
     saya terus belajar dan belajar tentang pemrograman, illustration character, saya terus perbaiki kesalahan dan kekurangan. kamu bisa diskusi di forum chat.
      <a href="https://forumchat-faridardiansyah.netlify.app/" target="_blank" style="color: green;">Forum Chat</a>
    </div>

    <img src="images/5.jpg" alt="Tentang Kami" style="width: 500px; border-radius: 20px;" />


  <div class="nav-link">
    <a href="#" id="back-tentang">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
</div>
</div>
</div>









<!-- Halaman 7 - Masukan -->
<div id="page7" style="display: none;">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 28px; margin: 30px 0 20px 180px;">Halaman Masukan</h1>
  
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 30px; padding: 40px; border-radius: 20px; background: rgba(0, 0, 0, 0.3); margin: 0 100px;">
    <!-- Header dengan info feedback -->
    <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div id="feedbackCountDisplay" style="color: #ccc; font-size: 16px;">
        Menampilkan semua masukan
      </div>
      <div style="display: flex; gap: 10px;">
        <button id="sortNewest" class="sort-btn active" style="
          padding: 8px 15px;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          border-radius: 20px;
          color: #4ea1ff;
          font-size: 14px;
          cursor: pointer;
        ">
          Terbaru
        </button>
        <button id="sortPopular" class="sort-btn" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          Populer
        </button>
      </div>
    </div>

    <!-- Form Pengumuman (Hanya untuk Admin/Kontributor) -->
    <div id="adminAnnouncementForm" style="width: 100%; margin-bottom: 30px; display: none; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Buat Pengumuman
      </h2>
      
      <form id="announcementForm" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div>
          <label for="announcementTitle" style="color: white; display: block; margin-bottom: 8px; font-size: 16px;">Judul Pengumuman</label>
          <input type="text" id="announcementTitle" placeholder="Contoh: Pemeliharaan Sistem" 
                 style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;">
        </div>
        
        <div>
          <label for="announcementContent" style="color: white; display: block; margin-bottom: 8px; font-size: 16px;">Isi Pengumuman</label>
          <textarea id="announcementContent" rows="5" placeholder="Tulis pengumuman Anda..." 
                    style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;"></textarea>
        </div>
        
        <div style="display: flex; justify-content: flex-end;">
          <button type="submit" id="submitAnnouncement" style="padding: 12px 25px; background: linear-gradient(135deg, #ff6b6b, #ff0000); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
            Kirim Pengumuman
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 8px;">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
          </button>
        </div>
      </form>
    </div>

    <div id="pinnedAnnouncementsContainer" style="width: 100%; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: #ff6b6b; margin-bottom: 15px; font-size: 22px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">Pengumuman Penting</h2>
      <div id="pinnedAnnouncementsList"></div>
    </div>
    
    <div id="feedbackHistory" style="width: 100%; margin-bottom: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Riwayat Masukan
      </h2>
      <div id="feedbackListContainer" style="display: flex; flex-direction: column; gap: 15px;">
        <!-- Feedback items will be added here dynamically -->
      </div>
    </div>
    
    <!-- Form masukan baru -->
    <div id="newFeedbackForm" style="width: 100%; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Kirim Masukan Baru
      </h2>
      
      <form id="masukanForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <!-- Kolom 1 - Judul Masukan -->
        <div style="grid-column: 1;">
          <label for="feedbackTitle" style="color: white; display: block; margin-bottom: 8px; font-size: 16px;">Judul Masukan</label>
          <input type="text" id="feedbackTitle" placeholder="Contoh: Perbaikan desain halaman utama" 
                 style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;">
        </div>
        
        <!-- Kolom 2 - Kategori -->
        <div style="grid-column: 2;">
          <label for="feedbackCategory" style="color: white; display: block; margin-bottom: 8px; font-size: 16px;">Kategori</label>
        <select id="feedbackCategory" style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white; required">
    <option value="design">Desain</option>
    <option value="feature">Fitur</option>
    <option value="content">Konten</option>
    <option value="bug">Bug/Masalah</option>
    <option value="arduino">Arduino</option>
    <option value="other">Lainnya</option>
</select>
        </div>
        
        <!-- Kolom 3 - Isi Masukan (full width) -->
        <div style="grid-column: 1 / span 2;">
          <label for="feedbackContent" style="color: white; display: block; margin-bottom: 8px; font-size: 16px;">Isi Masukan</label>
          <textarea id="feedbackContent" rows="5" placeholder="Tulis masukan Anda secara detail..." 
                    style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;"></textarea>
        </div>
        
        <!-- Tombol Submit -->
        <div style="grid-column: 1 / span 2; display: flex; justify-content: flex-end;">
          <button type="submit" id="submitFeedback" style="padding: 12px 25px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
            Kirim Masukan
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 8px;">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal untuk Reply -->
  <div id="replyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: #1a1a1a; border-radius: 15px; padding: 30px; width: 600px; max-width: 90%; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: white; font-size: 24px;">Balas Masukan</h2>
        <button id="closeReplyModal" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
      </div>
      
      <div id="originalFeedback" style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;"></div>
      
      <form id="replyForm">
        <textarea id="replyContent" rows="5" placeholder="Tulis balasan Anda..." style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; margin-bottom: 20px;"></textarea>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" id="cancelReply" style="padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; cursor: pointer;">
            Batal
          </button>
          <button type="submit" id="submitReply" style="padding: 10px 20px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
            Kirim Balasan
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="bottom-line"></div>

  <div class="bottom-text">
    <div>
      <a href="#" class="tentangLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Tentang Kami
      </a>
    </div>
    <div>
      <a href="#" class="masukanLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Masukan
      </a>
    </div>
    <div>
      <a href="#">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Saran
      </a>
    </div>
  </div>

  <div class="nav-link">
    <a href="#" id="back-masukan">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
</div>













<!-- Halaman 8 - Diskusi Forum -->
<div id="page8" style="display:none;">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 39px; margin: 20px 0 30px 180px;">Diskusi Forum</h1>
  
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 30px; padding: 40px;">
    <!-- Header dengan search dan filter -->
    <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div style="display: flex; gap: 10px; align-items: center;">
        <div style="position: relative;">
          <input type="text" id="forumSearch" placeholder="Cari diskusi..." style="
            padding: 10px 15px;
            padding-right: 40px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
            font-size: 16px;
            width: 300px;
          ">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
          ">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </div>
        <button id="searchForumBtn" style="
          padding: 10px 15px;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          border-radius: 20px;
          color: #4ea1ff;
          font-size: 16px;
          cursor: pointer;
          transition: all 0.3s;
        ">
          Cari
        </button>
      </div>
	  
	  
	  
	  <button id="newDiscussionBtn" style="padding: 10px 20px;background: linear-gradient(135deg, #4ea1ff, #0066ff);border: none;border-radius: 10px;color: white;font-weight: bold;cursor: pointer;display: flex;align-items: center;gap: 8px;">
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="12" y1="5" x2="12" y2="19"></line>
    <line x1="5" y1="12" x2="19" y2="12"></line>
  </svg>
  Diskusi Baru
</button>
   
   <!-- Modal untuk Diskusi Baru -->
<div id="newDiscussionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: #1a1a1a; border-radius: 15px; padding: 30px; width: 600px; max-width: 90%; max-height: 90vh; overflow-y: auto;">
    <h2 style="color: white; font-size: 24px; margin-bottom: 20px;">Buat Diskusi Baru</h2>
    <form id="newDiscussionForm">
      <div style="margin-bottom: 20px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Judul Diskusi</label>
        <input type="text" id="discussionTitle" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
      </div>
      <div style="margin-bottom: 20px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Kategori</label>
        <select id="discussionCategory" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
          <option value="">Pilih Kategori</option>
          <option value="arduino">Arduino</option>
          <option value="iot">IoT</option>
          <option value="pemrograman">Pemrograman</option>
          <option value="elektronik">Elektronik</option>
          <option value="lainnya">Lainnya</option>
        </select>
      </div>
      <div style="margin-bottom: 20px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Deskripsi Diskusi</label>
        <textarea id="discussionContent" rows="5" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;"></textarea>
      </div>
      <div style="display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" id="cancelDiscussion" style="padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; cursor: pointer;">Batal</button>
        <button type="submit" id="submitDiscussion" style="padding: 10px 20px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">Buat Diskusi</button>
      </div>
    </form>
  </div>
</div>
</div>
   
   
   
   
   
    <!-- Kategori dan Tag -->
    <div style="width: 100%; margin-bottom: 20px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px;">Kategori Populer</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        <button class="category-btn active" data-category="all" style="
          padding: 8px 15px;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          border-radius: 20px;
          color: #4ea1ff;
          font-size: 14px;
          cursor: pointer;
        ">
          Semua
        </button>
        <button class="category-btn" data-category="arduino" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          Arduino
        </button>
        <button class="category-btn" data-category="iot" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          IoT
        </button>
        <button class="category-btn" data-category="pemrograman" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          Pemrograman
        </button>
        <button class="category-btn" data-category="elektronik" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          Elektronik
        </button>
      </div>
    </div>
    
    <!-- Filter Diskusi -->
    <div style="width: 100%; margin-bottom: 20px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px;">Filter Diskusi</h2>
      <div style="display: flex; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px;">
        <button id="filterLatest" class="filter-btn active" data-filter="latest" style="
          padding: 8px 15px;
          background: rgba(78, 161, 255, 0.2);
          border: 1px solid rgba(78, 161, 255, 0.5);
          border-radius: 20px;
          color: #4ea1ff;
          font-size: 14px;
          cursor: pointer;
        ">
          Terbaru
        </button>
        <button id="filterHot" class="filter-btn" data-filter="hot" style="
          padding: 8px 15px;
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.2);
          border-radius: 20px;
          color: white;
          font-size: 14px;
          cursor: pointer;
        ">
          Populer
        </button>
      </div>
    </div>

    <!-- Header Tabel Diskusi -->
    <div class="forum-header">
      <div class="forum-column">Topik</div>
      <div class="forum-column">Balasan</div>
      <div class="forum-column">Dilihat</div>
      <div class="forum-column">Aktivitas</div>
    </div>
    <div class="forum-header-line"></div>
    
    <!-- Daftar Diskusi -->
    <div id="discussionList" style="width: 100%;"></div>
    
    <!-- Pagination -->
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px;">
      <button id="prevPageBtn" style="padding: 8px 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; cursor: pointer;">
        Sebelumnya
      </button>
      <div id="pageNumbers" style="display: flex; gap: 5px;"></div>
      <button id="nextPageBtn" style="padding: 8px 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; cursor: pointer;">
        Selanjutnya
      </button>
    </div>
  </div>
  
  <div class="bottom-line"></div>

  <div class="bottom-text">
    <div>
      <a href="#" class="tentangLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Tentang Kami
      </a>
    </div>
    <div>
      <a href="#" class="masukanLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Masukan
      </a>
    </div>
    <div>
      <a href="#">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Saran
      </a>
    </div>
  </div>

  <div class="nav-link">
    <a href="#" id="back-forum">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
  
  <!-- Modal untuk Diskusi Baru -->
  <div id="newDiscussionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: #1a1a1a; border-radius: 15px; padding: 30px; width: 600px; max-width: 90%; max-height: 90vh; overflow-y: auto;">
      <h2 style="color: white; font-size: 24px; margin-bottom: 20px;">Buat Diskusi Baru</h2>
      
      <form id="newDiscussionForm">
        <div style="margin-bottom: 20px;">
          <label style="color: white; display: block; margin-bottom: 8px;">Judul Diskusi</label>
          <input type="text" id="discussionTitle" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="color: white; display: block; margin-bottom: 8px;">Kategori</label>
          <select id="discussionCategory" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
            <option value="">Pilih Kategori</option>
            <option value="arduino">Arduino</option>
            <option value="iot">IoT</option>
            <option value="pemrograman">Pemrograman</option>
            <option value="elektronik">Elektronik</option>
            <option value="lainnya">Lainnya</option>
          </select>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="color: white; display: block; margin-bottom: 8px;">Deskripsi Diskusi</label>
          <textarea id="discussionContent" rows="5" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;"></textarea>
        </div>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" id="cancelDiscussion" style="padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; cursor: pointer;">
            Batal
          </button>
          <button type="submit" id="submitDiscussion" style="padding: 10px 20px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
            Buat Diskusi
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <a href="https://faridardiansyah.netlify.app/#" target="_blank" style="
    position: fixed;
    bottom: 20px;
    right: 30px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 10px 20px;
    color: white;
    font-size: 16px;
    font-weight: 500;
    text-decoration: none;
    z-index: 999;
  ">
    Powered by: Manusia
  </a>
</div>








<!-- Halaman 9 - Detail Pengumuman -->
<div id="page9" style="display: none;">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 28px; margin: 30px 0 20px 180px;">Detail Pengumuman</h1>
  
  <div class="line-box" style="flex-direction: column; align-items: flex-start; gap: 30px; padding: 40px; border-radius: 20px; background: rgba(0, 0, 0, 0.3); margin: 0 100px;">
    <!-- Konten Pengumuman -->
    <div id="announcementDetailContainer" style="width: 100%; background: rgba(255,255,255,0.05); padding: 30px; border-radius: 15px;">
      <!-- Konten akan dimuat oleh JavaScript -->
    </div>

    <!-- Form Edit Pengumuman (Hanya untuk Admin) -->
    <div id="adminAnnouncementForm" style="display: none; width: 100%; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-top: 20px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Edit Pengumuman
      </h2>
      <form id="editAnnouncementForm">
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: white; margin-bottom: 8px; font-size: 16px;">Judul</label>
          <input type="text" id="editAnnouncementTitle" style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;">
        </div>
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: white; margin-bottom: 8px; font-size: 16px;">Isi</label>
          <textarea id="editAnnouncementContent" rows="5" style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white;"></textarea>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" id="cancelEditAnnouncement" style="padding: 12px 25px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; cursor: pointer;">
            Batal
          </button>
          <button type="button" id="deleteAnnouncement" style="padding: 12px 25px; background: linear-gradient(135deg, #ff6b6b, #ff0000); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
            Hapus
          </button>
          <button type="submit" style="padding: 12px 25px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
            Simpan Perubahan
          </button>
        </div>
      </form>
    </div>
	








<div id="editComparisonModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
  <div style="background: #2a2a2a; border-radius: 10px; width: 100%; max-width: 1000px; max-height: 90vh; overflow-y: auto; padding: 25px; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
    <!-- Header dengan info pengguna dan tanggal -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;">
      <div style="display: flex; align-items: center; gap: 15px;">
        <div id="comparisonUserAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; overflow: hidden;">
          <img id="comparisonUserPhoto" src="" alt="User" style="width: 100%; height: 100%; object-fit: cover; display: none;">
          <span id="comparisonUserInitial" style="color: white; font-weight: bold;"></span>
        </div>
        <div>
          <div id="comparisonUserName" style="color: white; font-weight: 500; font-size: 16px;">Admin</div>
          <div id="comparisonEditDate" style="color: #aaa; font-size: 12px;">Tanggal perubahan</div>
        </div>
      </div>
      <h2 style="color: white; margin: 0; font-size: 22px; display: flex; align-items: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Perbandingan Perubahan
      </h2>
      <button id="closeEditComparison" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 5px;">&times;</button>
    </div>
    
    <!-- Navigasi perubahan -->
    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
      <button id="prevComparison" style="padding: 8px 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; cursor: pointer; display: flex; align-items: center; gap: 8px;" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Sebelumnya
      </button>
      <div id="comparisonCounter" style="color: #aaa; font-size: 14px; display: flex; align-items: center;">
        Perubahan 1 dari 1
      </div>
      <button id="nextComparison" style="padding: 8px 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; cursor: pointer; display: flex; align-items: center; gap: 8px;" disabled>
        Selanjutnya
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
    
    <!-- Konten perbandingan -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
      <div style="border: 1px solid rgba(255,107,107,0.3); border-radius: 8px; padding: 15px;">
        <h3 style="color: #ff6b6b; margin-top: 0; border-bottom: 1px solid rgba(255,107,107,0.3); padding-bottom: 10px; display: flex; align-items: center;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Sebelum Edit
        </h3>
        <div id="beforeEditContent" style="color: #ddd; line-height: 1.6;"></div>
      </div>
      
      <div style="border: 1px solid rgba(78,161,255,0.3); border-radius: 8px; padding: 15px;">
        <h3 style="color: #4ea1ff; margin-top: 0; border-bottom: 1px solid rgba(78,161,255,0.3); padding-bottom: 10px; display: flex; align-items: center;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
            <path d="M2 2l7.586 7.586"></path>
            <circle cx="11" cy="11" r="2"></circle>
          </svg>
          Sesudah Edit
        </h3>
        <div id="afterEditContent" style="color: #ddd; line-height: 1.6;"></div>
      </div>
    </div>
    
    <div style="background: rgba(255,255,255,0.05); border-radius: 6px; padding: 12px; margin-top: 20px;">
      <div style="display: flex; align-items: center; color: #aaa; font-size: 14px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12" y2="8"></line>
        </svg>
        <div>
          <div style="font-weight: 500; color: #ddd; margin-bottom: 5px;">Petunjuk Perbandingan:</div>
          <div style="display: flex; align-items: center; margin-bottom: 3px;">
            <span style="display: inline-block; width: 14px; height: 14px; background: rgba(78,161,255,0.3); border: 1px solid #4ea1ff; border-radius: 2px; margin-right: 8px;"></span>
            <span>Teks yang ditambahkan</span>
          </div>
          <div style="display: flex; align-items: center;">
            <span style="display: inline-block; width: 14px; height: 14px; background: rgba(255,107,107,0.3); border: 1px solid #ff6b6b; border-radius: 2px; margin-right: 8px; text-decoration: line-through;"></span>
            <span>Teks yang dihapus</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>











    <!-- Balasan Pengumuman -->
    <div id="announcementRepliesContainer" style="width: 100%; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Balasan (<span id="repliesCount">0</span>)
      </h2>
      <div id="announcementRepliesList" style="display: flex; flex-direction: column; gap: 15px;"></div>
      
      <!-- Form Balasan -->
      <div id="loginToReply" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; text-align: center;">
        <p style="color: #aaa; margin-bottom: 10px;">Silakan login untuk membalas</p>
        <a href="#" id="loginLink" style="color: #4ea1ff; text-decoration: none;">Login</a>
      </div>
      
      <form id="announcementReplyForm" style="display: none; margin-top: 20px;">
        <textarea id="announcementReplyContent" rows="3" placeholder="Tulis balasan Anda..." style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white; margin-bottom: 15px;"></textarea>
        <div style="display: flex; justify-content: flex-end;">
          <button type="submit" style="padding: 12px 25px; background: linear-gradient(135deg, #4ea1ff, #0066ff); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
            Kirim Balasan
          </button>
        </div>
      </form>
    </div>

    <!-- Pengumuman Terkait -->
    <div id="relatedAnnouncementsContainer" style="width: 100%; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
      <h2 style="color: white; font-size: 22px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        Pengumuman Terkait
      </h2>
      <div id="relatedAnnouncementsList"></div>
    </div>
  </div>

  <div class="bottom-line"></div>

  <div class="bottom-text">
    <div>
      <a href="#" class="tentangLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Tentang Kami
      </a>
    </div>
    <div>
      <a href="#" class="masukanLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Masukan
      </a>
    </div>
    <div>
      <a href="#">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Saran
      </a>
    </div>
  </div>

  <div class="nav-link">
    <a href="#" id="backToAnnouncements">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
</div>
  






<div id="page10" style="display: none;">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>

  <div class="title-section">
    <h1 style="color: white; font-size: 28px; margin-bottom: 20px; text-align: center;">Sejarah Lengkap Arduino</h1>

  </div>
  
  <div class="page10-container">
    <!-- Sidebar Daftar Konten -->
    <div class="page10-sidebar">
      <div class="sidebar-content linebox">
        <h3 class="sidebar-title">Daftar Konten</h3>

        <ul class="content-nav">
          <li><a href="#year2003" class="content-link active">2003 - Awal Mula</a></li>
          <li><a href="#year2005" class="content-link">2005 - Peluncuran</a></li>
          <li><a href="#year2008" class="content-link">2008 - Pertumbuhan</a></li>
          <li><a href="#year2010" class="content-link">2010 - Arduino Uno</a></li>
          <li><a href="#year2012" class="content-link">2012 - Ekspansi</a></li>
          <li><a href="#year2015" class="content-link">2015 - Perubahan</a></li>
          <li><a href="#year2017" class="content-link">2017 - Kolaborasi</a></li>
          <li><a href="#year2020" class="content-link">2020 - Pandemi</a></li>
          <li><a href="#yearNow" class="content-link">Sekarang</a></li>
        </ul>
      </div>
    </div>
    
    <!-- Konten Utama Timeline -->
    <div class="page10-main-content">
      <div class="history-content linebox">
        <h2 class="title-box-white">Timeline Perkembangan Arduino</h2>

        
        <div class="history-timeline">
          <!-- Garis vertikal timeline -->
          <div class="timeline-track-white"></div>
          
          <!-- Garis scroll indicator -->
          <div class="scroll-indicator-white" id="scrollIndicator"></div>
          
          <!-- Item Timeline -->
		  <div class="timeline-item" id="year2003">
  <div class="timeline-number-white">1</div>
  <div class="timeline-content">
    <h3>2003 - Awal Mula</h3>
    <p>Proyek Arduino dimulai di Interaction Design Institute Ivrea (IDII) di Ivrea, Italia sebagai alat untuk prototyping cepat bagi siswa desain<a href="#footnote1" class="footnote-link">[1]</a>.</p>
    <p>Ide awalnya adalah menciptakan alat yang mudah digunakan untuk membuat prototipe interaktif tanpa memerlukan latar belakang elektronik yang mendalam<a href="#footnote2" class="footnote-link">[2]</a>.</p>
  </div>

          </div>
          
          <div class="timeline-item" id="year2005">
            <div class="timeline-number-white">2</div>
            <div class="timeline-content">
              <h3>2005 - Peluncuran Resmi</h3>
              <p>Arduino pertama kali diperkenalkan dengan board berbasis ATMega8. Nama "Arduino" diambil dari nama bar di Ivrea yang sering dikunjungi oleh pendirinya.</p>
              <p>Board pertama ini memiliki 14 pin digital I/O (6 bisa digunakan sebagai PWM), 6 input analog, resonator keramik 16MHz, koneksi USB, dan jack power.</p>
              <p>Proyek ini dirilis sebagai open-source, baik desain hardware maupun software-nya.</p>
            </div>

          </div>
          
          <div class="timeline-item" id="year2008">
            <div class="timeline-number-white">3</div>
            <div class="timeline-content">
              <h3>2008 - Pertumbuhan Pesat</h3>
              <p>Popularitas Arduino meledak di kalangan maker dan komunitas DIY. Arduino Duemilanove dirilis dengan berbagai peningkatan fitur termasuk auto-select power source.</p>
              <p>Komunitas Arduino mulai bermunculan di berbagai negara, dengan forum online yang aktif berdiskusi tentang proyek dan pemecahan masalah.</p>
              <p>Buku pertama tentang Arduino diterbitkan, memperkenalkan platform ini ke audiens yang lebih luas.</p>
            </div>

          </div>
          
          <div class="timeline-item" id="year2010">
            <div class="timeline-number-white">4</div>
            <div class="timeline-content">
              <h3>2010 - Arduino Uno</h3>
              <p>Arduino Uno dirilis menjadi board standar paling populer dengan chip ATmega328P dan antarmuka USB yang stabil menggunakan chip ATmega16U2 sebagai USB-to-serial converter.</p>
              <p>Uno (berarti "satu" dalam bahasa Italia) menjadi board yang paling banyak digunakan dalam pendidikan dan proyek-proyek hobi.</p>
              <p>Versi ini memperkenalkan standar pinout yang kemudian diikuti oleh banyak board kompatibel Arduino.</p>
            </div>

          </div>
          
          <div class="timeline-item" id="year2012">
            <div class="timeline-number-white">5</div>
            <div class="timeline-content">
              <h3>2012 - Ekspansi Produk</h3>
              <p>Arduino memperluas jajaran produk dengan Arduino Due (processor ARM 32-bit pertama), Leonardo (menggunakan ATmega32u4 dengan USB built-in), dan berbagai shield tambahan.</p>
              <p>Arduino Yún diperkenalkan, menggabungkan processor Arduino dengan sistem Linux berbasis WiFi.</p>
              <p>Mulai muncul banyak clone dan varian Arduino dari berbagai produsen, menunjukkan popularitas platform ini.</p>
            </div>

          </div>
          
          <div class="timeline-item" id="year2015">
            <div class="timeline-number-white">6</div>
            <div class="timeline-content">
              <h3>2015 - Perubahan Perusahaan</h3>
              <p>Terjadi perpecahan dalam Arduino LLC dengan pembentukan Arduino SRL oleh salah satu pendiri. Hal ini menyebabkan kebingungan di komunitas dengan dua versi software yang berbeda.</p>
              <p>Arduino mengumpulkan $2.3 juta dalam kampanye Kickstarter untuk Arduino Tian, board dengan WiFi dan Bluetooth.</p>
              <p>IDE Arduino 1.6 dirilis dengan dukungan untuk board-board baru dan peningkatan stabilitas.</p>
            </div>

          </div>
          
          <div class="timeline-item" id="year2017">
            <div class="timeline-number-white">7</div>
            <div class="timeline-content">
              <h3>2017 - Kolaborasi dan Penyelesaian</h3>
              <p>Arduino LLC dan Arduino SRL akhirnya bersatu kembali setelah penyelesaian sengketa hukum, membentuk Arduino AG.</p>
              <p>Arduino mengumumkan kolaborasi dengan ARM untuk mengembangkan Arduino MKR series yang berfokus pada IoT.</p>
              <p>Arduino Create, platform cloud untuk pengembangan Arduino, diluncurkan secara resmi.</p>
            </div>
          </div>
          
          <div class="timeline-item" id="year2020">
            <div class="timeline-number-white">8</div>
            <div class="timeline-content">
              <h3>2020 - Masa Pandemi</h3>
              <p>Selama pandemi COVID-19, Arduino melihat peningkatan penggunaan untuk proyek-proyek DIY dan pendidikan di rumah.</p>
              <p>Arduino Portenta H7 diluncurkan, board profesional untuk aplikasi industri dan embedded.</p>
              <p>Arduino menyediakan konten pembelajaran online gratis untuk membantu pembelajaran jarak jauh.</p>
            </div>
          </div>
          
          <div class="timeline-item" id="yearNow">
            <div class="timeline-number-white">9</div>
            <div class="timeline-content">
              <h3>Sekarang - Platform Global</h3>
              <p>Arduino menjadi platform standar untuk pendidikan STEM dan proyek IoT dengan jutaan board terjual.</p>
              <p>Ekosistem Arduino terus berkembang dengan board-board baru seperti Nano RP2040 Connect dan Giga R1 WiFi.</p>
              <p>Arduino Cloud menjadi platform terintegrasi untuk pemrograman, monitoring, dan kontrol perangkat IoT.</p>
              <p>Komunitas global Arduino terus tumbuh dengan ribuan proyek open-source yang dibagikan setiap tahun.</p>
            </div>
          </div>
	<div class="video-container linebox" style="margin-bottom: 30px; ">
  <h2 class="title-box-white">Video Sejarah Arduino</h2>

  
  <div class="video-wrapper">
    <iframe 
      width="100%" 
      height="450" 
           src="https://www.youtube.com/embed/cTPYUox41bU?autoplay=0" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen
      style="border-radius: 15px;"
    ></iframe>
  </div>
  
  <div class="video-description">
    <p style="color: rgba(255,255,255,0.8); line-height: 1.6; font-size: 25px;">
      Video ini menampilkan sejarah lengkap perkembangan Arduino dari awal hingga sekarang. 
      Anda akan melihat bagaimana platform ini berkembang dari proyek kecil di Italia menjadi 
      fenomena global yang mengubah cara orang belajar elektronik dan pemrograman.
    </p>
  </div>
</div>

<!-- Tambahkan ini sebelum div.bottom-line -->
<div class="footnotes-container linebox">
  <h3 class="title-box-white">Catatan Kaki</h3>
  
  <div class="footnotes-list">
    <div id="footnote1" class="footnote-item">
      <span class="footnote-number">[1]</span>
      <span class="footnote-text">Banzi, M. (2011). <em>Getting Started with Arduino</em>. Maker Media. <a href="" target="_blank" class="footnote-link"></a></span>
    </div>
    
    <div id="footnote2" class="footnote-item">
      <span class="footnote-number">[2]</span>
      <span class="footnote-text">Arduino LLC. (2008). <em>Arduino History Documentation</em>. <a href="" target="_blank" class="footnote-link"></a></span>
    </div>
    
    <!-- Tambahkan lebih banyak catatan kaki sesuai kebutuhan -->
  </div>
</div>


        </div>
      </div>
    </div>
  </div>



<div class="reaction-container linebox">
  <h3 class="title-box-white">Bagaimana perasaan Anda tentang konten ini?</h3>
  <div class="sidebar-line-white"></div>
  
  <div class="emoji-reactions">
    <div class="emoji-option" data-emoji="happy">
      <span class="emoji">😊</span>
      <span class="emoji-count" id="happy-count">0</span>
    </div>
    
    <div class="emoji-option" data-emoji="sad">
      <span class="emoji">😢</span>
      <span class="emoji-count" id="sad-count">0</span>
    </div>
    
    <div class="emoji-option" data-emoji="disappointed">
      <span class="emoji">😞</span>
      <span class="emoji-count" id="disappointed-count">0</span>
    </div>
    
    <div class="emoji-option" data-emoji="angry">
      <span class="emoji">😠</span>
      <span class="emoji-count" id="angry-count">0</span>
    </div>
    
    <div class="emoji-option" data-emoji="neutral">
      <span class="emoji">😐</span>
      <span class="emoji-count" id="neutral-count">0</span>
    </div>
  </div>
  
  <div class="sidebar-line-white" style="margin-top: 20px;"></div>
  <p class="reaction-message" style="color: rgba(255,255,255,0.7); font-size: 14px; text-align: center;">
    Terima kasih atas feedback Anda!
  </p>
  <p class="login-message" style="color: white; font-size: 14px; text-align: center; display: none;">
    Silakan login untuk memberikan reaksi
  </p>
</div>






<!-- Tambahkan ini sebelum div.bottom-line -->
<div class="comments-container linebox">
  <h2 class="title-box-white">Diskusi Arduino</h2>
  
  <!-- Form Komentar -->
  <div class="comment-form">
    <textarea id="commentInput" placeholder="Tulis komentar Anda tentang sejarah Arduino..." rows="3"></textarea>
    <button id="submitComment" class="comment-submit-btn">Kirim Komentar</button>
  </div>
  
  <!-- Filter Kategori -->
  <div class="comment-filters">
    <button class="filter-btn active" data-filter="all">Semua Komentar</button>
    <button class="filter-btn" data-filter="new">Baru (≤7 hari)</button>
    <button class="filter-btn" data-filter="old">Lama (>7 hari)</button>
  </div>
  
  <!-- Info Jumlah Komentar -->
  <div class="comment-count-info">
    <span id="totalComments">0</span> Komentar (<span id="newComments">0</span> baru, <span id="oldComments">0</span> lama)
  </div>
  
  <!-- Daftar Komentar -->
  <div class="comments-list" id="commentsList">
    <!-- Komentar akan dimuat di sini -->
  </div>
</div>




<!-- Modified Metadata Container -->
<div class="metadata-container linebox">
  <div style="display: flex; justify-content: space-between; color: rgba(255,255,255,0.8); font-size: 14px;">
    <div>
      <span style="font-weight: bold;">Penulis Data:</span> 
      <span id="dataAuthor">-</span>
    </div>
    <div>
      <span style="font-weight: bold;">Terakhir Diupdate:</span> 
      <span id="lastUpdated">-</span>
    </div>
  </div>
</div>













          <div class="bab-card">
            <div class="bab-title-box">Project Arduino</div>
            <div class="bab-desc-box">Dengan Arduino, banyak project dibuat seperti robotika, IoT, otomasi rumah, hingga alat bantu belajar interaktif.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Jenis Arduino</div>
            <div class="bab-desc-box">Terdapat banyak jenis board Arduino seperti Uno, Mega, Nano, yang memiliki spesifikasi berbeda sesuai kebutuhan.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Bahasa Pemrograman</div>
            <div class="bab-desc-box">Arduino menggunakan bahasa pemrograman C/C++ dengan IDE Arduino yang mudah dipelajari pemula.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
          <div class="bab-card">
            <div class="bab-title-box">Sensor & Modul</div>
            <div class="bab-desc-box">Arduino mendukung berbagai sensor & modul seperti sensor suhu, cahaya, motor driver, WiFi, dan lainnya.</div>
             <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
      






<!-- Improved Admin Edit Form -->
<div id="adminFormContainer" style="display: none; background: rgba(0,0,0,0.95); padding: 25px; border-radius: 15px; margin-top: 30px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 1px solid #444;">
  <h2 style="color: white; text-align: center; margin-bottom: 20px; font-size: 24px; border-bottom: 1px solid #444; padding-bottom: 10px;">Editor Konten Halaman 10</h2>
  
  <div id="adminAuth" style="margin-bottom: 20px; text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px;">
    <p style="color: white; margin-bottom: 15px; font-size: 16px;">Anda harus login sebagai admin untuk mengedit konten</p>
    <button id="adminLoginBtn" style="padding: 10px 20px; background: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; display: flex; align-items: center; margin: 0 auto;">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
        <polyline points="10 17 15 12 10 7"></polyline>
        <line x1="15" y1="12" x2="3" y2="12"></line>
      </svg>
      Login dengan Google
    </button>
  </div>
  
  <div id="adminControls" style="display: none;">
    <div style="color: white; margin-bottom: 20px; text-align: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px;">
      Login sebagai: <span id="adminEmail" style="font-weight: bold; color: #4CAF50;"></span>
      <button id="adminLogoutBtn" style="margin-left: 15px; padding: 5px 12px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
        Logout
      </button>
    </div>
    
    <!-- Tab Navigation -->
    <div class="admin-tabs" style="display: flex; margin-bottom: 15px; border-bottom: 1px solid #444;">
      <button class="admin-tab active" data-tab="content">Konten Utama</button>
      <button class="admin-tab" data-tab="metadata">Metadata</button>
    </div>
    
    <!-- Content Tab -->
    <div id="contentTab" class="admin-tab-content" style="display: block;">
      <h3 style="color: white; margin-bottom: 15px; font-size: 18px;">Edit Bagian Konten</h3>
      
      <!-- Section Selection -->
      <div style="margin-bottom: 20px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Pilih Bagian:</label>
        <select id="contentSection" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444; margin-bottom: 15px;">
          <option value="title">Judul Halaman</option>
          <option value="timeline">Timeline</option>
          <option value="video">Bagian Video</option>
          <option value="footnotes">Catatan Kaki</option>
          <option value="reactions">Bagian Reaksi</option>
          <option value="comments">Bagian Komentar</option>
          <option value="cards">Kartu Informasi</option>
        </select>
      </div>
      
      <!-- Content Editor -->
      <div id="editorContainer" style="margin-bottom: 20px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Editor Konten:</label>
        <textarea id="adminContentEditor" style="width: 100%; height: 300px; padding: 12px; border-radius: 5px; margin-bottom: 15px; background: #222; color: white; border: 1px solid #444; font-family: monospace; font-size: 14px; line-height: 1.5; white-space: pre; overflow-x: auto;"></textarea>
      </div>
    </div>
    
    <!-- Metadata Tab -->
    <div id="metadataTab" class="admin-tab-content" style="display: none;">
      <h3 style="color: white; margin-bottom: 15px; font-size: 18px;">Edit Metadata</h3>
      
      <div style="margin-bottom: 15px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Penulis:</label>
        <input type="text" id="authorInput" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444; margin-bottom: 15px;">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="color: white; display: block; margin-bottom: 8px;">Deskripsi Perubahan:</label>
        <textarea id="changeDescription" style="width: 100%; height: 100px; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444; margin-bottom: 15px;"></textarea>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
      <button id="adminPreviewBtn" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Preview
      </button>
      <button id="adminSaveBtn" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Simpan Perubahan
      </button>
      <button id="adminCancelBtn" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Batal
      </button>
    </div>
    
    <div id="adminStatus" style="margin-top: 20px; color: white; text-align: center; min-height: 20px; padding: 10px; border-radius: 4px;"></div>
  </div>
</div>

<!-- Overlay for admin form -->
<div id="adminOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000;"></div>

<!-- Button to toggle admin form -->
<button id="toggleAdminBtn" style="position: fixed; bottom: 30px; right: 30px; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 50%; cursor: pointer; z-index: 999; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 20h9"></path>
    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
  </svg>
</button>











<div class="bottom-line"></div>
    <div class="bottom-text">
      <!-- Link-link footer -->
      <div>
        <a href="#" class="tentangLink">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Tentang Kami
        </a>
      </div>
      <div>
        <a href="#" class="masukanLink">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Masukan
        </a>
      </div>
      <div>
        <a href="#" class="forumLink">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          Forum Diskusi
        </a>
      </div>
    </div>
	
  </div>









<div id="page11" style="display: none;">
  <div class="dashboard-container">
    <!-- Header Dashboard -->
    <div class="dashboard-header">
      <h1 style="color: white; font-size: 28px; margin-bottom: 20px;">Dashboard Pengguna</h1>
      <div class="dashboard-notification-bell" id="notificationBell">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span class="notification-badge" id="notificationBadge">0</span>
      </div>
    </div>

    <!-- Profil Pengguna -->
    <div class="dashboard-profile linebox">
      <div class="profile-header">
        <h2 class="title-box-white">Profil Saya</h2>
        <button id="editProfileBtn" class="edit-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
          </svg>
          Edit Profil
        </button>
      </div>
      
      <div class="profile-content">
        <div class="profile-picture-container">
          <img id="userProfilePicture" src="" alt="Foto Profil" class="profile-picture">
          <div class="profile-info">
            <h3 id="userDisplayName" style="color: white; margin-bottom: 5px;">Nama Pengguna</h3>
            <p id="userEmail" style="color: rgba(255,255,255,0.7); font-size: 14px;">email@contoh.com</p>
          </div>
        </div>
        
        <!-- Form Edit Profil (Awalnya tersembunyi) -->
        <div id="editProfileForm" style="display: none; margin-top: 20px;">
          <div style="margin-bottom: 15px;">
            <label style="color: white; display: block; margin-bottom: 5px;">Nama Tampilan</label>
            <input type="text" id="displayNameInput" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444;">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="color: white; display: block; margin-bottom: 5px;">Link Media Sosial</label>
            <div class="social-links-container">
              <div class="social-link-input">
                <span class="social-icon">🔗</span>
                <input type="url" id="twitterInput" placeholder="Twitter" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444;">
              </div>
              <div class="social-link-input">
                <span class="social-icon">🔗</span>
                <input type="url" id="instagramInput" placeholder="Instagram" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444;">
              </div>
              <div class="social-link-input">
                <span class="social-icon">🔗</span>
                <input type="url" id="githubInput" placeholder="GitHub" style="width: 100%; padding: 8px; border-radius: 4px; background: #333; color: white; border: 1px solid #444;">
              </div>
            </div>
          </div>
          
          <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
            <button id="cancelEditBtn" class="cancel-btn">Batal</button>
            <button id="saveProfileBtn" class="save-btn">Simpan</button>
          </div>
        </div>
        
        <!-- Info Profil (Awalnya ditampilkan) -->
        <div id="profileInfo" style="margin-top: 20px;">
          <div class="profile-detail">
            <span class="detail-label">Bergabung sejak:</span>
            <span class="detail-value" id="joinDate">Januari 2023</span>
          </div>
          
          <div class="profile-detail">
            <span class="detail-label">Media Sosial:</span>
            <div class="social-links" id="socialLinks">
              <!-- Link media sosial akan dimuat di sini -->
              <span style="color: rgba(255,255,255,0.7);">Tidak ada link media sosial</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  
  <div class="dashboard-notifications linebox">
    <div class="notifications-header">
        <h2 class="title-box-white">Notifikasi</h2>
        <div class="notification-actions">
            <button id="markAllReadBtn" class="small-btn">Tandai Sudah Dibaca</button>
            <button id="notificationSettingsBtn" class="small-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Pengaturan
            </button>
        </div>
    </div>
    
    <div class="notifications-list" id="notificationsList">
        <div class="notification-loader">
            <div class="loader"></div>
            <p>Memuat notifikasi...</p>
        </div>
    </div>
</div>




<div class="dashboard-activity linebox">
    <h2 class="title-box-white">Aktivitas Terkini</h2>
    
    <div class="activity-tabs">
        <button class="activity-tab active" data-tab="all">Semua Aktivitas</button>
        <button class="activity-tab" data-tab="comments">Komentar & Balasan</button>
        <button class="activity-tab" data-tab="reactions">Reaksi</button>
        <button class="activity-tab" data-tab="posts">Postingan</button>
    </div>
    
    <div class="activity-content">
        <div class="activity-tab-content active" id="allActivity">
            <div class="activity-loader">
                <div class="loader"></div>
                <p>Memuat aktivitas...</p>
            </div>
        </div>
        <div class="activity-tab-content" id="commentsActivity">
            <div class="activity-loader">
                <div class="loader"></div>
                <p>Memuat komentar...</p>
            </div>
        </div>
        <div class="activity-tab-content" id="reactionsActivity">
            <div class="activity-loader">
                <div class="loader"></div>
                <p>Memuat reaksi...</p>
            </div>
        </div>
        <div class="activity-tab-content" id="postsActivity">
            <div class="activity-loader">
                <div class="loader"></div>
                <p>Memuat postingan...</p>
            </div>
        </div>
    </div>
</div>
  
  
  
    
    <!-- Tombol Kembali -->
    <div style="text-align: center; margin-top: 30px;">
      <button id="backFromDashboard" class="back-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Kembali
      </button>
    </div>
  </div>
  
  <!-- Modal Pengaturan Notifikasi -->
  <div id="notificationSettingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Pengaturan Notifikasi</h3>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-item">
          <label class="switch">
            <input type="checkbox" id="emailNotifications" checked>
            <span class="slider round"></span>
          </label>
          <span>Notifikasi Email</span>
        </div>
        
        <div class="setting-item">
          <label class="switch">
            <input type="checkbox" id="pushNotifications" checked>
            <span class="slider round"></span>
          </label>
          <span>Notifikasi Push</span>
        </div>
        
        <div class="setting-item">
          <label class="switch">
            <input type="checkbox" id="activityNotifications" checked>
            <span class="slider round"></span>
          </label>
          <span>Notifikasi Aktivitas</span>
        </div>
        
        <div class="setting-item">
          <label class="switch">
            <input type="checkbox" id="announcementNotifications" checked>
            <span class="slider round"></span>
          </label>
          <span>Pengumuman</span>
        </div>
        
        <div class="setting-item">
          <label class="switch">
            <input type="checkbox" id="messageNotifications" checked>
            <span class="slider round"></span>
          </label>
          <span>Pesan</span>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveNotificationSettings" class="save-btn">Simpan</button>
        <button id="cancelNotificationSettings" class="cancel-btn">Batal</button>
      </div>
    </div>
  </div>
</div>




<!-- Halaman 12 - Sponsor -->
<div id="page12" style="display:none;">
  <div id="dynamicText" style="margin-top: 50px; font-size: 40px; font-weight: bold; color: #ffffff; text-align: center;"></div>
  
  <h1 style="color: white; font-size: 28px; margin-bottom: 20px; margin-left: 180px;">Sponsor Kami</h1>
  
  <div class="line-box" style="flex-direction: column; align-items: center; gap: 40px; padding: 40px;">
    <!-- Video TikTok Utama (Besar) -->
    <div style="width: 100%; max-width: 500px; margin: 0 auto;">
      <h2 style="color: white; font-size: 24px; margin-bottom: 20px; text-align: center;">Video Sponsor Utama</h2>
      <div style="width: 100%;">
        <iframe 
          src="https://www.tiktok.com/embed/v2/7533829578503179526" 
          style="width: 100%; height: 700px; border: none; border-radius: 15px; overflow: hidden;"
          allowfullscreen
          scrolling="no"
          allow="encrypted-media;"
        ></iframe>
      </div>
    </div>
    
  
    <!-- Info Menjadi Sponsor -->
    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 30px; max-width: 800px; text-align: center; margin-top: 50px;">
      <h2 style="color: white; font-size: 24px; margin-bottom: 15px;">Ingin Menjadi Sponsor?</h2>
      <p style="color: #ccc; font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
        Dukung pengembangan konten kami dengan menjadi sponsor.
      </p>
      <button id="contactSponsorBtn" style="
        padding: 12px 25px;
        background: linear-gradient(135deg, #4ea1ff, #0066ff);
        border: none;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        font-size: 16px;
      ">
        Hubungi Kami
      </button>
    </div>
  </div>
  
  <div class="bottom-line"></div>

  <div class="bottom-text">
    <div>
      <a href="#" class="tentangLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Tentang Kami
      </a>
    </div>
    <div>
      <a href="#" class="masukanLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Masukan
      </a>
    </div>
    <div>
      <a href="#" class="sponsorLink">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: 8px;">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
        Sponsor
      </a>
    </div>
  </div>

  <div class="nav-link">
    <a href="#" id="back-sponsor">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 5 5 12 12 19"></polyline>
      </svg>
      Kembali
    </a>
  </div>
</div>





<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, collectionGroup,  addDoc, onSnapshot, serverTimestamp, query, orderBy, deleteDoc, getDoc, writeBatch, setDoc, doc, updateDoc, where, getDocs, documentId, limit, increment, getCountFromServer, arrayUnion, 
    arrayRemove, deleteField, runTransaction, or } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, signOut, onAuthStateChanged, GoogleAuthProvider, setPersistence,
    browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAzgMVdqZhrqQ3PqiSWapaCl6oglF3QP64",
        authDomain: "life-is-what-it-is-learn.firebaseapp.com",
        projectId: "life-is-what-it-is-learn",
        storageBucket: "life-is-what-it-is-learn.appspot.com",
        messagingSenderId: "755474876167",
        appId: "1:755474876167:web:205fb4ea8c7b8d5b66e7a2"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(app);
	  const CONTENT_DOC_ID = 'page10_content';
    const ADMIN_EMAIL = "faridardiansyah061@gmail.com";








document.addEventListener("DOMContentLoaded", function () {
    // Variabel state
    let userProfile = {};
    let notifications = [];
    let activities = [];
    let unsubscribeFunctions = [];
	 let userRef = null;
	 
	 let currentActivities = []
	 let currentUnsubscribe = null; // agar bisa hentikan listener sebelumnya


 
    
    // DOM Elements
    const backFromDashboard = document.getElementById('backFromDashboard');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const editProfileForm = document.getElementById('editProfileForm');
    const profileInfo = document.getElementById('profileInfo');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const notificationBell = document.getElementById('notificationBell');
    const notificationBadge = document.getElementById('notificationBadge');
    const markAllReadBtn = document.getElementById('markAllReadBtn');
    const notificationSettingsBtn = document.getElementById('notificationSettingsBtn');
    const notificationSettingsModal = document.getElementById('notificationSettingsModal');
    const closeModal = document.querySelector('.close-modal');
 const saveNotificationSettingsBtn = document.getElementById('saveNotificationSettingsBtn');
    const cancelNotificationSettings = document.getElementById('cancelNotificationSettings');
	// Shared state untuk menghindari duplikasi notifikasi dan aktivitas
const processedActivityIds = new Set();
const processedNotificationIds = new Set();

	
	
	
	
	
    
    // Event Listeners
    backFromDashboard?.addEventListener('click', function() {
        showPageContent(document.getElementById("page1"));
        history.pushState({ page: "home" }, "Beranda", "/");
    });
    
    editProfileBtn?.addEventListener('click', function() {
        editProfileForm.style.display = 'block';
        profileInfo.style.display = 'none';
        // Isi form dengan data profil saat ini
        document.getElementById('displayNameInput').value = userProfile.displayName || '';
        document.getElementById('twitterInput').value = userProfile.socialLinks?.twitter || '';
        document.getElementById('instagramInput').value = userProfile.socialLinks?.instagram || '';
        document.getElementById('githubInput').value = userProfile.socialLinks?.github || '';
    });
    
    cancelEditBtn?.addEventListener('click', function() {
        editProfileForm.style.display = 'none';
        profileInfo.style.display = 'block';
    });
    
    saveProfileBtn?.addEventListener('click', saveProfile);
    
    notificationBell?.addEventListener('click', function() {
        // Tampilkan daftar notifikasi
    });
    
    markAllReadBtn?.addEventListener('click', markAllNotificationsAsRead);
    
    notificationSettingsBtn?.addEventListener('click', function() {
        notificationSettingsModal.style.display = 'block';
        loadNotificationSettings();
    });
    
    closeModal?.addEventListener('click', function() {
        notificationSettingsModal.style.display = 'none';
    });
    
    cancelNotificationSettings?.addEventListener('click', function() {
        notificationSettingsModal.style.display = 'none';
    });
    
  saveNotificationSettingsBtn?.addEventListener('click', saveNotificationSettings);

    

onAuthStateChanged(auth, (user) => {
    if (user) {
	
	  // Reset variabel saat user berubah
            activities = [];
            notifications = [];
            unsubscribeFunctions = [];
    
        
        // Load data awal
        loadUserProfile(user);
		
		
		        setupActivityTabs(user.uid);

        
        // Setup listeners
        unsubscribeFunctions.push(setupNotificationListeners(user.uid));
        unsubscribeFunctions.push(setupActivityListeners(user.uid));
        
        // Setup listeners untuk semua jenis aktivitas
        unsubscribeFunctions.push(loadNotifications(user.uid));
        unsubscribeFunctions.push(setupCommentListeners());
        unsubscribeFunctions.push(setupLikeListeners());
        unsubscribeFunctions.push(setupFeedbackListeners());
        unsubscribeFunctions.push(setupDiscussionListeners());
        unsubscribeFunctions.push(setupDiscussionCommentListeners());
        unsubscribeFunctions.push(setupAnnouncementListeners());
        unsubscribeFunctions.push(setupEmojiReactions());
        
        // Cleanup saat komponen unmount
        return () => {
            unsubscribeFunctions.forEach(unsub => {
                if (unsub && typeof unsub === 'function') {
                    unsub();
                }
            });
        };
    } else {
        // Handle case ketika user logout
        notifications = [];
        updateNotificationUI([], 0);
		 activities = [];
		  renderActivities([]);
    }
});	
	
	
	
	
	
	
	
	
	
	
async function createActivityNotification(activityType, activityData) {
  try {
    const currentUser = auth.currentUser;
    if (!currentUser) return;

    // Skip if already processed
    const activityKey = `${activityType}_${activityData.contentId}_${activityData.commentId || ''}_${currentUser.uid}`;
    if (processedNotificationIds.has(activityKey)) return;
    processedNotificationIds.add(activityKey);

    // Handle announcements separately (send to all users)
    if (activityType === 'announcement') {
      await sendAnnouncementToAllUsers(activityData, currentUser.uid);
      return;
    }

    // Determine recipient(s)
    let recipientIds = [];
    if (activityData.recipientId) {
      recipientIds = [activityData.recipientId];
    } else {
      const contentAuthorId = await getContentAuthorId(activityData);
      if (contentAuthorId) recipientIds = [contentAuthorId];
    }

    // Create notifications for each recipient
    for (const recipientId of recipientIds) {
      if (recipientId === currentUser.uid) continue; // Skip self-notifications

      const notificationRef = doc(collection(db, "notifications"));
      const notificationContent = generateNotificationContent(
        activityType, 
        activityData, 
        currentUser.displayName || 'Pengguna'
      );

      await setDoc(notificationRef, {
        id: notificationRef.id,
        userId: recipientId,
        type: activityType,
        read: false,
        timestamp: serverTimestamp(),
        fromUserId: currentUser.uid,
        fromUserName: currentUser.displayName || 'Pengguna',
        ...notificationContent
      });

      // Also log as activity for the recipient
      await logActivity({
        userId: recipientId,
        type: activityType,
        contentId: activityData.contentId,
        contentType: activityData.contentType,
        description: notificationContent.message,
        ...(activityData.emoji && { emoji: activityData.emoji })
      });
    }
  } catch (error) {
    console.error("Error in createActivityNotification:", error);
  }
}	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
function setupCommentListeners(userId) {
  // Listener untuk komentar sejarah Arduino
  const arduinoCommentsRef = collection(db, "arduinoHistoryComments");
  const unsubscribeArduino = onSnapshot(arduinoCommentsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newComment = change.doc.data();
        if (newComment.userId === userId) return;

        const recipientId = newComment.replyTo || newComment.contentAuthorId;
        if (!recipientId) return;

        createActivityNotification(newComment.replyTo ? 'reply' : 'comment', {
          contentType: 'arduinoHistory',
          contentId: newComment.historyId,
          commentId: change.doc.id,
          recipientId: recipientId,
          senderId: newComment.userId,
          senderName: newComment.userName || 'Pengguna'
        });

        logActivity({
          userId: newComment.userId,
          type: newComment.replyTo ? 'reply' : 'comment',
          contentId: newComment.historyId,
          contentType: 'arduinoHistory',
          description: newComment.replyTo 
            ? `Membalas komentar pada sejarah Arduino` 
            : `Mengomentari sejarah Arduino`,
          commentId: change.doc.id
        });
      }
    });
  });

  // Listener untuk komentar pengumuman
  const announcementCommentsRef = collection(db, "announcementComments");
  const unsubscribeAnnouncement = onSnapshot(announcementCommentsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newComment = change.doc.data();
        if (newComment.userId === userId) return;

        const recipientId = newComment.replyTo || ADMIN_EMAIL;
        createActivityNotification(newComment.replyTo ? 'reply' : 'comment', {
          contentType: 'announcements',
          contentId: newComment.announcementId,
          commentId: change.doc.id,
          recipientId: recipientId,
          senderId: newComment.userId,
          senderName: newComment.userName || 'Pengguna'
        });

        logActivity({
          userId: newComment.userId,
          type: newComment.replyTo ? 'reply' : 'comment',
          contentId: newComment.announcementId,
          contentType: 'announcements',
          description: newComment.replyTo 
            ? `Membalas komentar pada pengumuman` 
            : `Mengomentari pengumuman`,
          commentId: change.doc.id
        });
      }
    });
  });

  // Listener untuk komentar feedback
  const feedbackCommentsRef = collection(db, "feedbackComments");
  const unsubscribeFeedback = onSnapshot(feedbackCommentsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newComment = change.doc.data();
        if (newComment.userId === userId) return;

        const recipientId = newComment.replyTo || ADMIN_EMAIL;
        createActivityNotification(newComment.replyTo ? 'reply' : 'comment', {
          contentType: 'feedback',
          contentId: newComment.feedbackId,
          commentId: change.doc.id,
          recipientId: recipientId,
          senderId: newComment.userId,
          senderName: newComment.userName || 'Pengguna'
        });

        logActivity({
          userId: newComment.userId,
          type: newComment.replyTo ? 'reply' : 'comment',
          contentId: newComment.feedbackId,
          contentType: 'feedback',
          description: newComment.replyTo 
            ? `Membalas komentar pada feedback` 
            : `Mengomentari feedback`,
          commentId: change.doc.id
        });
      }
    });
  });

  return () => {
    unsubscribeArduino();
    unsubscribeAnnouncement();
    unsubscribeFeedback();
  };
}	
	
	
	
	
	
	
	
	
	
	
	
	
	

// Setup listener untuk like komentar
function setupCommentLikeListeners(userId) {
  const likesRef = collectionGroup(db, "likes");
  return onSnapshot(likesRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newLike = change.doc.data();
        if (newLike.userId === userId) return;

        // Dapatkan path lengkap untuk menentukan contentType
        const pathParts = change.doc.ref.path.split('/');
        if (pathParts.includes('arduinoHistoryComments')) {
          const commentId = pathParts[pathParts.length - 3];
          
          // Dapatkan data komentar
          getDoc(doc(db, "arduinoHistoryComments", commentId)).then(commentDoc => {
            if (commentDoc.exists()) {
              const commentData = commentDoc.data();
              createActivityNotification('like_comment', {
                contentType: 'arduinoHistory',
                contentId: commentData.historyId,
                commentId: commentId,
                recipientId: commentData.userId,
                senderId: newLike.userId,
                senderName: newLike.userName || 'Pengguna'
              });
            }
          });
        }
      }
    });
  });
}








function setupLikeListeners(userId) {
  const likesRef = collectionGroup(db, "likes");
  return onSnapshot(likesRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newLike = change.doc.data();
        if (newLike.userId === userId) return;

        const pathParts = change.doc.ref.path.split('/');
        let contentType = '';
        let contentId = '';
        let commentId = '';
        
        if (pathParts.includes('arduinoHistoryComments')) {
          contentType = 'arduinoHistory';
          commentId = pathParts[pathParts.indexOf('arduinoHistoryComments') + 1];
          contentId = pathParts[pathParts.indexOf('arduinoHistoryComments') - 1];
        } else if (pathParts.includes('announcementComments')) {
          contentType = 'announcements';
          commentId = pathParts[pathParts.indexOf('announcementComments') + 1];
          contentId = pathParts[pathParts.indexOf('announcementComments') - 1];
        } else if (pathParts.includes('feedbackComments')) {
          contentType = 'feedback';
          commentId = pathParts[pathParts.indexOf('feedbackComments') + 1];
          contentId = pathParts[pathParts.indexOf('feedbackComments') - 1];
        }

        if (!contentType || !contentId || !commentId) return;

        getDoc(change.doc.ref.parent.parent).then(commentDoc => {
          if (commentDoc.exists()) {
            const commentData = commentDoc.data();
            
            createActivityNotification('like_comment', {
              contentType: contentType,
              contentId: contentId,
              commentId: commentDoc.id,
              recipientId: commentData.userId,
              senderId: newLike.userId,
              senderName: newLike.userName || 'Pengguna'
            });

            logActivity({
              userId: newLike.userId,
              type: 'like_comment',
              contentId: contentId,
              contentType: contentType,
              description: `Menyukai komentar pada ${getContentTypeName(contentType)}`,
              commentId: commentDoc.id
            });
          }
        });
      }
    });
  });
}







// Setup listener untuk feedback
function setupFeedbackListeners() {
  const feedbackRef = collection(db, "feedback");
  return onSnapshot(feedbackRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newFeedback = change.doc.data();
        // Notifikasi untuk admin tentang feedback baru
        if (newFeedback.userId !== auth.currentUser?.uid) {
          createActivityNotification('feedback', {
            contentType: 'feedback',
            contentId: change.doc.id,
            recipientId: ADMIN_EMAIL
          });
        }
      }
    });
  });
}

// Setup listener untuk diskusi
function setupDiscussionListeners() {
  const discussionsRef = collection(db, "discussions");
  return onSnapshot(discussionsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newDiscussion = change.doc.data();
        // Notifikasi untuk admin tentang diskusi baru
        if (newDiscussion.authorId !== auth.currentUser?.uid) {
          createActivityNotification('discussion', {
            contentType: 'discussions',
            contentId: change.doc.id,
            recipientId: ADMIN_EMAIL
          });
        }
      }
    });
  });
}

// Setup listener untuk komentar diskusi
function setupDiscussionCommentListeners() {
  const commentsRef = collectionGroup(db, "comments");
  return onSnapshot(commentsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newComment = change.doc.data();
        if (newComment.userId === auth.currentUser?.uid) return;

        // Dapatkan diskusi induk
        getDoc(change.doc.ref.parent.parent).then(discussionDoc => {
          if (discussionDoc.exists()) {
            createActivityNotification(newComment.replyTo ? 'reply' : 'comment', {
              contentType: 'discussions',
              contentId: discussionDoc.id,
              commentId: change.doc.id,
              recipientId: discussionDoc.data().authorId,
              senderId: newComment.userId,
              senderName: newComment.userName || 'Pengguna'
            });
          }
        });
      }
    });
  });
}

// Setup listener untuk pengumuman
function setupAnnouncementListeners() {
  const announcementsRef = collection(db, "announcements");
  return onSnapshot(announcementsRef, (snapshot) => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const newAnnouncement = change.doc.data();
        // Kirim notifikasi ke semua user tentang pengumuman baru
        createActivityNotification('announcement', {
          contentType: 'announcements',
          contentId: change.doc.id,
          title: newAnnouncement.title,
          message: `Pengumuman baru: ${newAnnouncement.title}`
        });
      }
    });
  });
}






async function setupEmojiReactions(user, contentId = 'arduino-history') {
  const emojiOptions = document.querySelectorAll('.emoji-option');
  const reactionMessage = document.querySelector('.reaction-message');
  const loginMessage = document.querySelector('.login-message');

  reactionMessage.style.display = 'none';
  loginMessage.style.display = 'none';

  if (!user) {
    loginMessage.style.display = 'block';
    emojiOptions.forEach(option => {
      option.style.opacity = '0.5';
      option.style.cursor = 'not-allowed';
      option.addEventListener('click', e => {
        e.preventDefault();
        loginMessage.style.opacity = 1;
        setTimeout(() => loginMessage.style.opacity = 0.7, 2000);
      });
    });
    return;
  }

  const reactionDocRef = doc(db, 'reactions', contentId);
  const userReactionRef = doc(db, 'userReactions', `${user.uid}_${contentId}`);

  // Realtime listener for reaction counts
  onSnapshot(reactionDocRef, (snapshot) => {
    const data = snapshot.data() || {};
    emojiOptions.forEach(option => {
      const emojiType = option.dataset.emoji;
      const countEl = document.getElementById(`${emojiType}-count`);
      if (countEl) {
        countEl.textContent = data[emojiType] || 0;
      }
    });
  });

  // Check user's existing reaction
  let userReaction = null;
  const userReactionSnap = await getDoc(userReactionRef);
  if (userReactionSnap.exists()) {
    userReaction = userReactionSnap.data().emojiType;
    const selected = document.querySelector(`.emoji-option[data-emoji="${userReaction}"]`);
    if (selected) selected.classList.add('selected');
  }

  emojiOptions.forEach(option => {
    option.addEventListener('click', async function() {
      const emojiType = this.dataset.emoji;
      if (userReaction === emojiType) return;

      emojiOptions.forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');

      const updates = {};
      if (userReaction) updates[userReaction] = increment(-1);
      updates[emojiType] = increment(1);

      // Update reaction counts
      await updateDoc(reactionDocRef, updates).catch(async () => {
        await setDoc(reactionDocRef, updates, { merge: true });
      });

      // Update user's reaction
      await setDoc(userReactionRef, {
        userId: user.uid,
        contentId: contentId,
        emojiType: emojiType,
        timestamp: serverTimestamp()
      });

      userReaction = emojiType;

      // Create notification for content owner
      const contentDoc = await getDoc(doc(db, 'arduinoHistory', contentId));
      if (contentDoc.exists()) {
        const contentOwnerId = contentDoc.data().userId;
        if (contentOwnerId !== user.uid) {
          await createActivityNotification('reaction', {
            contentType: 'arduinoHistory',
            contentId: contentId,
            recipientId: contentOwnerId,
            emoji: emojiType,
            senderId: user.uid,
            senderName: user.displayName || 'Pengguna'
          });
        }
      }

      // Log activity
      await logActivity({
        userId: user.uid,
        type: 'reaction',
        contentId: contentId,
        contentType: 'arduinoHistory',
        description: `Memberikan reaksi ${emojiType} pada sejarah Arduino`,
        emoji: emojiType
      });

      // Show success message
      reactionMessage.style.display = 'block';
      reactionMessage.style.opacity = 1;
      setTimeout(() => reactionMessage.style.opacity = 0.7, 2000);
    });
  });
}








// Setup listener untuk upload konten
function setupContentUploadListeners(userId) {
  const contentTypes = ['arduinoHistory', 'announcements', 'feedback', 'discussions'];
  const unsubscribeFunctions = [];
  
  contentTypes.forEach(type => {
    const ref = collection(db, type);
    const unsubscribe = onSnapshot(ref, (snapshot) => {
      snapshot.docChanges().forEach(change => {
        if (change.type === "added") {
          const newContent = change.doc.data();
          if (newContent.userId === userId) return;

          // Untuk admin saja jika bukan pengumuman
          if (type !== 'announcements') {
            createActivityNotification('content', {
              contentType: type,
              contentId: change.doc.id,
              recipientId: ADMIN_EMAIL,
              senderId: newContent.userId,
              senderName: newContent.userName || 'Pengguna',
              title: newContent.title || 'Konten Baru'
            });
          }
        }
      });
    });
    unsubscribeFunctions.push(unsubscribe);
  });
  
  return () => unsubscribeFunctions.forEach(fn => fn());
}




	
	
	
	
	function setupActivityTabs(userId) {
  document.querySelectorAll('.activity-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const filter = this.dataset.tab;
      
      // Update UI
      document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.activity-tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(`${filter}Activity`).classList.add('active');

      // Load appropriate data
      if (currentUnsubscribe) currentUnsubscribe();
      
      switch(filter) {
        case 'comments':
          currentUnsubscribe = setupActivitiesListener(
            query(
              collection(db, "activities"),
              where("type", "in", ["comment", "reply", "like_comment"]),
              where("contentType", "in", ["announcements", "feedback", "arduinoHistory"]),
              orderBy("timestamp", "desc"),
              limit(15)
            ),
            'comments'
          );
          break;
          
        case 'reactions':
          currentUnsubscribe = setupActivitiesListener(
            query(
              collection(db, "activities"),
              where("type", "==", "reaction"),
              where("contentType", "==", "arduinoHistory"),
              orderBy("timestamp", "desc"),
              limit(15)
            ),
            'reactions'
          );
          break;
          
        case 'posts':
          currentUnsubscribe = setupActivitiesListener(
            query(
              collection(db, "activities"),
              where("type", "in", ["post", "feedback", "discussion", "announcement", "content"]),
              orderBy("timestamp", "desc"),
              limit(15)
            ),
            'posts'
          );
          break;
          
        default:
          currentUnsubscribe = setupActivitiesListener(
            query(
              collection(db, "activities"),
              orderBy("timestamp", "desc"),
              limit(15)
            ),
            'all'
          );
      }
    });
  });

  // Load initial data
  currentUnsubscribe = setupActivitiesListener(
    query(
      collection(db, "activities"),
      orderBy("timestamp", "desc"),
      limit(15)
    ),
    'all'
  );
}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	



// Fungsi untuk mengelola komentar dengan notifikasi terintegrasi
function setupComments() {
  const commentsCollection = collection(db, "arduinoHistoryComments");
  const commentsList = document.getElementById("commentsList");
  const commentInput = document.getElementById("commentInput");
  const submitComment = document.getElementById("submitComment");
  const filterButtons = document.querySelectorAll(".filter-btn");
  const totalCommentsSpan = document.getElementById("totalComments");
  const newCommentsSpan = document.getElementById("newComments");
  const oldCommentsSpan = document.getElementById("oldComments");
  
  let currentFilter = "all";
  let commentsData = [];
  let commentCounts = { total: 0, new: 0, old: 0 };
  
  // Format waktu untuk ditampilkan
  function formatTime(timestamp) {
    const now = new Date();
    let commentDate;

    if (!timestamp) return "waktu tidak tersedia";
    if (typeof timestamp.toDate === "function") {
      commentDate = timestamp.toDate();
    } else if (timestamp instanceof Date) {
      commentDate = timestamp;
    } else {
      commentDate = new Date(timestamp);
    }

    const diffInSeconds = Math.floor((now - commentDate) / 1000);

    if (diffInSeconds < 60) return "baru saja";
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit lalu`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam lalu`;
    if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} hari lalu`;

    return commentDate.toLocaleDateString("id-ID", {
      day: "numeric",
      month: "long",
      year: "numeric"
    });
  }

  // Cek apakah komentar termasuk baru (≤ 7 hari)
  function isNewComment(timestamp) {
    if (!timestamp) return false;
    const now = new Date();
    const commentDate = (timestamp.toDate && typeof timestamp.toDate === 'function')
      ? timestamp.toDate()
      : new Date(timestamp);
    const diffInDays = Math.floor((now - commentDate) / (1000 * 60 * 60 * 24));
    return diffInDays <= 7;
  }

  // Fungsi untuk render komentar
  async function renderComments() {
    commentsList.innerHTML = "";
    commentCounts = { total: 0, new: 0, old: 0 };
    
    // Filter komentar berdasarkan kategori
    const filteredComments = commentsData.filter(comment => {
      if (currentFilter === "all") return true;
      if (currentFilter === "new") return isNewComment(comment.timestamp);
      if (currentFilter === "old") return !isNewComment(comment.timestamp);
      return true;
    });
    
    // Urutkan dari yang terbaru
    filteredComments.sort((a, b) => {
      const timeA = a.timestamp?.toDate ? a.timestamp.toDate().getTime() : new Date(a.timestamp).getTime();
      const timeB = b.timestamp?.toDate ? b.timestamp.toDate().getTime() : new Date(b.timestamp).getTime();
      return timeB - timeA;
    });
    
    // Render setiap komentar
    for (const comment of filteredComments) {
      const isNew = isNewComment(comment.timestamp);
      if (isNew) commentCounts.new++;
      else commentCounts.old++;
      commentCounts.total++;
      
      const commentElement = document.createElement("div");
      commentElement.className = "comment-item";
      commentElement.dataset.id = comment.id;
      
      // Dapatkan data pengguna untuk avatar
      let userName = "Pengguna";
      let userInitials = "P";
      try {
        if (comment.userId) {
          const userDoc = await getDoc(doc(db, "users", comment.userId));
          if (userDoc.exists()) {
            userName = userDoc.data().displayName || comment.userName || userDoc.data().email.split("@")[0] || "Pengguna";
          } else {
            userName = comment.userName || "Pengguna";
          }
        } else {
          userName = comment.userName || "Pengguna";
        }
        userInitials = userName.split(" ").map(n => n[0]).join("").substring(0, 2).toUpperCase();
      } catch (error) {
        console.error("Error fetching user data:", error);
      }
      
      commentElement.innerHTML = `
        <div class="comment-header">
          <div class="comment-avatar">${userInitials}</div>
          <div class="comment-user">${userName}</div>
          <div class="comment-time">${formatTime(comment.timestamp)}</div>
          ${isNew ? '<span class="new-badge">BARU</span>' : ''}
        </div>
        <div class="comment-content">${comment.content}</div>
        <div class="comment-actions">
          <div class="comment-action reply-btn" data-id="${comment.id}">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            Balas
          </div>
          <div class="comment-action like-btn" data-id="${comment.id}">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
            </svg>
            <span class="like-count">${comment.likes || 0}</span>
          </div>
        </div>
        <div class="reply-form" id="replyForm-${comment.id}">
          <textarea placeholder="Tulis balasan Anda..." rows="2"></textarea>
          <button class="reply-submit-btn" data-id="${comment.id}">Kirim Balasan</button>
        </div>
        ${comment.replies && comment.replies.length > 0 ? `
          <div class="replies-container" id="replies-${comment.id}">
            ${(await Promise.all(comment.replies.map(async reply => {
              let replyUserName = reply.userName || "Pengguna";
              let replyInitials = replyUserName.split(" ").map(n => n[0]).join("").substring(0, 2).toUpperCase();
              
              try {
                if (reply.userId) {
                  const replyUserDoc = await getDoc(doc(db, "users", reply.userId));
                  if (replyUserDoc.exists()) {
                    replyUserName = replyUserDoc.data().displayName || reply.userName || replyUserDoc.data().email.split("@")[0] || "Pengguna";
                    replyInitials = replyUserName.split(" ").map(n => n[0]).join("").substring(0, 2).toUpperCase();
                  }
                }
              } catch (error) {
                console.error("Error fetching reply user data:", error);
              }
              
              return `
                <div class="comment-item reply-item" data-id="${reply.id}" data-parent="${comment.id}">
                  <div class="comment-header">
                    <div class="comment-avatar">${replyInitials}</div>
                    <div class="comment-user">${replyUserName}</div>
                    <div class="comment-time">${formatTime(reply.timestamp)}</div>
                    ${isNewComment(reply.timestamp) ? '<span class="new-badge">BARU</span>' : ''}
                  </div>
                  <div class="comment-content">${reply.content}</div>
                  <div class="comment-actions">
                    <div class="comment-action like-btn" data-id="${reply.id}" data-parent="${comment.id}">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                      </svg>
                      <span class="like-count">${reply.likes || 0}</span>
                    </div>
                  </div>
                </div>
              `;
            }))).join("")}
          </div>
        ` : ''}
      `;
      
      commentsList.appendChild(commentElement);
    }
    
    // Update counter
    totalCommentsSpan.textContent = commentCounts.total;
    newCommentsSpan.textContent = commentCounts.new;
    oldCommentsSpan.textContent = commentCounts.old;
    
    // Setup event listeners untuk tombol balas
    document.querySelectorAll(".reply-btn").forEach(btn => {
      btn.addEventListener("click", function() {
        const commentId = this.dataset.id;
        const replyForm = document.getElementById(`replyForm-${commentId}`);
        replyForm.classList.toggle("active");
        
        // Auto-focus textarea ketika form dibuka
        if (replyForm.classList.contains("active")) {
          replyForm.querySelector("textarea").focus();
        }
      });
    });
    
    // Setup event listeners untuk tombol kirim balasan
    document.querySelectorAll(".reply-submit-btn").forEach(btn => {
      btn.addEventListener("click", async function() {
        const commentId = this.dataset.id;
        const replyForm = document.getElementById(`replyForm-${commentId}`);
        const textarea = replyForm.querySelector("textarea");
        const content = textarea.value.trim();
        
        if (!content) {
          alert("Balasan tidak boleh kosong");
          return;
        }
        
        const user = auth.currentUser;
        if (!user) {
          alert("Anda harus login untuk membalas komentar");
          return;
        }
        
        // Dapatkan data pengguna
        let userName = "Pengguna";
        try {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            userName = userDoc.data().displayName || user.email.split("@")[0];
          } else {
            userName = user.email.split("@")[0];
          }
        } catch (error) {
          console.error("Error getting user data:", error);
          userName = user.email.split("@")[0];
        }
        
        // Buat data balasan
      const replyData = {
  id: doc(commentsCollection).id,
  content,
  userName,
  userId: user.uid,
  likes: 0,
  timestamp: new Date() // ✅ timestamp yang valid untuk arrayUnion
};

        
        try {
          // Tambahkan balasan ke Firestore
          await updateDoc(doc(commentsCollection, commentId), {
            replies: arrayUnion(replyData),
            lastUpdated: serverTimestamp()
          });
          
          // Dapatkan komentar induk untuk notifikasi
          const parentComment = commentsData.find(c => c.id === commentId);
          if (parentComment && parentComment.userId !== user.uid) {
            // Kirim notifikasi ke pemilik komentar
            await createActivityNotification(
              parentComment.userId,
              "reply",
              user.uid,
              userName,
              content,
              "arduino-history",
              commentId
            );
          }
          
          textarea.value = "";
          replyForm.classList.remove("active");
        } catch (error) {
          console.error("Error adding reply:", error);
          alert("Gagal mengirim balasan");
        }
      });
    });
    
    // Setup event listeners untuk tombol like
    document.querySelectorAll(".like-btn").forEach(btn => {
      btn.addEventListener("click", async function() {
        const commentId = this.dataset.id;
        const parentId = this.dataset.parent;
        const user = auth.currentUser;
        
        if (!user) {
          alert("Anda harus login untuk menyukai komentar");
          return;
        }
        
        try {
          if (parentId) {
            // Like pada balasan
            const commentRef = doc(commentsCollection, parentId);
            await runTransaction(db, async (transaction) => {
              const commentDoc = await transaction.get(commentRef);
              const replies = commentDoc.data().replies || [];
              const replyIndex = replies.findIndex(r => r.id === commentId);
              
              if (replyIndex === -1) return;
              
              const updatedReplies = [...replies];
              updatedReplies[replyIndex] = {
                ...updatedReplies[replyIndex],
                likes: (updatedReplies[replyIndex].likes || 0) + 1
              };
              
              transaction.update(commentRef, { replies: updatedReplies });
              
              // Kirim notifikasi like untuk balasan
              const repliedComment = updatedReplies[replyIndex];
              if (repliedComment.userId && repliedComment.userId !== user.uid) {
                await createActivityNotification(
                  repliedComment.userId,
                  "like",
                  user.uid,
                  user.displayName || user.email.split("@")[0],
                  "",
                  "arduino-history",
                  parentId
                );
              }
            });
          } else {
            // Like pada komentar utama
            const commentRef = doc(commentsCollection, commentId);
            await runTransaction(db, async (transaction) => {
              const commentDoc = await transaction.get(commentRef);
              const currentLikes = commentDoc.data().likes || 0;
              
              transaction.update(commentRef, {
                likes: currentLikes + 1
              });
              
              // Kirim notifikasi like untuk komentar utama
              if (commentDoc.data().userId && commentDoc.data().userId !== user.uid) {
                await createActivityNotification(
                  commentDoc.data().userId,
                  "like",
                  user.uid,
                  user.displayName || user.email.split("@")[0],
                  "",
                  "arduino-history",
                  commentId
                );
              }
            });
          }
        } catch (error) {
          console.error("Error liking comment:", error);
          alert("Gagal menyukai komentar");
        }
      });
    });
  }
  
  // Load komentar dari Firestore
  const unsubscribe = onSnapshot(commentsCollection, (snapshot) => {
    commentsData = snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data(),
      timestamp: doc.data().timestamp || doc.data().lastUpdated || serverTimestamp()
    }));
    renderComments();
  });
  
  // Event listener untuk submit komentar baru
  submitComment.addEventListener("click", async () => {
    const content = commentInput.value.trim();
    if (!content) {
      alert("Komentar tidak boleh kosong");
      return;
    }
    
    const user = auth.currentUser;
    if (!user) {
      alert("Anda harus login untuk berkomentar");
      return;
    }
    
    // Dapatkan data pengguna
    let userName = "Pengguna";
    try {
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        userName = userDoc.data().displayName || user.email.split("@")[0];
      } else {
        userName = user.email.split("@")[0];
      }
    } catch (error) {
      console.error("Error getting user data:", error);
      userName = user.email.split("@")[0];
    }
    
    try {
      // Tambahkan komentar baru ke Firestore
      const newCommentRef = await addDoc(commentsCollection, {
        content,
        userName,
        userId: user.uid,
        timestamp: serverTimestamp(),
        likes: 0,
        replies: []
      });
      
      // Kirim notifikasi ke admin/pemilik konten
      // Ganti 'admin-user-id' dengan ID admin/pemilik konten yang sebenarnya
      const contentOwnerId = "9k1G7CiLZWNCkadVn3m8ZZRaQwg1"; 
      if (contentOwnerId !== user.uid) {
        await createActivityNotification(
          contentOwnerId,
          "comment",
          user.uid,
          userName,
          content,
          "arduino-history",
          newCommentRef.id
        );
      }
      
      commentInput.value = "";
      submitComment.disabled = true;
    } catch (error) {
      console.error("Error adding comment:", error);
      alert("Gagal mengirim komentar");
    }
  });
  
  // Event listener untuk filter
  filterButtons.forEach(btn => {
    btn.addEventListener("click", function() {
      filterButtons.forEach(b => b.classList.remove("active"));
      this.classList.add("active");
      currentFilter = this.dataset.filter;
      renderComments();
    });
  });
  
  // Enable/disable submit button berdasarkan input
  commentInput.addEventListener("input", () => {
    submitComment.disabled = commentInput.value.trim() === "";
  });
  
  // Handle Enter key untuk submit komentar
  commentInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      submitComment.click();
    }
  });
  
  // Return fungsi cleanup
  return () => {
    unsubscribe();
  };
}

// Panggil setupComments saat halaman dimuat dan user login
let commentsUnsubscribe = null;
onAuthStateChanged(auth, (user) => {
  if (commentsUnsubscribe) {
    commentsUnsubscribe();
  }
  
  if (user) {
    commentsUnsubscribe = setupComments();
  } else {
    // Tampilkan pesan login jika belum login
    document.getElementById("commentsList").innerHTML = `
      <div class="login-message">
        <p>Silakan login untuk melihat dan menambahkan komentar</p>
        <button id="loginButton" class="login-btn">Login</button>
      </div>
    `;
    
    document.getElementById("loginButton")?.addEventListener("click", () => {
      // Implementasi login sesuai kebutuhan
      showPageContent(document.getElementById("pageLogin"));
    });
  }
});

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

document.querySelectorAll('.activity-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    const tabType = tab.dataset.tab;
    document.querySelectorAll('.activity-tab-content').forEach(el => el.classList.remove('active'));
    document.getElementById(`${tabType}Activity`).classList.add('active');

    // Render ulang dengan filter
    renderActivities(currentActivities, tabType);
  });
});














// Perbaikan fungsi switchActivityTab
function switchActivityTab(tabName) {
    if (!activities) activities = []; // Pastikan activities terdefinisi
    
    // Update UI tab
    document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.activity-tab[data-tab="${tabName}"]`).classList.add('active');
    
    // Update konten
    document.querySelectorAll('.activity-tab-content').forEach(c => c.classList.remove('active'));
    document.getElementById(`${tabName}Activity`).classList.add('active');
    
    // Render ulang dengan filter
    renderActivities(activities, tabName);
}


	
	
	
	async function logActivity({ type, contentId, contentType, description }) {
  const user = auth.currentUser;
  if (!user) return;

  const activity = {
    userId: user.uid,
    userName: user.displayName,
    userPhoto: user.photoURL || "",
    type, // e.g. "comment", "reply", "like", "emoji", "upload"
    contentId,
    contentType, // e.g. "announcement", "arduinoHistory", "discussion", "feedback"
    description,
    timestamp: serverTimestamp()
  };

  await addDoc(collection(db, "activities"), activity);
}
	
	
	
	
	
	
    // Fungsi untuk memuat profil pengguna
    function loadUserProfile(user) {
        if (!user) return;
        
        // Set user reference
        userRef = doc(db, "users", user.uid);
        
        // Gunakan data dari Firebase Auth
        const profilePicture = document.getElementById('userProfilePicture');
        const displayName = document.getElementById('userDisplayName');
        const userEmail = document.getElementById('userEmail');
        
        profilePicture.src = user.photoURL || 'https://via.placeholder.com/150';
        displayName.textContent = user.displayName || 'Pengguna';
        userEmail.textContent = user.email;
        
        // Ambil data tambahan dari Firestore
        getDoc(userRef).then(docSnap => {
            if (docSnap.exists()) {
                userProfile = docSnap.data();
                
                // Format tanggal bergabung (gunakan metadata dari Firebase Auth jika tidak ada di Firestore)
                const joinDate = userProfile.joinDate?.toDate() || new Date(user.metadata.creationTime);
                const formattedDate = joinDate.toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long'
                });
                
                document.getElementById('joinDate').textContent = formattedDate;
                
                // Tampilkan link media sosial
                updateSocialLinksUI();
                
            } else {
                // Buat dokumen pengguna baru jika belum ada
                const userData = {
                    displayName: user.displayName || '',
                    email: user.email,
                    photoURL: user.photoURL || '',
                    joinDate: new Date(user.metadata.creationTime),
                    notificationSettings: {
                        email: true,
                        push: true,
                        activity: true,
                        announcements: true,
                        messages: true
                    },
                    socialLinks: {}
                };
                
                setDoc(userRef, userData).then(() => {
                    userProfile = userData;
                    updateSocialLinksUI();
                }).catch(error => {
                    console.error("Error creating user document:", error);
                });
            }
        }).catch(error => {
            console.error("Error loading user profile:", error);
        });
    }
    
    // Fungsi untuk memperbarui tampilan link media sosial
    function updateSocialLinksUI() {
        const socialLinksContainer = document.getElementById('socialLinks');
        socialLinksContainer.innerHTML = '';
        
        if (userProfile.socialLinks && 
            (userProfile.socialLinks.twitter || 
             userProfile.socialLinks.instagram || 
             userProfile.socialLinks.github)) {
            
            const { twitter, instagram, github } = userProfile.socialLinks;
            
            if (twitter) {
                const twitterLink = createSocialLink('Twitter', twitter, 'https://twitter.com');
                socialLinksContainer.appendChild(twitterLink);
            }
            
            if (instagram) {
                const instagramLink = createSocialLink('Instagram', instagram, 'https://instagram.com');
                socialLinksContainer.appendChild(instagramLink);
            }
            
            if (github) {
                const githubLink = createSocialLink('GitHub', github, 'https://github.com');
                socialLinksContainer.appendChild(githubLink);
            }
        } else {
            socialLinksContainer.innerHTML = '<span style="color: rgba(255,255,255,0.7);">Tidak ada link media sosial</span>';
        }
    }
    
    // Fungsi pembantu untuk membuat elemen link media sosial
    function createSocialLink(platform, url, baseUrl) {
        const linkContainer = document.createElement('div');
        linkContainer.style.display = 'flex';
        linkContainer.style.alignItems = 'center';
        linkContainer.style.marginBottom = '5px';
        
        const icon = document.createElement('span');
        icon.textContent = '🔗';
        icon.style.marginRight = '8px';
        
        const link = document.createElement('a');
        link.href = url.startsWith('http') ? url : `${baseUrl}/${url}`;
        link.textContent = platform;
        link.className = 'social-link';
        link.target = '_blank';
        link.style.color = '#4da6ff';
        link.style.textDecoration = 'none';
        
        linkContainer.appendChild(icon);
        linkContainer.appendChild(link);
        
        return linkContainer;
    }
    
    // Fungsi untuk menyimpan profil
    function saveProfile() {
        const user = auth.currentUser;
        if (!user || !userRef) {
            showToast('Anda harus login untuk menyimpan profil');
            return;
        }
        
        const displayName = document.getElementById('displayNameInput').value.trim();
        const twitter = document.getElementById('twitterInput').value.trim();
        const instagram = document.getElementById('instagramInput').value.trim();
        const github = document.getElementById('githubInput').value.trim();
        
        // Validasi input
        if (!displayName) {
            showToast('Nama tampilan tidak boleh kosong');
            return;
        }
        
        // Validasi URL sosial media
        const socialLinks = {};
        if (twitter && !isValidUrl(twitter)) {
            showToast('URL Twitter tidak valid');
            return;
        }
        if (twitter) socialLinks.twitter = twitter;
        
        if (instagram && !isValidUrl(instagram)) {
            showToast('URL Instagram tidak valid');
            return;
        }
        if (instagram) socialLinks.instagram = instagram;
        
        if (github && !isValidUrl(github)) {
            showToast('URL GitHub tidak valid');
            return;
        }
        if (github) socialLinks.github = github;
        
        // Update data di Firestore
        updateDoc(userRef, {
            displayName,
            socialLinks
        }).then(() => {
            // Update UI
            userProfile.displayName = displayName;
            userProfile.socialLinks = socialLinks;
            
            document.getElementById('userDisplayName').textContent = displayName || 'Pengguna';
            updateSocialLinksUI();
            
            editProfileForm.style.display = 'none';
            profileInfo.style.display = 'block';
            
            showToast('Profil berhasil diperbarui');
        }).catch(error => {
            console.error('Error updating profile:', error);
            showToast('Gagal memperbarui profil');
        });
    }
    
    
	
	  // Fungsi untuk memvalidasi URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }



     // Fungsi untuk membersihkan data dashboard saat logout
        function clearDashboardData() {
            document.getElementById('notificationsList').innerHTML = `
                <div class="empty-notifications">
                    <p style="color: rgba(255,255,255,0.7); text-align: center;">Silakan login untuk melihat notifikasi</p>
                </div>
            `;
            
            document.getElementById('allActivity').innerHTML = `
                <div class="empty-state">
                    <p style="color: rgba(255,255,255,0.7); text-align: center;">Silakan login untuk melihat aktivitas</p>
                </div>
            `;
            
            document.getElementById('commentsActivity').innerHTML = `
                <div class="empty-state">
                    <p style="color: rgba(255,255,255,0.7); text-align: center;">Silakan login untuk melihat komentar</p>
                </div>
            `;
            
            document.getElementById('reactionsActivity').innerHTML = `
                <div class="empty-state">
                    <p style="color: rgba(255,255,255,0.7); text-align: center;">Silakan login untuk melihat reaksi</p>
                </div>
            `;
            
            document.getElementById('postsActivity').innerHTML = `
                <div class="empty-state">
                    <p style="color: rgba(255,255,255,0.7); text-align: center;">Silakan login untuk melihat postingan</p>
                </div>
            `;
            
            notificationBadge.textContent = '0';
            notificationBadge.style.display = 'none';
        }
		
		
		
		
		    // Fungsi untuk toggle tampilan notifikasi
        function toggleNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.classList.toggle('show');
        }






    
    
	
	    // Fungsi untuk menampilkan toast/pemberitahuan
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = '#4CAF50';
            toast.style.color = 'white';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '5px';
            toast.style.zIndex = '1000';
            toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 3000);
        }
	
	
	
	
	
	
	function loadNotifications(userId) {
    if (!userId) return;
    
    const notificationsRef = collection(db, "notifications");
    const q = query(notificationsRef, 
        where("userId", "==", userId),
        orderBy("timestamp", "desc"),
        limit(20)
    );
    
    const unsubscribe = onSnapshot(q, (snapshot) => {
        notifications = [];
        let unreadCount = 0;
        
        snapshot.forEach(doc => {
            const data = doc.data();
            notifications.push({
                id: doc.id,
                message: data.message,
                type: data.type || 'general',
                read: data.read || false,
                timestamp: data.timestamp.toDate(),
                link: data.link || null,
                senderId: data.senderId || null,
                senderName: data.senderName || 'Pengguna',
                targetType: data.targetType || null,
                targetId: data.targetId || null
            });
            
            if (!data.read) unreadCount++;
        });

        updateNotificationUI(notifications, unreadCount);
    });
    
    return unsubscribe;
}
	
	
	
	
	
	
	
	   // Fungsi untuk memperbarui tampilan notifikasi
        function updateNotificationUI(notifications, unreadCount) {
            const notificationList = document.getElementById('notificationsList');
            const badge = document.getElementById('notificationBadge');
            
            badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            
            if (notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="empty-notifications">
                        <p style="color: rgba(255,255,255,0.7); text-align: center;">Tidak ada notifikasi</p>
                    </div>
                `;
                return;
            }
            
            notificationList.innerHTML = notifications.map(notif => `
                <div class="notification-item ${notif.read ? '' : 'unread'}" 
                     data-id="${notif.id}" 
                     data-type="${notif.type}"
                     data-content-type="${notif.contentType || ''}"
                     data-content-id="${notif.contentId || ''}"
                     data-comment-id="${notif.commentId || ''}">
                    <div class="notification-icon">
                        ${getNotificationIcon(notif.type)}
                    </div>
                    <div class="notification-content">
                        <p>${notif.message || 'Notifikasi baru'}</p>
                        <small>${formatTimeAgo(notif.timestamp)}</small>
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const notifId = this.getAttribute('data-id');
                    const type = this.getAttribute('data-type');
                    const contentType = this.getAttribute('data-content-type');
                    const contentId = this.getAttribute('data-content-id');
                    const commentId = this.getAttribute('data-comment-id');
                    
                    if (this.classList.contains('unread')) {
                        markNotificationAsRead(notifId);
                    }
                    
                    showActivityDetail(type, contentId, commentId);
                });
            });
        }

	
	
	
	
	
	
	
	
	
	
	
function setupOptimizedListeners() {
    // Gabungkan beberapa listener yang terkait
    const combinedRef = collectionGroup(db, "activities");
    return onSnapshot(combinedRef, (snapshot) => {
        snapshot.docChanges().forEach(change => {
            if (change.type === "added" && !processedActivityIds.has(change.doc.id)) {
                processedActivityIds.add(change.doc.id);
                const activity = change.doc.data();
                
                // Deteksi jenis aktivitas
                if (change.doc.ref.parent.parent.id === 'comments') {
                    handleCommentActivity(activity, change.doc.id);
                } else if (change.doc.ref.parent.parent.id === 'likes') {
                    handleLikeActivity(activity, change.doc.id);
                }
                // Tambahkan pengecekan lainnya
            }
        });
    });
}

function handleCommentActivity(activity, activityId) {
    if (activity.userId !== auth.currentUser?.uid) {
        createActivityNotification('comment', {
            contentType: activity.contentType,
            contentId: activity.contentId,
            commentId: activityId,
            recipientId: activity.replyTo || activity.contentAuthorId
        });
    }
}

function handleLikeActivity(activity, activityId) {
    if (activity.userId !== auth.currentUser?.uid) {
        createActivityNotification('like', {
            contentType: activity.contentType,
            contentId: activity.contentId,
            recipientId: activity.contentAuthorId
        });
    }
}



async function checkNotificationConsistency() {
    // Bersihkan notifikasi yang sudah tidak relevan
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    
    const oldNotificationsQuery = query(
        collection(db, "notifications"),
        where("timestamp", "<", weekAgo),
        where("read", "==", true),
        limit(100)
    );
    
    const snapshot = await getDocs(oldNotificationsQuery);
    const batch = writeBatch(db);
    
    snapshot.forEach(doc => {
        batch.delete(doc.ref);
    });
    
    await batch.commit();
}

// Panggil fungsi ini secara periodic
setInterval(checkNotificationConsistency, 24 * 60 * 60 * 1000); // Setiap 24 jam





	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	function handleNotificationAction(type, targetType, targetId) {
    switch(type) {
        case 'comment':
        case 'reply':
            if (targetType && targetId) {
                window.location.href = `/${targetType}/${targetId}#comment-${targetId}`;
            }
            break;
        case 'like':
            if (targetType && targetId) {
                window.location.href = `/${targetType}/${targetId}`;
            }
            break;
        case 'feedback':
            if (targetId) {
                window.location.href = `/feedback/${targetId}`;
            }
            break;
        case 'announcement':
            showPageContent(document.getElementById("pageAnnouncements"));
            break;
        default:
            console.log('Aksi notifikasi tidak dikenali');
    }
}
	
	
	
	
	
	
	
	     // Fungsi untuk setup listener aktivitas
        function setupActivityListeners(userId) {
            const activitiesRef = collection(db, "activities");
            const q = query(activitiesRef, orderBy("timestamp", "desc"), limit(50));
            
            return onSnapshot(q, (snapshot) => {
                const newActivities = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    newActivities.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                });
                
                currentActivities = [...newActivities, ...currentActivities].slice(0, 50);
                const activeTab = document.querySelector('.activity-tab.active').dataset.tab;
                renderActivities(currentActivities, activeTab);
            });
        }
	
	
	
	
	
	
	
	
	
	
	
	
	async function markNotificationAsRead(notifId) {
    try {
        await updateDoc(doc(db, "notifications", notifId), {
            read: true
        });
    } catch (error) {
        console.error("Error marking notification as read:", error);
    }
}
	
	
	
	
	
	function loadRecentActivity(userId) {
    if (!userId) return;
    
    // Gabungkan data dari berbagai koleksi
    const activities = [];
    
    // 1. Ambil aktivitas feedback
    const feedbackQuery = query(
        collection(db, "feedback"),
        where("userId", "==", userId),
        orderBy("timestamp", "desc"),
        limit(5)
    );
    
    // 2. Ambil aktivitas diskusi
    const discussionsQuery = query(
        collection(db, "discussions"),
        where("authorId", "==", userId),
        orderBy("createdAt", "desc"),
        limit(5)
    );
    
    // 3. Ambil aktivitas komentar
    const commentsQuery = query(
        collection(db, "arduinoHistoryComments"),
        where("userId", "==", userId),
        orderBy("timestamp", "desc"),
        limit(5)
    );
    
    Promise.all([
        getDocs(feedbackQuery),
        getDocs(discussionsQuery),
        getDocs(commentsQuery)
    ]).then(([feedbackSnap, discussionsSnap, commentsSnap]) => {
        // Proses feedback
        feedbackSnap.forEach(doc => {
            activities.push({
                type: 'feedback',
                id: doc.id,
                title: doc.data().title,
                timestamp: doc.data().timestamp?.toDate(),
                content: doc.data().content.substring(0, 50) + '...'
            });
        });
        
        // Proses diskusi
        discussionsSnap.forEach(doc => {
            activities.push({
                type: 'discussion',
                id: doc.id,
                title: doc.data().title,
                timestamp: doc.data().createdAt?.toDate(),
                content: doc.data().content.substring(0, 50) + '...'
            });
        });
        
        // Proses komentar
        commentsSnap.forEach(doc => {
            activities.push({
                type: 'comment',
                id: doc.id,
                timestamp: doc.data().timestamp?.toDate(),
                content: doc.data().content.substring(0, 50) + '...'
            });
        });
        
        // Urutkan berdasarkan timestamp
        activities.sort((a, b) => b.timestamp - a.timestamp);
        
        // Render aktivitas
        renderRecentActivity(activities.slice(0, 5));
    }).catch(error => {
        console.error("Error loading activities:", error);
    });
}

function renderRecentActivity(activities) {
    const activityList = document.getElementById('recentActivity');
    
    if (activities.length === 0) {
        activityList.innerHTML = `
            <div class="empty-activity">
                <p style="color: rgba(255,255,255,0.7); text-align: center;">Tidak ada aktivitas terkini</p>
            </div>
        `;
        return;
    }
    
    activityList.innerHTML = activities.map(activity => `
        <div class="activity-item" data-type="${activity.type}" data-id="${activity.id}">
            <div class="activity-icon">
                ${getActivityIcon(activity.type)}
            </div>
            <div class="activity-content">
                <h4>${getActivityTitle(activity)}</h4>
                <p>${activity.content}</p>
                <small>${formatTimeAgo(activity.timestamp)}</small>
            </div>
        </div>
    `).join('');
    
    // Add click handlers
    document.querySelectorAll('.activity-item').forEach(item => {
        item.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            const id = this.getAttribute('data-id');
            navigateToActivity(type, id);
        });
    });
}











	
	
	function getActivityTitle(activity) {
    switch(activity.type) {
        case 'feedback': return `Feedback: ${activity.title}`;
        case 'discussion': return `Diskusi: ${activity.title}`;
        case 'comment': return `Komentar baru`;
        default: return 'Aktivitas baru';
    }
}

	
	
	// Fungsi untuk navigasi ke aktivitas
function navigateToActivity(type, id) {
  switch(type) {
    case 'comment':
    case 'reply':
      const commentMatch = id.match(/comment-(.+)/);
      if (commentMatch) {
        scrollToComment(commentMatch[1]);
      }
      break;
    case 'like':
    case 'reaction':
    case 'content':
      window.location.href = `/${type}/${id}`;
      break;
    case 'feedback':
      window.location.href = `/feedback/${id}`;
      break;
    case 'discussion':
      window.location.href = `/discussions/${id}`;
      break;
    case 'announcement':
      window.location.href = `/announcements/${id}`;
      break;
  }
}
	
	
	
	
	
	
    
	
	
	
	function renderNotifications() {
    const notificationsList = document.getElementById('notificationsList');
    
    if (notifications.length === 0) {
        notificationsList.innerHTML = `
            <div class="empty-notifications">
                <p style="color: rgba(255,255,255,0.7); text-align: center;">Tidak ada notifikasi</p>
            </div>
        `;
        return;
    }
    
    notificationsList.innerHTML = '';
    
    notifications.forEach(notification => {
        const notificationItem = document.createElement('div');
        notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
        
        // Format waktu
        const timeAgo = formatTimeAgo(notification.timestamp);
        
        notificationItem.innerHTML = `
            <div class="notification-icon">
                ${getNotificationIcon(notification.type)}
            </div>
            <div class="notification-content">
                <p>${notification.message}</p>
                <div class="notification-time">${timeAgo}</div>
                ${notification.link ? `<div class="notification-action" data-link="${notification.link}">Lihat</div>` : ''}
            </div>
        `;
        
        notificationItem.addEventListener('click', () => {
            // Tandai sebagai sudah dibaca jika belum dibaca
            if (!notification.read) {
                updateDoc(doc(db, "notifications", notification.id), {
                    read: true
                });
            }
            
            // Handle aksi notifikasi
            handleNotificationAction(notification);
        });
        
        notificationsList.appendChild(notificationItem);
    });
}
	
	
	
	
	
	
	async function createBatchNotifications(userIds, type, message, targetId = null, link = null) {
    if (!userIds || userIds.length === 0) return;
    
    const batch = writeBatch(db);
    const notificationsRef = collection(db, "notifications");
    
    userIds.forEach(userId => {
        if (!userId) return;
        
        const newNotification = {
            userId,
            type,
            message,
            read: false,
            timestamp: new Date(),
            targetId,
            link
        };
        
        const docRef = doc(notificationsRef);
        batch.set(docRef, newNotification);
    });
    
    try {
        await batch.commit();
        console.log('Batch notifications created successfully');
    } catch (error) {
        console.error('Error creating batch notifications:', error);
    }
}
	
	
	
	
	
	
	
	
	
	 // Fungsi untuk mendapatkan ikon notifikasi
        function getNotificationIcon(type) {
            const icons = {
                'comment': '💬',
                'reply': '↩️',
                'like_comment': '👍',
                'reaction': '😀',
                'announcement': '📢',
                'feedback': '📣',
                'discussion': '💬',
                'content': '📄',
                'system': '⚙️'
            };
            return icons[type] || '🔔';
        }
	
	
	
	
	
	
	
	
	
	
	
	
    
    // Fungsi pembantu untuk memformat waktu
    function formatTimeAgo(date) {
        if (!date) return '';
        
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) return 'Baru saja';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit lalu`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam lalu`;
        if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} hari lalu`;
        
        return date.toLocaleDateString('id-ID', {
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });
    }
    
    // Fungsi untuk menandai semua notifikasi sebagai sudah dibaca
    function markAllNotificationsAsRead() {
        const batch = writeBatch(db);
        
        notifications.forEach(notification => {
            if (!notification.read) {
                const notificationRef = doc(db, "notifications", notification.id);
                batch.update(notificationRef, { read: true });
            }
        });
        
        batch.commit().then(() => {
            showToast('Semua notifikasi ditandai sudah dibaca');
        }).catch(error => {
            console.error('Error marking notifications as read:', error);
            showToast('Gagal menandai notifikasi');
        });
    }
    




function scrollToComment(commentId) {
    const commentElement = document.getElementById(`comment-${commentId}`);
    if (commentElement) {
        commentElement.scrollIntoView({ behavior: 'smooth' });
        commentElement.classList.add('highlight-comment');
        setTimeout(() => {
            commentElement.classList.remove('highlight-comment');
        }, 3000);
    }
}

function scrollToReply(replyId, commentId) {
    const commentElement = document.getElementById(`comment-${commentId}`);
    if (commentElement) {
        commentElement.scrollIntoView({ behavior: 'smooth' });
        const replyElement = document.getElementById(`reply-${replyId}`);
        if (replyElement) {
            replyElement.classList.add('highlight-reply');
            setTimeout(() => {
                replyElement.classList.remove('highlight-reply');
            }, 3000);
        }
    }
}

function scrollToContent(contentId) {
    const contentElement = document.getElementById(`content-${contentId}`);
    if (contentElement) {
        contentElement.scrollIntoView({ behavior: 'smooth' });
        contentElement.classList.add('highlight-content');
        setTimeout(() => {
            contentElement.classList.remove('highlight-content');
        }, 3000);
    }
}








    
    // Fungsi untuk memuat pengaturan notifikasi
    function loadNotificationSettings() {
        if (!userProfile.notificationSettings) return;
        
        const settings = userProfile.notificationSettings;
        document.getElementById('emailNotifications').checked = settings.email !== false;
        document.getElementById('pushNotifications').checked = settings.push !== false;
        document.getElementById('activityNotifications').checked = settings.activity !== false;
        document.getElementById('announcementNotifications').checked = settings.announcements !== false;
        document.getElementById('messageNotifications').checked = settings.messages !== false;
    }
    
    // Fungsi untuk menyimpan pengaturan notifikasi
    function saveNotificationSettings() {
        const settings = {
            email: document.getElementById('emailNotifications').checked,
            push: document.getElementById('pushNotifications').checked,
            activity: document.getElementById('activityNotifications').checked,
            announcements: document.getElementById('announcementNotifications').checked,
            messages: document.getElementById('messageNotifications').checked
        };
        
        updateDoc(userRef, {
            notificationSettings: settings
        }).then(() => {
            userProfile.notificationSettings = settings;
            notificationSettingsModal.style.display = 'none';
            showToast('Pengaturan notifikasi berhasil disimpan');
        }).catch(error => {
            console.error('Error saving notification settings:', error);
            showToast('Gagal menyimpan pengaturan');
        });
    }
    
   
   
   
         // Fungsi untuk setup listener notifikasi
        function setupNotificationListeners(userId) {
            const notificationsRef = collection(db, "notifications");
            const q = query(
                notificationsRef, 
                where("userId", "==", userId),
                orderBy("timestamp", "desc"),
                limit(50)
            );
            
            return onSnapshot(q, (snapshot) => {
                notifications = [];
                let unreadCount = 0;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    notifications.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                    
                    if (!data.read) unreadCount++;
                });

                updateNotificationUI(notifications, unreadCount);
            });
        }

  
  
   
   
         // Fungsi untuk memuat detail postingan
        async function loadPostDetail(contentId, contentType) {
            let contentDoc;
            let contentTitle = '';
            let contentUrl = '';
            
            switch(contentType) {
                case 'discussion':
                    contentDoc = await getDoc(doc(db, 'discussions', contentId));
                    contentTitle = 'Diskusi';
                    contentUrl = `/discussions/${contentId}`;
                    break;
                case 'announcement':
                    contentDoc = await getDoc(doc(db, 'announcements', contentId));
                    contentTitle = 'Pengumuman';
                    contentUrl = `/announcements/${contentId}`;
                    break;
                case 'feedback':
                    contentDoc = await getDoc(doc(db, 'feedback', contentId));
                    contentTitle = 'Feedback';
                    contentUrl = `/feedback/${contentId}`;
                    break;
                case 'content':
                    contentDoc = await getDoc(doc(db, 'arduinoHistory', contentId));
                    contentTitle = 'Sejarah Arduino';
                    contentUrl = `/arduino-history/${contentId}`;
                    break;
            }
            
            if (!contentDoc || !contentDoc.exists()) {
                return '<p>Konten tidak ditemukan</p>';
            }
            
            const contentData = contentDoc.data();
            const userDoc = await getDoc(doc(db, 'users', contentData.userId || contentData.authorId));
            const userData = userDoc.exists() ? userDoc.data() : {};
            
            return `
                <div class="post-detail">
                    <div class="post-header">
                        <div class="user-avatar">${userData.displayName?.charAt(0) || 'P'}</div>
                        <div class="user-info">
                            <h4>${userData.displayName || 'Pengguna'}</h4>
                            <small>${formatTimeAgo(contentData.timestamp?.toDate() || contentData.createdAt?.toDate())}</small>
                        </div>
                    </div>
                    <div class="post-content">
                        <h3>${contentTitle}: ${contentData.title || 'Tanpa judul'}</h3>
                        <p>${contentData.content?.substring(0, 200) || 'Tidak ada konten'}...</p>
                    </div>
                    <div class="post-actions">
                        <a href="${contentUrl}" class="view-original-btn">Lihat di halaman asli</a>
                    </div>
                </div>
            `;
        }
		
		
		
		
		
		
		     // Fungsi untuk memuat detail reaksi
        async function loadReactionDetail(contentId) {
            const reactionDoc = await getDoc(doc(db, "userReactions", contentId));
            
            if (!reactionDoc.exists()) {
                return '<p>Reaksi tidak ditemukan</p>';
            }
            
            const reaction = reactionDoc.data();
            const userDoc = await getDoc(doc(db, 'users', reaction.userId));
            const userData = userDoc.exists() ? userDoc.data() : {};
            
            return `
                <div class="reaction-detail">
                    <div class="reaction-header">
                        <div class="user-avatar">${userData.displayName?.charAt(0) || 'P'}</div>
                        <div class="user-info">
                            <h4>${userData.displayName || 'Pengguna'}</h4>
                            <small>${formatTimeAgo(reaction.timestamp?.toDate())}</small>
                        </div>
                    </div>
                    <div class="reaction-content">
                        <p>Memberikan reaksi: ${reaction.emojiType || ''}</p>
                    </div>
                    <div class="reaction-actions">
                        <a href="/arduino-history/${contentId}" class="view-original-btn">Lihat di halaman asli</a>
                    </div>
                </div>
            `;
        }
		
		
		
		
		
		
		
		// Helper function to load comment details
async function loadCommentDetail(contentId, commentId) {
  let commentDoc;
  
  if (commentId) {
    commentDoc = await getDoc(doc(db, 'arduinoHistoryComments', commentId));
  } else {
    const q = query(
      collection(db, 'arduinoHistoryComments'),
      where('historyId', '==', contentId),
      orderBy('timestamp', 'desc'),
      limit(1)
    );
    const snapshot = await getDocs(q);
    commentDoc = snapshot.docs[0];
  }
  
  if (!commentDoc || !commentDoc.exists()) {
    return '<p>Komentar tidak ditemukan</p>';
  }
  
  const commentData = commentDoc.data();
  const userDoc = await getDoc(doc(db, 'users', commentData.userId));
  const userData = userDoc.exists() ? userDoc.data() : {};
  
  return `
    <div class="comment-detail">
      <div class="comment-header">
        <div class="user-avatar">${userData.displayName?.charAt(0) || 'P'}</div>
        <div class="user-info">
          <h4>${userData.displayName || 'Pengguna'}</h4>
          <small>${formatTimeAgo(commentData.timestamp?.toDate())}</small>
        </div>
      </div>
      <div class="comment-content">
        <p>${commentData.content}</p>
      </div>
      <div class="comment-actions">
        <button class="like-btn" data-id="${commentDoc.id}">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
          </svg>
          <span class="like-count">${commentData.likes || 0}</span>
        </button>
        <a href="/arduino-history/${contentId}#comment-${commentDoc.id}" class="view-original-btn">Lihat di halaman asli</a>
      </div>
    </div>
  `;
}
		
		
		
		
		
		
		
		
		
		
		
		
		// Enhanced showActivityDetail function
async function showActivityDetail(type, contentId, commentId = null) {
  const modal = document.getElementById('activityDetailModal');
  const modalTitle = document.getElementById('activityModalTitle');
  const modalContent = document.getElementById('activityModalContent');
  
  modal.style.display = 'block';
  modalTitle.textContent = 'Detail Aktivitas';
  modalContent.innerHTML = '<div class="loader"></div>';
  
  try {
    let content = '';
    
    switch(type) {
      case 'comment':
      case 'reply':
      case 'like_comment':
        content = await loadCommentDetail(contentId, commentId);
        break;
      case 'reaction':
        content = await loadReactionDetail(contentId);
        break;
      case 'feedback':
        content = await loadFeedbackDetail(contentId);
        break;
      case 'discussion':
        content = await loadDiscussionDetail(contentId);
        break;
      case 'announcement':
        content = await loadAnnouncementDetail(contentId);
        break;
      case 'content':
        content = await loadArduinoHistoryDetail(contentId);
        break;
      default:
        content = '<p>Detail aktivitas tidak tersedia</p>';
    }
    
    modalContent.innerHTML = content;
    
    // Setup any interactive elements in the modal
    if (type === 'comment' || type === 'reply') {
      setupCommentInteractions(modalContent);
    }
    
  } catch (error) {
    console.error('Error loading activity detail:', error);
    modalContent.innerHTML = '<p>Gagal memuat detail aktivitas</p>';
  }
}
		
		
		
		
		
		
		
   
   
   
   
    
    // Event listener untuk tab aktivitas
    document.querySelectorAll('.activity-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const tabId = this.getAttribute('data-tab');
            // Implementasi untuk memuat konten tab yang sesuai
        });
    });
});









function getTargetName(targetType) {
    const names = {
        'feedback': 'feedback',
        'announcement': 'pengumuman',
        'arduino-history': 'sejarah Arduino',
        'discussion': 'diskusi'
    };
    return names[targetType] || 'konten';
}









// Enhanced Activity Tracking
async function logActivity(activityData) {
  try {
    const activityRef = doc(collection(db, "activities"));
    const activityKey = `${activityData.type}_${activityData.contentId}_${activityData.userId}`;
    
    if (processedActivityIds.has(activityKey)) return;
    processedActivityIds.add(activityKey);

    await setDoc(activityRef, {
      ...activityData,
      timestamp: serverTimestamp()
    });
  } catch (error) {
    console.error("Error logging activity:", error);
  }
}


























// Fungsi pembantu untuk menentukan recipientId
async function determineRecipientId(activityData) {
    try {
        // Coba dapatkan dari konten utama
        const contentRef = doc(db, activityData.contentType, activityData.contentId);
        const contentDoc = await getDoc(contentRef);
        
        if (contentDoc.exists()) {
            return contentDoc.data().userId || contentDoc.data().authorId;
        }

        // Jika tidak ditemukan, coba dari komentar
        if (activityData.commentId) {
            const commentRef = doc(db, `${activityData.contentType}Comments`, activityData.commentId);
            const commentDoc = await getDoc(commentRef);
            if (commentDoc.exists()) {
                return commentDoc.data().userId || commentDoc.data().replyTo;
            }
        }

        return null;
    } catch (error) {
        console.error("Error menentukan recipientId:", error);
        return null;
    }
}


// Fungsi untuk menangani notifikasi pengumuman
async function handleAnnouncementNotification(activityData, currentUserId) {
    const usersSnapshot = await getDocs(collection(db, "users"));
    const batch = writeBatch(db);

    usersSnapshot.forEach(userDoc => {
        if (userDoc.id !== currentUserId) {
            const notificationRef = doc(collection(db, "notifications"));
            batch.set(notificationRef, {
                userId: userDoc.id,
                type: 'announcement',
                message: activityData.message || `Pengumuman baru: ${activityData.title}`,
                read: false,
                timestamp: new Date(),
                link: `/announcements/${activityData.contentId}`,
                fromUserId: currentUserId
            });
        }
    });

    await batch.commit();
}



async function createNotificationDocument(activityType, activityData, recipientId, currentUser) {
    const notificationData = {
        userId: recipientId,
        type: activityType,
        read: false,
        timestamp: new Date(),
        fromUserId: currentUser.uid,
        fromUserName: currentUser.displayName || 'Pengguna'
    };

    switch(activityType) {
        case 'comment':
            notificationData.message = `${notificationData.fromUserName} mengomentari ${getContentTypeName(activityData.contentType)} Anda`;
            notificationData.link = `/${activityData.contentType}/${activityData.contentId}#comment-${activityData.commentId}`;
            notificationData.contentType = activityData.contentType;
            notificationData.contentId = activityData.contentId;
            notificationData.commentId = activityData.commentId;
            break;

        case 'like':
            notificationData.message = `${notificationData.fromUserName} menyukai ${getContentTypeName(activityData.contentType)} Anda`;
            notificationData.link = `/${activityData.contentType}/${activityData.contentId}`;
            notificationData.contentType = activityData.contentType;
            notificationData.contentId = activityData.contentId;
            break;

        case 'reaction':
            const isSelf = recipientId === currentUser.uid;
            const contentName = getContentTypeName(activityData.contentType);

            notificationData.message = isSelf
                ? `Kamu memberikan reaksi ${activityData.emoji} pada ${contentName}`
                : `${notificationData.fromUserName} memberikan reaksi ${activityData.emoji} pada ${contentName} Anda`;

            notificationData.link = `/${activityData.contentType}/${activityData.contentId}`;
            notificationData.contentType = activityData.contentType;
            notificationData.contentId = activityData.contentId;
            notificationData.emoji = activityData.emoji;
            break;

        default:
            notificationData.message = `${notificationData.fromUserName} melakukan aktivitas baru`;
            notificationData.link = '/';
    }

    await addDoc(collection(db, "notifications"), notificationData);
}






// Fungsi untuk mengirim pengumuman ke semua user
async function sendAnnouncementToAllUsers(activityData, senderId) {
  try {
    const usersSnapshot = await getDocs(collection(db, "users"));
    const batch = writeBatch(db);

    usersSnapshot.forEach(userDoc => {
      if (userDoc.id !== senderId) {
        const notificationRef = doc(collection(db, "notifications"));
        batch.set(notificationRef, {
          userId: userDoc.id,
          type: 'announcement',
          message: activityData.message || `Pengumuman baru: ${activityData.title}`,
          read: false,
          timestamp: new Date(),
          link: `/announcements/${activityData.contentId}`,
          fromUserId: senderId,
          fromUserName: 'Admin'
        });
      }
    });

    await batch.commit();
  } catch (error) {
    console.error("Error sending announcement:", error);
  }
}





// Fungsi untuk mendapatkan author content
async function getContentAuthorId(activityData) {
  try {
    // Coba ambil dari konten utama
    const contentRef = doc(db, activityData.contentType, activityData.contentId);
    const contentDoc = await getDoc(contentRef);
    
    if (contentDoc.exists()) {
      return contentDoc.data().userId || contentDoc.data().authorId;
    }

    // Jika tidak ditemukan, coba ambil dari komentar
    if (activityData.commentId) {
      const commentRef = doc(db, `${activityData.contentType}Comments`, activityData.commentId);
      const commentDoc = await getDoc(commentRef);
      if (commentDoc.exists()) {
        return commentDoc.data().userId || commentDoc.data().replyTo;
      }
    }

    return null;
  } catch (error) {
    console.error("Error mendapatkan author ID:", error);
    return null;
  }
}












// Fungsi pembantu untuk membuat notifikasi tunggal
async function createSingleNotification(activityType, activityData, recipientId, currentUserId, currentUserName) {
    const { message, link } = generateNotificationContent(activityType, activityData, currentUserName);

    await addDoc(collection(db, "notifications"), {
        userId: recipientId,
        type: activityType,
        message,
        read: false,
        timestamp: new Date(),
        link,
        fromUserId: currentUserId,
        ...(activityData.emoji && { emoji: activityData.emoji })
    });
}






// Fungsi untuk generate konten notifikasi
function generateNotificationContent(activityType, activityData, senderName) {
  let message = '';
  let link = '';
  let targetType = '';

  switch (activityType) {
    case 'comment':
      targetType = getContentTypeName(activityData.contentType);
      message = `${senderName} mengomentari ${targetType} Anda`;
      link = `/${activityData.contentType}/${activityData.contentId}#comment-${activityData.commentId}`;
      break;
    case 'reply':
      targetType = getContentTypeName(activityData.contentType);
      message = `${senderName} membalas komentar Anda`;
      link = `/${activityData.contentType}/${activityData.contentId}#reply-${activityData.replyId}`;
      break;
    case 'like':
      targetType = getContentTypeName(activityData.contentType);
      message = `${senderName} menyukai ${targetType} Anda`;
      link = `/${activityData.contentType}/${activityData.contentId}`;
      break;
    case 'reaction':
      targetType = getContentTypeName(activityData.contentType);
      message = `${senderName} memberikan reaksi ${activityData.emoji} pada ${targetType} Anda`;
      link = `/${activityData.contentType}/${activityData.contentId}`;
      break;
    case 'feedback':
      message = `${senderName} memberikan feedback baru`;
      link = `/feedback/${activityData.contentId}`;
      break;
    case 'discussion':
      message = `${senderName} memulai diskusi baru`;
      link = `/discussions/${activityData.contentId}`;
      break;
    case 'announcement':
      message = activityData.message || `Pengumuman baru: ${activityData.title}`;
      link = `/announcements/${activityData.contentId}`;
      break;
    case 'content':
      targetType = getContentTypeName(activityData.contentType);
      message = `${senderName} mengupload ${targetType} baru: ${activityData.title}`;
      link = `/${activityData.contentType}/${activityData.contentId}`;
      break;
    default:
      message = `${senderName} melakukan aktivitas baru`;
      link = '/';
  }

  return { message, link, targetType };
}



// Fungsi untuk mendapatkan nama content type
function getContentTypeName(type) {
  const typeMap = {
    'arduino-history': 'sejarah Arduino',
    'discussions': 'diskusi',
    'feedback': 'feedback',
    'announcements': 'pengumuman',
    'content': 'konten'
  };
  return typeMap[type] || type;
}


    // Fungsi untuk mendapatkan ikon aktivitas
        function getActivityIcon(type) {
            const icons = {
                'comment': '💬',
                'reply': '↩️',
                'like_comment': '👍',
                'reaction': '😀',
                'post': '📝',
                'feedback': '📣',
                'discussion': '💬',
                'announcement': '📢',
                'content': '📄'
            };
            return icons[type] || '🔔';
        }










function validateActivityData(data) {
    return {
        id: data.id || 'unknown',
        type: data.type || 'activity',
        timestamp: data.timestamp instanceof Date ? data.timestamp : new Date(),
        content: data.content || '',
        targetId: data.targetId || null,
        targetType: data.targetType || null
    };
}




// Fungsi utama untuk memuat semua listener
function setupAllListeners(userId) {
  const unsubscribes = [
    setupCommentListeners(userId),
    setupLikeListeners(userId),
    setupFeedbackListeners(userId),
    setupDiscussionListeners(userId),
    setupDiscussionCommentListeners(userId),
    setupAnnouncementListeners(userId),
    setupReactionListeners(userId),
    setupContentUploadListeners(userId)
  ];
  
  return () => unsubscribes.forEach(fn => fn && fn());
}





// Fungsi untuk memuat dan menampilkan aktivitas terkini
function loadRecentActivities(userId) {
  const q = query(
    collection(db, "activities"), 
    where("userId", "==", userId),
    orderBy("timestamp", "desc"),
    limit(50)
  );

  return onSnapshot(q, (snapshot) => {
    const newActivities = [];
    
    snapshot.docChanges().forEach(change => {
      if (change.type === "added" && !processedActivityIds.has(change.doc.id)) {
        processedActivityIds.add(change.doc.id);
        const data = change.doc.data();
        
        newActivities.push({
          id: change.doc.id,
          ...data,
          timestamp: data.timestamp?.toDate() || new Date()
        });
      }
    });

    if (newActivities.length > 0) {
      currentActivities = [...newActivities, ...currentActivities].slice(0, 50);
      renderActivities(currentActivities, getActiveTab());
    }
  });
}




// Fungsi untuk mendapatkan tab aktif
function getActiveTab() {
  const activeTab = document.querySelector('.activity-tab.active');
  return activeTab ? activeTab.dataset.tab : 'all';
}









function renderActivities(activities, filterType = 'all') {
  const container = document.getElementById(`${filterType}Activity`);
  if (!container) return;

  // Filter activities based on tab
  const filteredActivities = activities.filter(activity => {
    if (filterType === 'all') return true;
    if (filterType === 'comments') {
      return ['comment', 'reply', 'like_comment'].includes(activity.type) &&
             ['announcements', 'feedback', 'arduinoHistory'].includes(activity.contentType);
    }
    if (filterType === 'reactions') {
      return activity.type === 'reaction' && activity.contentType === 'arduinoHistory';
    }
    if (filterType === 'posts') {
      return ['post', 'feedback', 'discussion', 'announcement', 'content'].includes(activity.type);
    }
    return false;
  });

  if (filteredActivities.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <p style="color: rgba(255,255,255,0.7); text-align: center;">
          Tidak ada aktivitas ${getFilterName(filterType)}
        </p>
      </div>
    `;
    return;
  }

  container.innerHTML = filteredActivities.map(activity => {
    // Format activity content based on type
    let content = '';
    let icon = getActivityIcon(activity.type);
    
    switch(activity.type) {
      case 'comment':
        content = `${activity.fromUserName || 'Pengguna'} mengomentari ${getContentTypeName(activity.contentType)}`;
        break;
      case 'reply':
        content = `${activity.fromUserName || 'Pengguna'} membalas komentar pada ${getContentTypeName(activity.contentType)}`;
        break;
      case 'like_comment':
        content = `${activity.fromUserName || 'Pengguna'} menyukai komentar pada ${getContentTypeName(activity.contentType)}`;
        break;
      case 'reaction':
        content = `${activity.fromUserName || 'Pengguna'} memberikan reaksi ${activity.emoji || ''} pada ${getContentTypeName(activity.contentType)}`;
        break;
      case 'feedback':
        content = `${activity.fromUserName || 'Pengguna'} memberikan feedback: ${activity.description || ''}`;
        break;
      case 'announcement':
        content = `${activity.fromUserName || 'Pengguna'} membuat pengumuman baru`;
        break;
      default:
        content = activity.description || `Aktivitas baru dari ${activity.fromUserName || 'Pengguna'}`;
    }

    return `
      <div class="activity-item" 
           data-type="${activity.type}" 
           data-id="${activity.id}"
           data-content-id="${activity.contentId || ''}"
           data-comment-id="${activity.commentId || ''}">
        <div class="activity-icon">${icon}</div>
        <div class="activity-content">
          <p>${content}</p>
          <small>${formatTimeAgo(activity.timestamp)}</small>
        </div>
      </div>
    `;
  }).join('');

  // Add click handlers
  container.querySelectorAll('.activity-item').forEach(item => {
    item.addEventListener('click', function() {
      const type = this.dataset.type;
      const contentId = this.dataset.contentId;
      const commentId = this.dataset.commentId;
      showActivityDetail(type, contentId, commentId);
    });
  });
}


















// 4. Perbaikan fungsi formatTimeAgo dengan validasi
function formatTimeAgo(date) {
    if (!(date instanceof Date)) {
        console.error("Parameter date harus berupa instance Date");
        return '';
    }
    
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    if (diffInSeconds < 60) return 'Baru saja';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit lalu`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam lalu`;
    if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} hari lalu`;
    
    return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'short',
        year: 'numeric'
    });
}





        // Fungsi untuk mendapatkan nama filter
        function getFilterName(filterType) {
            const names = {
                'all': 'semua',
                'comments': 'komentar',
                'reactions': 'reaksi',
                'posts': 'postingan'
            };
            return names[filterType] || filterType;
        }






// Format activity content
function formatActivityContent(activity) {
    let actionText = '';
    let contentInfo = '';
    
    switch(activity.type) {
        case 'comment':
            actionText = 'mengomentari';
            contentInfo = activity.contentType === 'arduinoHistory' ? 'sejarah Arduino' : 
                         activity.contentType === 'feedback' ? 'feedback' : 
                         activity.contentType === 'announcement' ? 'pengumuman' : 
                         activity.contentType;
            break;
        case 'reply':
            actionText = 'membalas komentar di';
            contentInfo = activity.contentType === 'arduinoHistory' ? 'sejarah Arduino' : 
                         activity.contentType === 'feedback' ? 'feedback' : 
                         activity.contentType === 'announcement' ? 'pengumuman' : 
                         activity.contentType;
            break;
        case 'like_comment':
            actionText = 'menyukai komentar di';
            contentInfo = activity.contentType === 'arduinoHistory' ? 'sejarah Arduino' : 
                         activity.contentType === 'feedback' ? 'feedback' : 
                         activity.contentType === 'announcement' ? 'pengumuman' : 
                         activity.contentType;
            break;
        case 'reaction':
            actionText = 'memberi reaksi';
            contentInfo = activity.emoji ? activity.emoji : '';
            break;
        case 'feedback':
            actionText = 'memberi feedback';
            break;
        case 'announcement':
            actionText = 'membuat pengumuman';
            break;
        case 'content':
            actionText = 'memposting sejarah Arduino';
            break;
        default:
            actionText = 'melakukan aktivitas';
    }
    
    return `${activity.userName || 'Pengguna'} ${actionText} ${contentInfo}`;
}












function getActivityVerb(type) {
  const verbs = {
    'comment': 'mengomentari',
    'reply': 'membalas',
    'like': 'menyukai',
    'reaction': 'memberi reaksi pada',
    'post': 'memposting',
    'feedback': 'memberi feedback',
    'discussion': 'memulai diskusi',
    'announcement': 'membuat pengumuman',
    'content': 'mengupload'
  };
  return verbs[type] || 'melakukan aktivitas pada';
}








     // Fungsi untuk memuat aktivitas postingan
        function loadPostActivities() {
            const q = query(
                collection(db, "activities"),
                where("type", "in", ["post", "feedback", "discussion", "announcement", "content"]),
                orderBy("timestamp", "desc"),
                limit(50)
            );
            
            return onSnapshot(q, (snapshot) => {
                const activities = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    activities.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                });
                renderActivities(activities, 'posts');
            });
        }



     // Fungsi untuk memuat aktivitas reaksi
        function loadReactionActivities() {
            const q = query(
                collection(db, "activities"),
                where("type", "==", "reaction"),
                orderBy("timestamp", "desc"),
                limit(50)
            );
            
            return onSnapshot(q, (snapshot) => {
                const activities = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    activities.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                });
                renderActivities(activities, 'reactions');
            });
        }
		
		
		
		
        // Fungsi untuk memuat semua aktivitas
        function loadAllActivities() {
            const q = query(
                collection(db, "activities"),
                orderBy("timestamp", "desc"),
                limit(50)
            );
            
            return onSnapshot(q, (snapshot) => {
                const newActivities = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    newActivities.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                });
                renderActivities(newActivities, 'all');
            });
        }

        // Fungsi untuk memuat aktivitas komentar
        function loadCommentsActivities() {
            const q = query(
                collection(db, "activities"),
                where("type", "in", ["comment", "reply", "like_comment"]),
                orderBy("timestamp", "desc"),
                limit(50)
            );
            
            return onSnapshot(q, (snapshot) => {
                const activities = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    activities.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp?.toDate() || new Date()
                    });
                });
                renderActivities(activities, 'comments');
            });
        }







// Fungsi untuk menandai notifikasi sebagai sudah dibaca
async function markNotificationAsRead(notifId) {
    try {
        await updateDoc(doc(db, "notifications", notifId), {
            read: true
        });
    } catch (error) {
        console.error("Error marking notification as read:", error);
    }
}

// Fungsi untuk menandai semua notifikasi sebagai sudah dibaca
async function markAllNotificationsAsRead() {
    const unreadNotifications = notifications.filter(n => !n.read);
    
    if (unreadNotifications.length === 0) return;
    
    const batch = writeBatch(db);
    
    unreadNotifications.forEach(notif => {
        const notifRef = doc(db, "notifications", notif.id);
        batch.update(notifRef, { read: true });
    });
    
    try {
        await batch.commit();
        showToast('Semua notifikasi ditandai sudah dibaca');
    } catch (error) {
        console.error('Error marking all as read:', error);
        showToast('Gagal menandai notifikasi');
    }
}






function setupActivitiesListener(query, filterType = 'all') {
    return onSnapshot(
        query,
        (snapshot) => {
            const activities = [];

            snapshot.forEach(doc => {
                const data = doc.data();

                // Deteksi timestamp (bisa Timestamp Firestore atau milisecond number)
                let finalTimestamp = new Date();
                if (data.timestamp && typeof data.timestamp.toDate === 'function') {
                    finalTimestamp = data.timestamp.toDate();
                } else if (typeof data.timestamp === 'number') {
                    finalTimestamp = new Date(data.timestamp);
                }

                activities.push({
                    id: doc.id,
                    ...data,
                    timestamp: finalTimestamp
                });
            });

            renderActivities(activities, filterType);
        },
        (error) => {
            console.error("Activities listener error:", error);

            // Tentukan kontainer berdasarkan filter
            let errorContainerId = '';
            switch (filterType) {
                case 'comments': errorContainerId = 'commentsActivity'; break;
                case 'reactions': errorContainerId = 'reactionsActivity'; break;
                case 'posts': errorContainerId = 'postsActivity'; break;
                default: errorContainerId = 'allActivity';
            }

            const container = document.getElementById(errorContainerId);
            if (container) {
                container.innerHTML = `
                    <div class="error-message">
                        Gagal memuat aktivitas. Coba lagi nanti.
                    </div>
                `;
            }
        }
    );
}




































    
    // DOM Elements
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const greeting = document.getElementById("greeting");
    const likeBtn = document.getElementById("likeBtn");
    const followBtn = document.getElementById("followBtn");
	
	
	
	
	
	
	
	
	
	
	
	
	
	async function setupEmojiReactions(user, contentId = 'arduino-history') {
    const emojiOptions = document.querySelectorAll('.emoji-option');
    const reactionMessage = document.querySelector('.reaction-message');
    const loginMessage = document.querySelector('.login-message');

    reactionMessage.style.display = 'none';
    loginMessage.style.display = 'none';

    if (!user) {
        loginMessage.style.display = 'block';
        emojiOptions.forEach(option => {
            option.style.opacity = '0.5';
            option.style.cursor = 'not-allowed';
            option.addEventListener('click', e => {
                e.preventDefault();
                loginMessage.style.opacity = 1;
                setTimeout(() => loginMessage.style.opacity = 0.7, 2000);
            });
        });
        return;
    }

    const reactionDocRef = doc(db, 'reactions', contentId);
    const userReactionRef = doc(db, 'userReactions', `${user.uid}_${contentId}`);

    // Realtime listener
    onSnapshot(reactionDocRef, (snapshot) => {
        const data = snapshot.data();
        if (data) {
            Object.keys(data).forEach(emoji => {
                const el = document.getElementById(`${emoji}-count`);
                if (el) el.textContent = data[emoji];
            });
        }
    });

    let userReaction = null;
    const userReactionSnap = await getDoc(userReactionRef);
    if (userReactionSnap.exists()) {
        userReaction = userReactionSnap.data().emojiType;
        const selected = document.querySelector(`.emoji-option[data-emoji="${userReaction}"]`);
        if (selected) selected.classList.add('selected');
    }

    emojiOptions.forEach(option => {
        option.addEventListener('click', async function () {
            const emojiType = this.dataset.emoji;
            if (userReaction === emojiType) return;

            emojiOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');

            const updates = {};
            if (userReaction) updates[userReaction] = increment(-1);
            updates[emojiType] = increment(1);

            await updateDoc(reactionDocRef, updates).catch(async () => {
                await setDoc(reactionDocRef, updates, { merge: true });
            });

            await setDoc(userReactionRef, {
                userId: user.uid,
                contentId,
                emojiType,
                timestamp: Date.now()
            });

            userReaction = emojiType;

          // Di dalam fungsi setupEmojiReactions, ganti bagian createNotification dengan:
await createActivityNotification(
    '9k1G7CiLZWNCkadVn3m8ZZRaQwg1', // Ganti dengan ID pemilik konten yang sebenarnya
    'reaction',
    user.uid,
    user.displayName || 'Pengguna',
    emojiType,
    contentId.includes('arduino') ? 'arduino-history' : 'content',
    contentId
);

            // ✅ Aktivitas pengguna
            await addDoc(collection(db, "activities"), {
                userId: user.uid,
                type: "reaction",
                emojiType,
                contentId,
                timestamp: Date.now()
            });

            // ✅ Pesan sukses
            reactionMessage.style.display = 'block';
            reactionMessage.style.opacity = 1;
            setTimeout(() => reactionMessage.style.opacity = 0.7, 2000);
        });
    });
}
	
	
	
	
	
	



    // Authentication Functions
    if (loginBtn) {
        loginBtn.addEventListener("click", () => {
            signInWithPopup(auth, provider).catch(console.error);
        });
    }

    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            signOut(auth).catch(console.error);
        });
    }

    // Auth State Listener
    onAuthStateChanged(auth, (user) => {
        const greeting = document.getElementById("greeting");
        const loginBtn = document.getElementById("loginBtn");
        const logoutBtn = document.getElementById("logoutBtn");

        if (user) {
            document.getElementById("page1").style.display = "block";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "none";
			

            const hours = new Date().getHours();
            let greet = "Selamat malam";
            if (hours >= 5 && hours < 11) greet = "Selamat pagi";
            else if (hours >= 11 && hours < 15) greet = "Selamat siang";
            else if (hours >= 15 && hours < 18) greet = "Selamat sore";

            if (greeting) greeting.textContent = `${greet}, ${user.displayName}`;

            const dynamicText = document.getElementById("dynamicText");
            if (dynamicText) {
                const phrases = [
                    `Ada apa kamu di sini, ${user.displayName}?`,
                    `Lagi nyari inspirasi ya, ${user.displayName}?`,
                    `Selamat datang kembali, ${user.displayName}!`,
                    `Semangat belajar, ${user.displayName}!`,
                    `Mau ngoprek Arduino lagi, ${user.displayName}?`
                ];
                let index = 0;
                function changePhrase() {
                    dynamicText.textContent = phrases[index];
                    index = (index + 1) % phrases.length;
                }
                changePhrase();
                setInterval(changePhrase, 20000);
            }

            if (loginBtn) loginBtn.style.display = "none";
            if (logoutBtn) logoutBtn.style.display = "inline-block";
            if (likeBtn) likeBtn.disabled = false;
            if (followBtn) followBtn.disabled = false;
			
			    setupEmojiReactions(user);
			


        } else {
            if (greeting) greeting.textContent = "";
            if (loginBtn) loginBtn.style.display = "inline-block";
            if (logoutBtn) logoutBtn.style.display = "none";
            if (likeBtn) likeBtn.disabled = true;
            if (followBtn) followBtn.disabled = true;

            const dynamicText = document.getElementById("dynamicText");
            if (dynamicText) dynamicText.textContent = "";
			    setupEmojiReactions(null);

        }
    });























    // DOM Elements
    const toggleAdminBtn = document.getElementById('toggleAdminBtn');
    const adminFormContainer = document.getElementById('adminFormContainer');
    const adminOverlay = document.getElementById('adminOverlay');
    const adminAuth = document.getElementById('adminAuth');
    const adminControls = document.getElementById('adminControls');
    const adminEmail = document.getElementById('adminEmail');
    const adminContentEditor = document.getElementById('adminContentEditor');
    const adminStatus = document.getElementById('adminStatus');
    const dataAuthorElement = document.getElementById('dataAuthor');
    const lastUpdatedElement = document.getElementById('lastUpdated');
    const contentSectionSelect = document.getElementById('contentSection');
    const authorInput = document.getElementById('authorInput');
    const changeDescription = document.getElementById('changeDescription');

    // Toggle admin form
    toggleAdminBtn.addEventListener('click', function() {
        adminFormContainer.style.display = adminFormContainer.style.display === 'none' ? 'block' : 'none';
        adminOverlay.style.display = adminOverlay.style.display === 'none' ? 'block' : 'none';
        document.body.style.overflow = adminFormContainer.style.display === 'block' ? 'hidden' : 'auto';
    });

    // Close form when clicking overlay
    adminOverlay.addEventListener('click', function() {
        adminFormContainer.style.display = 'none';
        adminOverlay.style.display = 'none';
        document.body.style.overflow = 'auto';
    });

    // Auth state handler
    onAuthStateChanged(auth, (user) => {
        const isAdmin = user && user.email === ADMIN_EMAIL;
        adminAuth.style.display = isAdmin ? 'none' : 'block';
        adminControls.style.display = isAdmin ? 'block' : 'none';
        adminEmail.textContent = isAdmin ? user.email : '';
        if (isAdmin) {
            authorInput.value = user.email;
            loadPageContent();
        }
        loadMetadata();
    });

    // Login handler
    document.getElementById('adminLoginBtn').addEventListener('click', () => {
        signInWithPopup(auth, provider).catch(handleLoginError);
    });

    function handleLoginError(error) {
        adminStatus.textContent = 'Login gagal: ' + error.message;
        adminStatus.style.color = 'red';
        adminStatus.style.backgroundColor = 'rgba(255,0,0,0.1)';
        setTimeout(() => { 
            adminStatus.textContent = ''; 
            adminStatus.style.backgroundColor = 'transparent'; 
        }, 3000);
    }

    // Logout handler
    document.getElementById('adminLogoutBtn').addEventListener('click', () => {
        signOut(auth);
        closeAdminForm();
    });

    function closeAdminForm() {
        adminFormContainer.style.display = 'none';
        adminOverlay.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // Content section handler
    contentSectionSelect.addEventListener('change', function() {
        loadSectionContent(this.value);
    });

    async function loadSectionContent(section) {
        try {
            const docRef = doc(db, "pageContent", CONTENT_DOC_ID);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists() && docSnap.data()[section]) {
                adminContentEditor.value = docSnap.data()[section];
                return;
            }
            
            // Fallback to default content
            const pageContent = document.getElementById('page10').outerHTML;
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(pageContent, 'text/html');

            let sectionContent = '';
            const elements = {
                'title': '.title-section h1',
                'timeline': '.history-timeline',
                'video': '.video-container',
                'footnotes': '.footnotes-container',
                'reactions': '.reaction-container',
                'comments': '.comments-container',
                'cards': '.bab-card'
            };

            const element = htmlDoc.querySelector(elements[section]);
            
            if (section === 'cards') {
                const cards = htmlDoc.querySelectorAll(elements[section]);
                sectionContent = cards.length > 0 ? 
                    Array.from(cards).map(card => card.outerHTML).join('\n') : 
                    '<!-- Cards will go here -->';
            } else if (section === 'timeline') {
                sectionContent = element ? element.innerHTML : '<!-- Timeline content will go here -->';
            } else {
                sectionContent = element ? element.outerHTML : `<!-- ${section} content will go here -->`;
            }

            adminContentEditor.value = sectionContent;
        } catch (error) {
            console.error("Error loading section content:", error);
            adminContentEditor.value = `Error loading content: ${error.message}`;
        }
    }

    async function loadPageContent() {
        contentSectionSelect.value = 'title';
        await loadSectionContent('title');
    }

    async function loadMetadata() {
        try {
            const docRef = doc(db, "pageMetadata", CONTENT_DOC_ID);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                const metadata = docSnap.data();
                const lastUpdated = metadata.lastUpdated?.toDate();
                const formattedDate = lastUpdated.toLocaleString('id-ID', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                document.getElementById('dataAuthor').textContent = metadata.author;
                document.getElementById('lastUpdated').textContent = formattedDate;
                authorInput.value = metadata.author;
            }
        } catch (error) {
            console.error("Error loading metadata:", error);
        }
    }

    // Save handler
    document.getElementById('adminSaveBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user || user.email !== ADMIN_EMAIL) {
            showStatus('Error: Akses tidak diizinkan', 'error');
            return;
        }

        showStatus('Menyimpan perubahan...', 'loading');

        try {
            const section = contentSectionSelect.value;
            const content = adminContentEditor.value;
            const changeDesc = changeDescription.value;
            
            // Save content to Firestore
            const contentRef = doc(db, "pageContent", CONTENT_DOC_ID);
            await setDoc(contentRef, {
                [section]: content
            }, { merge: true });
            
            // Update metadata
            const metadataRef = doc(db, "pageMetadata", CONTENT_DOC_ID);
            await setDoc(metadataRef, {
                author: user.email,
                lastUpdated: new Date(),
                lastChangeDescription: changeDesc
            }, { merge: true });
            
            // Update local UI
            updateLocalContent(section, content);
            
            // Update metadata display
            const formattedDate = new Date().toLocaleString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('dataAuthor').textContent = user.email;
            document.getElementById('lastUpdated').textContent = formattedDate;
            
            showStatus('Perubahan berhasil disimpan!', 'success');
            changeDescription.value = '';
        } catch (error) {
            console.error("Error:", error);
            showStatus('Error: ' + error.message, 'error');
        }
    });

    function updateLocalContent(section, content) {
        const pageContent = document.getElementById('page10');
        const currentHtml = pageContent.outerHTML;
        const parser = new DOMParser();
        const htmlDoc = parser.parseFromString(currentHtml, 'text/html');

        const updateContent = (selector, newContent, isInner = false) => {
            const element = htmlDoc.querySelector(selector);
            if (!element) {
                if (selector === '.title-section h1') {
                    const titleSection = htmlDoc.querySelector('.title-section') || htmlDoc.createElement('div');
                    titleSection.className = 'title-section';
                    const h1 = htmlDoc.createElement('h1');
                    h1.innerHTML = newContent;
                    titleSection.appendChild(h1);
                    htmlDoc.body.appendChild(titleSection);
                    return;
                }
                throw new Error(`Element ${selector} tidak ditemukan`);
            }
            isInner ? element.innerHTML = newContent : element.outerHTML = newContent;
        };

        switch(section) {
            case 'title': updateContent('.title-section h1', content); break;
            case 'timeline': updateContent('.history-timeline', content, true); break;
            case 'video': updateContent('.video-container', content); break;
            case 'footnotes': updateContent('.footnotes-container', content); break;
            case 'reactions': updateContent('.reaction-container', content); break;
            case 'comments': updateContent('.comments-container', content); break;
            case 'cards': 
                const container = htmlDoc.querySelector('.page10-container');
                if (!container) throw new Error('Container tidak ditemukan');
                container.querySelectorAll('.bab-card').forEach(card => card.remove());
                const newCardsDoc = parser.parseFromString(content, 'text/html');
                Array.from(newCardsDoc.body.children)
                    .filter(card => card.classList.contains('bab-card'))
                    .forEach(card => container.appendChild(card));
                break;
            default: throw new Error('Bagian tidak valid');
        }

        pageContent.outerHTML = htmlDoc.documentElement.outerHTML;
    }

    function showStatus(message, type) {
        adminStatus.textContent = message;
        const styles = {
            error: { color: 'red', bg: 'rgba(255,0,0,0.1)' },
            success: { color: 'lightgreen', bg: 'rgba(0,255,0,0.1)' },
            loading: { color: 'white', bg: 'rgba(0,0,0,0.3)' }
        };
        
        adminStatus.style.color = styles[type]?.color || 'white';
        adminStatus.style.backgroundColor = styles[type]?.bg || 'transparent';
        
        if (type === 'success') {
            setTimeout(() => { 
                adminStatus.textContent = '';
                adminStatus.style.backgroundColor = 'transparent';
            }, 2000);
        }
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', async () => {
        // Load all content from Firestore
        try {
            const docRef = doc(db, "pageContent", CONTENT_DOC_ID);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                const contentData = docSnap.data();
                
                // Apply content to the page
                if (contentData.title) {
                    document.querySelector('.title-section h1').innerHTML = contentData.title;
                }
                if (contentData.timeline) {
                    document.querySelector('.history-timeline').innerHTML = contentData.timeline;
                }
                if (contentData.video) {
                    const videoContainer = document.querySelector('.video-container');
                    if (videoContainer) videoContainer.outerHTML = contentData.video;
                }
                if (contentData.footnotes) {
                    const footnotesContainer = document.querySelector('.footnotes-container');
                    if (footnotesContainer) footnotesContainer.outerHTML = contentData.footnotes;
                }
                if (contentData.reactions) {
                    const reactionContainer = document.querySelector('.reaction-container');
                    if (reactionContainer) reactionContainer.outerHTML = contentData.reactions;
                }
                if (contentData.comments) {
                    const commentsContainer = document.querySelector('.comments-container');
                    if (commentsContainer) commentsContainer.outerHTML = contentData.comments;
                }
                if (contentData.cards) {
                    const container = document.querySelector('.page10-container');
                    if (container) {
                        container.querySelectorAll('.bab-card').forEach(card => card.remove());
                        const parser = new DOMParser();
                        const newCardsDoc = parser.parseFromString(contentData.cards, 'text/html');
                        Array.from(newCardsDoc.body.children)
                            .filter(card => card.classList.contains('bab-card'))
                            .forEach(card => container.appendChild(card));
                    }
                }
            }
        } catch (error) {
            console.error("Error loading initial content:", error);
        }
        
        // Load metadata
        loadMetadata();
    });















































    // Page Management
    window.onload = function() {
        const page1 = document.getElementById("page1");
        const page2 = document.getElementById("page2");
        const page3 = document.getElementById("page3");
        const page4 = document.getElementById("page4");
        const page5 = document.getElementById("page5");
        const page6 = document.getElementById("page6");
        const page7 = document.getElementById("page7");
		  const page8 = document.getElementById("page8");
		    const page9 = document.getElementById("page9");
			const page10 = document.getElementById("page10");


        // Format waktu lengkap
        function formatTanggalLengkap(date) {
            const hari = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const bulan = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                        "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            return `${hari[date.getDay()]}, ${date.getDate()} ${bulan[date.getMonth()]} ${date.getFullYear()}`;
        }

        // Waktu terakhir update disimpan di localStorage
        let lastUpdatedTentang = localStorage.getItem("tentangLastUpdated");

        if (!lastUpdatedTentang) {
            lastUpdatedTentang = new Date("2025-07-14T00:00:00Z").toISOString();
            localStorage.setItem("tentangLastUpdated", lastUpdatedTentang);
        }

        function updateTentangRelativeTime() {
            const now = new Date();
            const updatedDate = new Date(localStorage.getItem("tentangLastUpdated"));
            const diffSec = Math.floor((now - updatedDate) / 1000);
            let waktu = "baru saja";

            if (diffSec >= 60 && diffSec < 3600)
                waktu = `${Math.floor(diffSec / 60)} menit yang lalu`;
            else if (diffSec >= 3600 && diffSec < 86400)
                waktu = `${Math.floor(diffSec / 3600)} jam yang lalu`;
            else if (diffSec >= 86400)
                waktu = `${Math.floor(diffSec / 86400)} hari yang lalu`;

            const lengkap = formatTanggalLengkap(updatedDate);
            const span = document.getElementById("tentangKamiTime");
            if (span) span.innerHTML = `${waktu} • ${lengkap}`;
        }

        // Update terus setiap 10 detik
        setInterval(updateTentangRelativeTime, 10000);
        updateTentangRelativeTime();
		
		
		
		
	 
	 // Fungsi utama untuk menampilkan halaman
function showPageContent(pageElement) {
  const pageIds = ["page1", "page2", "page3", "page4", "page5", "page6", "page7", "page8", "page9, page10"];
  
  // Sembunyikan semua halaman
  pageIds.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });

  // Tampilkan halaman yang dipilih
  if (pageElement) {
    pageElement.style.display = "block";
    
    // Jika page7, muat pengumuman dan masukan
    if (pageElement.id === "page7") {
      loadPinnedAnnouncements();
      loadFeedback().catch(console.error);
    }
  }
  
  window.scrollTo(0, 0);
}










// Fungsi untuk update sidebar dan scroll indicator
function updateScrollTracking() {
  const timelineItems = document.querySelectorAll('.timeline-item');
  const contentLinks = document.querySelectorAll('.content-link');
  const scrollIndicator = document.getElementById('scrollIndicator');
  const timeline = document.querySelector('.history-timeline');
  
  // Hitung posisi dan tinggi
  const timelineRect = timeline.getBoundingClientRect();
  const timelineStart = timelineRect.top + window.scrollY;
  const timelineEnd = timelineStart + timeline.offsetHeight;
  const scrollPosition = window.scrollY;
  
  // Update scroll indicator
  if (scrollPosition >= timelineStart && scrollPosition <= timelineEnd) {
    const scrollPercent = (scrollPosition - timelineStart) / timeline.offsetHeight;
    scrollIndicator.style.height = `${scrollPercent * 100}%`;
  } else if (scrollPosition < timelineStart) {
    scrollIndicator.style.height = '0%';
  } else {
    scrollIndicator.style.height = '100%';
  }
  
  // Update active link di sidebar
  timelineItems.forEach((item, index) => {
    const itemRect = item.getBoundingClientRect();
    const itemStart = itemRect.top + window.scrollY;
    const itemEnd = itemStart + item.offsetHeight;
    
    if (scrollPosition >= itemStart - 200 && scrollPosition < itemEnd - 200) {
      // Hapus class active dari semua link
      contentLinks.forEach(link => link.classList.remove('active'));
      
      // Tambah class active ke link yang sesuai
      contentLinks[index].classList.add('active');
      
      // Highlight item timeline
      item.style.background = 'rgba(255, 255, 255, 0.15)';
      item.style.borderColor = 'rgba(255, 255, 255, 0.5)';
    } else {
      item.style.background = 'rgba(0, 0, 0, 0.3)';
      item.style.borderColor = 'rgba(255, 255, 255, 0.2)';
    }
  });
}

// Event listener untuk scroll
window.addEventListener('scroll', updateScrollTracking);
window.addEventListener('load', updateScrollTracking);

// Smooth scroll untuk link di sidebar
document.querySelectorAll('.content-link').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    const targetId = this.getAttribute('href');
    const targetElement = document.querySelector(targetId);
    
    if (targetElement) {
      window.scrollTo({
        top: targetElement.offsetTop - 120,
        behavior: 'smooth'
      });
    }
  });
});

// Fungsi untuk navigasi halaman
function navigateToPage(pageNumber) {
  const pageElement = document.getElementById(`page${pageNumber}`);
  if (pageElement) {
    showPageContent(pageElement);
    history.pushState({ page: `page${pageNumber}` }, `Page ${pageNumber}`, `/halaman-${pageNumber}`);
  }
}





// Tambahkan ini di bagian JavaScript
document.querySelectorAll('.footnote-link').forEach(link => {
  link.addEventListener('click', function(e) {
    if(this.hash.startsWith('#footnote')) {
      e.preventDefault();
      const target = document.querySelector(this.hash);
      if(target) {
        window.scrollTo({
          top: target.offsetTop - 100,
          behavior: 'smooth'
        });
        
        // Highlight sementara
        target.style.backgroundColor = 'rgba(255,255,255,0.1)';
        setTimeout(() => {
          target.style.backgroundColor = 'transparent';
        }, 2000);
      }
    }
  });
});



	
	
	
	
	
	





























// Tambahkan event listener untuk card dashboard
  document.getElementById('dashboardCard')?.addEventListener('click', function() {
    showPageContent(document.getElementById("page11"));
    history.pushState({ page: "dashboard" }, "Dashboard", "/dashboard");
  });









// Tambahkan event listener untuk card sejarah
document.querySelectorAll('.sejarah-card').forEach(card => {
    card.addEventListener('click', function(e) {
        e.preventDefault();
        showPageContent(document.getElementById("page10"));
        history.pushState({ page: "sejarah" }, "Sejarah Arduino", "/halaman-sejarah");
    });
});




	 // Tambahkan event listener untuk tombol back di halaman 10
document.getElementById('back')?.addEventListener('click', function(e) {
  e.preventDefault();
  showPageContent(document.getElementById("page1"));
  history.pushState({ page: "home" }, "Beranda", "/");
});


        // Event listeners for navigation
        if (document.getElementById("card-arduino")) {
            document.getElementById("card-arduino").addEventListener("click", function() {
			 showPageContent(document.getElementById("page2"));
                history.pushState({ page: "arduino" }, "Arduino", "/halaman-arduino");
            });
        }

        if (document.getElementById("card-iot")) {
            document.getElementById("card-iot").addEventListener("click", function() {
                       showPageContent(document.getElementById("page3"));
                history.pushState({ page: "iot" }, "IoT", "/halaman-iot");
            });
        }

        if (document.getElementById("back")) {
            document.getElementById("back").addEventListener("click", function(e) {
                e.preventDefault();
				showPageContent(document.getElementById("page1"));
                
                history.pushState({ page: "home" }, "Beranda", "/");
            });
        }

        if (document.getElementById("back-iot")) {
            document.getElementById("back-iot").addEventListener("click", function(e) {
                e.preventDefault();
              showPageContent(document.getElementById("page1"));
                history.pushState({ page: "home" }, "Beranda", "/");
            });
        }

        if (document.getElementById("card-blog")) {
            document.getElementById("card-blog").addEventListener("click", function() {
                       showPageContent(document.getElementById("page4"));
                history.pushState({ page: "blog" }, "Blog", "/halaman-blog");
            });
        }

        if (document.getElementById("back-blog")) {
            document.getElementById("back-blog").addEventListener("click", function(e) {
                e.preventDefault();
              showPageContent(document.getElementById("page1"));
                history.pushState({ page: "home" }, "Beranda", "/");
            });
        }

        if (document.getElementById("lihatSemuaBlog")) {
            document.getElementById("lihatSemuaBlog").addEventListener("click", function(e) {
                e.preventDefault();
                showPageContent(document.getElementById("page5"));
                updateBlogCount();
                history.pushState({ page: "kumpulan-blog" }, "Kumpulan Blog", "/halaman-kumpulan-blog");
            });
        }

        if (document.getElementById("back-page5")) {
            document.getElementById("back-page5").addEventListener("click", function(e) {
                e.preventDefault();
               showPageContent(document.getElementById("page4"));
                history.pushState({ page: "blog" }, "Blog", "/halaman-blog");
            });
        }

        // Tentang kami navigation
        document.querySelectorAll('.tentangLink').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                showPageContent(document.getElementById("page6"));
            });
        });

        if (document.getElementById('back-tentang')) {
            document.getElementById('back-tentang').addEventListener('click', e => {
                e.preventDefault();
                showPageContent(document.getElementById("page1"));
            });
        }

        // Masukan navigation
        document.querySelectorAll('.masukanLink').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
               showPageContent(document.getElementById("page7"));
                history.pushState({ page: "masukan" }, "Masukan", "/halaman-masukan");
                loadFeedback();
            });
        });

        if (document.getElementById('back-masukan')) {
            document.getElementById('back-masukan').addEventListener('click', function(e) {
                e.preventDefault();
               showPageContent(document.getElementById("page1"));
                history.pushState({ page: "home" }, "Beranda", "/");
            });
        }

        // Feedback form
        if (document.getElementById('masukanForm')) {
            document.getElementById('masukanForm').addEventListener('submit', submitFeedback);
        }

        // Like and Follow buttons
        if (likeBtn) {
            likeBtn.addEventListener('click', () => {
                alert("Kamu menyukai halaman ini!");
            });
        }

        if (followBtn) {
            followBtn.addEventListener('click', () => {
                alert("Kamu mengikuti halaman ini!");
            });
        }
		
		// Forum Diskusi navigation
document.querySelectorAll('.forumLink').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
       showPageContent(document.getElementById("page8"));
        history.pushState({ page: "forum" }, "Forum", "/halaman-forum");
		initializeForumPage();
    });
});

if (document.getElementById('back-forum')) {
    document.getElementById('back-forum').addEventListener('click', function(e) {
        e.preventDefault();
        showPageContent(document.getElementById("page1"));
        history.pushState({ page: "home" }, "Beranda", "/");
    });
}
		
		
		
		window.addEventListener('load', function() {
    handleInitialNavigation();
    setupAnnouncementEventListeners();

    // Setup event listener untuk tombol kembali di halaman 9
    document.getElementById('backToAnnouncements')?.addEventListener('click', function() {
        showPageContent(document.getElementById("page7"));
        history.pushState({ page: "masukan" }, "Masukan", "/halaman-masukan");
    });
});




// Navigasi manual ke halaman 9 dari tombol, card, atau link (jika ada)
document.querySelectorAll('.detail-pengumuman').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const id = this.getAttribute('data-id');
        if (id) {
            showAnnouncementDetailById(id);
            showPageContent(document.getElementById("page9"));
            history.pushState({ page: "detail-pengumuman", id }, "Detail Pengumuman", `/halaman-masukan-${id}`);
        }
    });
});

		
		
		
		
// JavaScript untuk mengontrol tampilan teks saat video diputar
document.addEventListener('DOMContentLoaded', function() {
  const videos = document.querySelectorAll('.sponsor-video');
  
  videos.forEach(video => {
    const caption = video.parentElement.querySelector('.video-caption');
    
    video.addEventListener('play', function() {
      caption.style.display = 'block';
    });
    
    video.addEventListener('pause', function() {
      caption.style.display = 'none';
    });
    
    video.addEventListener('ended', function() {
      caption.style.display = 'none';
    });
  });
  
  // Tombol kembali
  document.getElementById('back-sponsor').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('page12').style.display = 'none';
    document.getElementById('page1').style.display = 'block';
  });
  
  // Tombol hubungi sponsor
  document.getElementById('contactSponsorBtn').addEventListener('click', function() {
    alert('Silahkan hubungi kami melalui email: sponsor@lifeiswhatitislearn.com');
  });
});		
		
		
	// Di bagian JavaScript yang sudah ada, tambahkan:
document.querySelectorAll('.sponsorLink').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    // Sembunyikan semua halaman
    document.querySelectorAll('div[id^="page"]').forEach(page => {
      page.style.display = 'none';
    });
    // Tampilkan halaman sponsor
    document.getElementById('page12').style.display = 'block';
  });
});	
		
		
		
		
		
		
		
		
document.getElementById('announcementForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const title = document.getElementById('announcementTitle').value.trim();
    const content = document.getElementById('announcementContent').value.trim();
    
    if (!title || !content) {
        alert('Judul dan isi pengumuman tidak boleh kosong!');
        return;
    }
    
    const user = auth.currentUser;
    if (!user || !isUserAdmin(user)) {
        alert('Anda tidak memiliki izin untuk membuat pengumuman!');
        return;
    }
    
    const submitBtn = document.getElementById('submitAnnouncement');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Mengirim...';
    
    try {
        const announcementData = {
    title,
    content,
    userEmail: user.email,
    userName: user.displayName || 'Admin',
    timestamp: serverTimestamp(),
    type: 'announcement',
    pinned: true,
    pinnedAt: serverTimestamp(),
    views: 0,
    likesCount: 0,
    repliesCount: 0
    // Tidak perlu slug
};

        const announcementsRef = collection(db, "announcements");
        await addDoc(announcementsRef, announcementData);

        // Reset form
        e.target.reset();
        alert('Pengumuman berhasil diposting!');
        
        // Muat ulang daftar pengumuman
        await loadPinnedAnnouncements();
        
    } catch (error) {
        console.error('Error submitting announcement:', error);
        alert('Gagal mengirim pengumuman: ' + error.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
});
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

        // Blog functions
        function updateBlogCount() {
            const blogList = document.getElementById('blogList');
            if (!blogList) return;
            
            const visibleBlogs = document.querySelectorAll('#blogList .blog-item:not([style*="display: none"])').length;
            const totalBlog = document.querySelectorAll('#blogList .blog-item').length;
            
            const blogCountDisplay = document.getElementById('blogCountDisplay');
            if (blogCountDisplay) {
                blogCountDisplay.textContent = `Menampilkan ${visibleBlogs} dari ${totalBlog} Blog`;
            }
        }

        function searchBlogs() {
            const searchInput = document.getElementById('blogSearch');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const blogItems = document.querySelectorAll('.blog-item');
            
            blogItems.forEach(item => {
                const title = item.getAttribute('data-title')?.toLowerCase() || '';
                const category = item.getAttribute('data-category')?.toLowerCase() || '';
                const tags = item.getAttribute('data-tags')?.toLowerCase() || '';
                
                if (title.includes(searchTerm) || category.includes(searchTerm) || tags.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            updateBlogCount();
        }

        // Time formatting functions
        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'baru saja';
            
            const now = new Date();
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const fullDate = date.toLocaleDateString('id-ID', options);
            
            if (diffInSeconds < 60) return `baru saja • ${fullDate}`;
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit yang lalu • ${fullDate}`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam yang lalu • ${fullDate}`;
            
            return fullDate;
        }
		

     
	 
	 
	 
	 
	 
	 


// Fungsi untuk mendapatkan jumlah replies
async function getRepliesCount(feedbackId) {
    try {
        const repliesRef = collection(db, "feedback", feedbackId, "replies");
        const snapshot = await getCountFromServer(repliesRef);
        return snapshot.data().count;
    } catch (error) {
        console.error("Error getting replies count:", error);
        return 0;
    }
}

// Fungsi untuk mendapatkan jumlah likes
async function getLikesCount(feedbackId) {
    try {
        const likesRef = collection(db, "feedback", feedbackId, "likes");
        const snapshot = await getCountFromServer(likesRef);
        return snapshot.data().count;
    } catch (error) {
        console.error("Error getting likes count:", error);
        return 0;
    }
}

// Fungsi untuk memeriksa apakah user sudah like
async function checkUserLiked(feedbackId) {
    const user = auth.currentUser;
    if (!user) return false;
    
    try {
        const likeDoc = doc(db, "feedback", feedbackId, "likes", user.uid);
        const docSnap = await getDoc(likeDoc);
        return docSnap.exists();
    } catch (error) {
        console.error("Error checking user like:", error);
        return false;
    }
}













	 
	 
	 
	 // Fungsi untuk menampilkan masukan dari cache
function displayCachedFeedback() {
    const feedbackList = document.getElementById('feedbackListContainer');
    if (!feedbackList) return;
    
    const cachedFeedback = JSON.parse(localStorage.getItem('cachedFeedback') || "[]");
    
    if (cachedFeedback.length === 0) {
        feedbackList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Belum ada masukan yang dikirim</div>';
        return;
    }
    
    feedbackList.innerHTML = '';
    cachedFeedback.forEach(item => {
        renderFeedbackItem(item.id, item);
    });
    
    updateFeedbackCount(cachedFeedback.length, true);
}
	 
	 
	 
	 // Event listener untuk form pengumuman
document.getElementById('announcementForm')?.addEventListener('submit', submitAnnouncement);

// Panggil saat auth state berubah
auth.onAuthStateChanged((user) => {
  toggleAdminForms();
  checkAndLoadFeedback();
});
	 
	 
	 
	 function showNotification(message, type = "info") {
  alert(`${type.toUpperCase()}: ${message}`);
}

	 
	 // Fungsi untuk merender item masukan dengan fitur tambahan (VERSI DIPERBAIKI)
function renderFeedbackItem(feedback, repliesCount = 0, likesCount = 0, userLiked = false) {
    const feedbackList = document.getElementById('feedbackListContainer');
    if (!feedbackList) return;
    
    
    // Pastikan kategori yang ditampilkan sesuai dengan yang disimpan
    const validCategories = ['design', 'feature', 'content', 'bug', 'arduino', 'other'];
    const category = feedback.category && validCategories.includes(feedback.category.toLowerCase()) 
        ? feedback.category.toLowerCase() 
        : 'other';
    const categoryClass = validCategories.includes(category) ? category : 'other';
    const categoryLabel = getCategoryLabel(category); // Gunakan fungsi getCategoryLabel
    


    const waktu = feedback.timestamp?.toDate ? feedback.timestamp.toDate() : new Date(feedback.timestamp || Date.now());
    const initials = feedback.userName ? feedback.userName.charAt(0).toUpperCase() : 'A';

    const feedbackItem = document.createElement('div');
    feedbackItem.className = 'feedback-item';
    feedbackItem.setAttribute('data-id', feedback.id);
    
    // Tambahkan class khusus untuk pengumuman
    if (feedback.type === 'announcement' || feedback.category === 'announcement') {
        feedbackItem.classList.add('announcement-item');
        feedbackItem.style.borderLeft = '4px solid #ff6b6b';
        feedbackItem.style.background = 'rgba(255, 107, 107, 0.05)';
    }
    
    feedbackItem.innerHTML = `
        <div class="feedback-header">
            <div class="feedback-user">
                <div class="feedback-avatar">${initials}</div>
                <div>
                    <div style="color: white; font-weight: 500;">${feedback.userName || 'Anonymous'}</div>
                    <div style="color: #aaa; font-size: 12px;">${feedback.userEmail || ''}</div>
                </div>
            </div>
            <div class="feedback-time" style="white-space: nowrap;">${formatTimeAgo(waktu)}${feedback.isCached ? ' (offline)' : ''}</div>
        </div>
        <div class="feedback-title">${feedback.title || 'Tanpa judul'}</div>
		<span class="feedback-category category-${categoryClass}">${categoryLabel}</span>
        <div class="feedback-content">${feedback.content || 'Tidak ada konten'}</div>
        
        <!-- Action buttons -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
            <div style="display: flex; gap: 15px;">
                <button class="like-btn" style="display: flex; align-items: center; background: none; border: none; color: ${userLiked ? '#4ea1ff' : '#ccc'}; cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="${userLiked ? '#4ea1ff' : 'none'}" stroke="${userLiked ? '#4ea1ff' : '#ccc'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                    </svg>
                    <span class="like-count" style="margin-left: 5px;">${likesCount}</span>
                </button>
                <button class="reply-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="reply-count" style="margin-left: 5px;">${repliesCount}</span>
                </button>
				
				 <div style="color:#ccc; display:flex; align-items:center;">
    👁️ <span class="view-count">${feedback.views || 0}</span>
  </div>
            </div>
            <button class="view-details-btn" style="background: none; border: none; color: #4ea1ff; cursor: pointer; font-size: 14px;">
                Lihat Detail
            </button>
        </div>
    `;

    feedbackList.appendChild(feedbackItem);
    
    // Add event listeners
    const likeBtn = feedbackItem.querySelector('.like-btn');
    const replyBtn = feedbackItem.querySelector('.reply-btn');
    const viewDetailsBtn = feedbackItem.querySelector('.view-details-btn');
    
    if (likeBtn) likeBtn.addEventListener('click', () => toggleLike(feedback.id));
    if (replyBtn) replyBtn.addEventListener('click', () => openReplyModal(feedback));
    if (viewDetailsBtn) viewDetailsBtn.addEventListener('click', () => viewFeedbackDetails(feedback.id));
    
    // Increment view count
    if (feedback.id) incrementViewCount(feedback.id);
}

	 
	 
	 
	 
	 
	 
	 
	 
// Fungsi untuk memeriksa dan memuat masukan saat halaman dimuat
function checkAndLoadFeedback() {
    const path = window.location.pathname || "/";
    if (path.includes("halaman-masukan") || 
        (window.history.state && window.history.state.page === "masukan")) {
        
        // Coba muat dari cache dulu untuk UX yang lebih cepat
        displayCachedFeedback();
        
        // Kemudian coba update dari Firebase
        loadFeedback().catch(console.error);
    }
}

	 
	 
	 // Fungsi untuk menambah jumlah view
async function incrementViewCount(feedbackId) {
    try {
        const feedbackRef = doc(db, "feedback", feedbackId);
        await updateDoc(feedbackRef, {
            views: increment(1)
        });
    } catch (error) {
        console.error("Error incrementing view count:", error);
    }
}

// Fungsi untuk like/unlike
async function toggleLike(feedbackId) {
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login terlebih dahulu untuk memberikan like');
        return;
    }
    
    try {
        const likeRef = doc(db, "feedback", feedbackId, "likes", user.uid);
        const likeDoc = await getDoc(likeRef);
        
        if (likeDoc.exists()) {
            // Unlike
            await deleteDoc(likeRef);
        } else {
            // Like
            await setDoc(likeRef, {
                userId: user.uid,
                timestamp: serverTimestamp()
            });
        }
        
        // Update UI
        const feedbackItem = document.querySelector(`.feedback-item[data-id="${feedbackId}"]`);
        if (feedbackItem) {
            const likeBtn = feedbackItem.querySelector('.like-btn');
            const likeCount = feedbackItem.querySelector('.like-count');
            const likeSvg = likeBtn.querySelector('svg');
            
            const currentCount = parseInt(likeCount.textContent);
            const isLiked = likeSvg.getAttribute('fill') === '#4ea1ff';
            
            if (isLiked) {
                // Unlike
                likeSvg.setAttribute('fill', 'none');
                likeSvg.setAttribute('stroke', '#ccc');
                likeBtn.style.color = '#ccc';
                likeCount.textContent = currentCount - 1;
            } else {
                // Like
                likeSvg.setAttribute('fill', '#4ea1ff');
                likeSvg.setAttribute('stroke', '#4ea1ff');
                likeBtn.style.color = '#4ea1ff';
                likeCount.textContent = currentCount + 1;
            }
        }
    } catch (error) {
        console.error("Error toggling like:", error);
        alert('Gagal mengupdate like. Silakan coba lagi nanti.');
    }
}

// Fungsi untuk membuka modal reply
function openReplyModal(feedback) {
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login terlebih dahulu untuk membalas masukan');
        return;
    }
    
    const modal = document.getElementById('replyModal');
    const originalFeedback = document.getElementById('originalFeedback');
    
    // Tampilkan feedback asli
    originalFeedback.innerHTML = `
        <div style="margin-bottom: 10px;">
            <strong style="color: white;">${feedback.userName || 'Anonymous'}</strong>
            <span style="color: #aaa; font-size: 12px; margin-left: 10px;">${formatTimeAgo(feedback.timestamp?.toDate?.() || new Date(feedback.timestamp))}</span>
        </div>
        <div style="color: white; font-weight: 500; margin-bottom: 5px;">${feedback.title}</div>
        <div style="color: #ddd;">${feedback.content}</div>
    `;
    
    // Reset form
    document.getElementById('replyContent').value = '';
    
    // Simpan feedback ID di modal
    modal.setAttribute('data-feedback-id', feedback.id);
    
    // Tampilkan modal
    modal.style.display = 'flex';
}

// Fungsi untuk menutup modal reply
function closeReplyModal() {
    document.getElementById('replyModal').style.display = 'none';
}
async function submitReply(e) {
    e.preventDefault();
    
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login terlebih dahulu untuk membalas masukan');
        return;
    }
    
    const feedbackId = document.getElementById('replyModal').getAttribute('data-feedback-id');
    const content = document.getElementById('replyContent').value.trim();
    
    if (!content) {
        alert('Isi balasan tidak boleh kosong');
        return;
    }
    
    const submitBtn = document.getElementById('submitReply');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Mengirim... <span class="loading-spinner"></span>';
    
    try {
        // Tambahkan reply ke subcollection
        const repliesRef = collection(db, "feedback", feedbackId, "replies");
        const replyDoc = await addDoc(repliesRef, {
            content,
            userId: user.uid,
            userName: user.displayName || 'Anonymous',
            userEmail: user.email,
            timestamp: serverTimestamp()
        });
        
        // Update reply count di feedback utama
        const feedbackRef = doc(db, "feedback", feedbackId);
        await updateDoc(feedbackRef, {
            replyCount: increment(1)
        });
        
        // Get feedback details to notify the author
        const feedbackDoc = await getDoc(feedbackRef);
        if (feedbackDoc.exists() && feedbackDoc.data().userId !== user.uid) {
            await createNotification(
                feedbackDoc.data().userId,
                'reply',
                `${user.displayName || 'Seseorang'} membalas masukan Anda`,
                replyDoc.id,
                `/feedback/${feedbackId}#reply-${replyDoc.id}`
            );
        }
        
        // Update UI
        const feedbackItem = document.querySelector(`.feedback-item[data-id="${feedbackId}"]`);
        if (feedbackItem) {
            const replyCount = feedbackItem.querySelector('.reply-count');
            const currentCount = parseInt(replyCount.textContent);
            replyCount.textContent = currentCount + 1;
        }
        
        closeReplyModal();
        alert('Balasan berhasil dikirim!');
        
    } catch (error) {
        console.error("Error submitting reply:", error);
        alert('Gagal mengirim balasan. Silakan coba lagi nanti.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
}

// Fungsi untuk melihat detail feedback dan replies
async function viewFeedbackDetails(feedbackId) {
    // Implementasi halaman detail feedback
    alert(`Membuka detail feedback dengan ID: ${feedbackId}`);
    // Anda bisa mengarahkan ke halaman baru atau membuka modal yang lebih besar
}

// Event listeners untuk modal reply
document.getElementById('closeReplyModal').addEventListener('click', closeReplyModal);
document.getElementById('cancelReply').addEventListener('click', closeReplyModal);
document.getElementById('replyForm').addEventListener('submit', submitReply);

// Event listeners untuk sorting
document.getElementById('sortNewest').addEventListener('click', function() {
    this.style.background = 'rgba(78, 161, 255, 0.2)';
    this.style.border = '1px solid rgba(78, 161, 255, 0.5)';
    this.style.color = '#4ea1ff';
    
    document.getElementById('sortPopular').style.background = 'rgba(255,255,255,0.05)';
    document.getElementById('sortPopular').style.border = '1px solid rgba(255,255,255,0.2)';
    document.getElementById('sortPopular').style.color = 'white';
    
    // Implementasi sorting terbaru
    loadFeedback();
});

document.getElementById('sortPopular').addEventListener('click', function() {
    this.style.background = 'rgba(78, 161, 255, 0.2)';
    this.style.border = '1px solid rgba(78, 161, 255, 0.5)';
    this.style.color = '#4ea1ff';
    
    document.getElementById('sortNewest').style.background = 'rgba(255,255,255,0.05)';
    document.getElementById('sortNewest').style.border = '1px solid rgba(255,255,255,0.2)';
    document.getElementById('sortNewest').style.color = 'white';
    
    // Implementasi sorting populer (berdasarkan jumlah like + reply)
    // Anda perlu memodifikasi query Firebase atau melakukan sorting client-side
    alert('Fitur sorting populer akan segera tersedia!');
});
	 
	 
	 
	 
	

// Event listener untuk form
document.getElementById('masukanForm')?.addEventListener('submit', submitFeedback);
// Panggil saat halaman dimuat dan setiap kali ada perubahan state
window.addEventListener('load', checkAndLoadFeedback);
window.addEventListener('popstate', checkAndLoadFeedback);

// Deteksi perubahan koneksi untuk refresh data
window.addEventListener('online', () => {
    if (window.location.pathname.includes("halaman-masukan")) {
        loadFeedback().catch(console.error);
    }
});
	 
	 

// Event listener untuk form
document.getElementById('masukanForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
  
     
    // Deklarasi semua variabel yang dibutuhkan
    const title = document.getElementById('feedbackTitle').value.trim();
    const category = document.getElementById('feedbackCategory').value;
    const content = document.getElementById('feedbackContent').value.trim();
    
    
    if (!title || !content) {
        alert('Judul dan isi masukan tidak boleh kosong!');
        return;
    }
    
    const submitBtn = document.getElementById('submitFeedback');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Mengirim... <span class="loading-spinner"></span>';
    
    const user = auth.currentUser;
    const feedbackData = {
        title,
        category,
        content,
        userName: user?.displayName || 'Anonymous',
        userEmail: user?.email || null,
        userId: user?.uid || null,
        timestamp: serverTimestamp()
    };

    try {
        // Simpan ke Firebase
        const feedbackRef = collection(db, "feedback");
        await addDoc(feedbackRef, feedbackData);
        
        // Reset form
        e.target.reset();
        
        // Perbarui tampilan
        await loadFeedback();
        
    } catch (error) {
        console.error('Error submitting feedback:', error);
        alert('Gagal mengirim masukan. Pastikan Anda terhubung ke internet.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
});



function getCategoryLabel(category) {
    const categoryMap = {
        'design': 'Desain',
        'feature': 'Fitur',
        'content': 'Konten',
        'bug': 'Bug/Masalah',
        'arduino': 'Arduino',
        'other': 'Lainnya'
    };
    
    const normalizedCategory = String(category).toLowerCase().trim();
    return categoryMap[normalizedCategory] || categoryMap['other'];
}




function renderPinnedAnnouncementItem(announcement) {
  const item = document.createElement("div");
  item.classList.add("announcement-item");

  // Pastikan judul bisa diklik dan memuat detail
  item.innerHTML = `
    <div class="announcement-title" style="cursor: pointer; color: yellow;" data-id="${announcement.id}">
      ${announcement.title}
    </div>
    <div class="announcement-date">${announcement.date}</div>
  `;

  item.querySelector(".announcement-title").addEventListener("click", () => {
    loadAnnouncementDetail(announcement.id);
  });

  return item;
}











async function submitFeedback(e) {
    e.preventDefault();
    
    const title = document.getElementById('feedbackTitle').value.trim();
    const category = document.getElementById('feedbackCategory').value;
    const validCategories = ['design', 'feature', 'content', 'bug', 'arduino', 'other'];
    const normalizedCategory = validCategories.includes(category) ? category : 'other';
    const content = document.getElementById('feedbackContent').value.trim();
    
    // Validasi input
    if (!title || !content) {
        showNotification('Judul dan isi masukan tidak boleh kosong!', 'error');
        return;
    }
    
    const submitBtn = document.getElementById('submitFeedback');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Mengirim... <span class="loading-spinner"></span>';
    
    const user = auth.currentUser;
    const feedbackData = {
        title,
        category: normalizedCategory,
        content,
        userName: user?.displayName || 'Anonymous',
        userEmail: user?.email || null,
        userId: user?.uid || null,
        timestamp: serverTimestamp(),
        status: 'new',
        likesCount: 0,
        repliesCount: 0,
        viewsCount: 0,
        isCached: false
    };

    try {
        const feedbackRef = collection(db, "feedback");
        const docRef = await addDoc(feedbackRef, feedbackData);
        
        // Create notification for admin
        await createNotification(
            'admin-user-id', // Replace with actual admin ID
            'feedback',
            `Feedback baru: ${title}`,
            docRef.id,
            `/feedback/${docRef.id}`
        );
        
        // Update UI
        const feedbackWithId = { ...feedbackData, id: docRef.id };
        const [repliesCount, likesCount, userLiked] = await Promise.all([
            getRepliesCount(docRef.id),
            getLikesCount(docRef.id),
            checkUserLiked(docRef.id)
        ]);
        
        renderFeedbackItem(feedbackWithId, repliesCount, likesCount, userLiked);
        e.target.reset();
        showNotification('Masukan berhasil dikirim!', 'success');
        
    } catch (error) {
        console.error('Error submitting feedback:', error);
        if (error.code === 'unavailable') {
            try {
                const cachedFeedback = JSON.parse(localStorage.getItem('pendingFeedback') || "[]");
                cachedFeedback.push({
                    ...feedbackData,
                    timestamp: new Date().toISOString(),
                    category: category
                });
                localStorage.setItem('pendingFeedback', JSON.stringify(cachedFeedback));
                showNotification('Masukan disimpan secara offline dan akan dikirim ketika online', 'warning');
            } catch (cacheError) {
                console.error('Error saving to cache:', cacheError);
                showNotification('Gagal mengirim masukan. Silakan coba lagi saat online.', 'error');
            }
        } else {
            showNotification('Gagal mengirim masukan: ' + error.message, 'error');
        }
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
}













// Fungsi pembantu untuk format waktu
function formatTimeAgo(timestamp) {
    if (!timestamp) return 'baru saja';
    
    const now = new Date();
    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    const options = { 
        day: 'numeric', 
        month: 'long', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    const fullDate = date.toLocaleDateString('id-ID', options);
    
    if (diffInSeconds < 60) return `baru saja • ${fullDate}`;
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit yang lalu • ${fullDate}`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam yang lalu • ${fullDate}`;
    
    return fullDate;
}


	 
	 
	 
	 // Fungsi untuk update jumlah masukan
function updateFeedbackCount(count, isCached = false) {
    const feedbackCountDisplay = document.getElementById('feedbackCountDisplay');
    if (feedbackCountDisplay) {
        feedbackCountDisplay.textContent = isCached 
            ? `Menampilkan ${count} masukan (data offline)` 
            : `Menampilkan ${count} masukan terbaru`;
    }
}





async function loadFeedback() {
    const feedbackList = document.getElementById('feedbackListContainer');
    if (!feedbackList) return;

    try {
        // Tampilkan loading state
        feedbackList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Memuat masukan...</div>';

        // Ambil data dari Firebase dengan sorting berdasarkan timestamp
        const q = query(
            collection(db, "feedback"), 
            orderBy("timestamp", "desc"),
            limit(50)
        );
        
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            feedbackList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Belum ada masukan yang dikirim</div>';
            return;
        }

        // Render feedback dari Firebase
        feedbackList.innerHTML = '';
        const feedbackItems = [];
        
        // Gunakan Promise.all untuk menunggu semua operasi async selesai
        await Promise.all(querySnapshot.docs.map(async (doc) => {
            const feedback = doc.data();
            feedback.id = doc.id;
            feedbackItems.push(feedback);
            
            const [repliesCount, likesCount, userLiked] = await Promise.all([
                getRepliesCount(doc.id),
                getLikesCount(doc.id),
                checkUserLiked(doc.id)
            ]);
            
            renderFeedbackItem(feedback, repliesCount, likesCount, userLiked);
        }));

        // Simpan ke cache
        localStorage.setItem('cachedFeedback', JSON.stringify(feedbackItems));
        updateFeedbackCount(querySnapshot.size);

    } catch (error) {
        console.error("Error loading feedback:", error);
        displayCachedFeedback();
    }
}







// Daftar email yang diizinkan (admin/contributor)
const ALLOWED_EMAILS = ['faridardiansyah061@gmail.com'];


// Fungsi untuk mengecek apakah user adalah admin/contributor
function checkAdminStatus(user) {
  if (!user || !user.email) return false;
  return ALLOWED_EMAILS.includes(user.email.toLowerCase());
}









function toggleAdminForms() {
    const user = auth.currentUser;
    const isAdmin = isUserAdmin(user);
    
    // Toggle form admin di halaman 7
    const adminFormPage7 = document.getElementById('adminAnnouncementForm');
    if (adminFormPage7) {
        adminFormPage7.style.display = isAdmin ? 'block' : 'none';
    }
    
    // Toggle form admin di halaman 9
    const adminFormPage9 = document.querySelector('#page9 #adminAnnouncementForm');
    if (adminFormPage9) {
        adminFormPage9.style.display = isAdmin ? 'block' : 'none';
    }
}












// Fungsi untuk mengecek status admin dan menampilkan form edit jika admin
function setupAdminFormForAnnouncement(announcementId, announcement) {
  const user = auth.currentUser;
  const isAdmin = isUserAdmin(user);
  const adminForm = document.getElementById('adminAnnouncementForm');
  
  if (isAdmin && adminForm) {
    adminForm.style.display = 'block';

    // Isi form edit dengan data pengumuman
    document.getElementById('editAnnouncementTitle').value = announcement.title;
    document.getElementById('editAnnouncementContent').value = announcement.content;

    // Setup event listeners untuk form edit
    document.getElementById('editAnnouncementForm').onsubmit = (e) => {
      e.preventDefault();
      updateAnnouncement(announcementId);
    };

    document.getElementById('cancelEditAnnouncement').onclick = () => {
      adminForm.style.display = 'none';
    };

    document.getElementById('deleteAnnouncement').onclick = () => {
      if (confirm('Apakah Anda yakin ingin menghapus pengumuman ini?')) {
        deleteAnnouncement(announcementId);
      }
    };
  } else if (adminForm) {
    adminForm.style.display = 'none';
  }
}

// Panggil toggleAdminForms saat auth state berubah
auth.onAuthStateChanged((user) => {
  toggleAdminForms();
  checkAndLoadFeedback();
});







async function submitAnnouncement(e) {
    e.preventDefault();

    const title = document.getElementById('announcementTitle').value.trim();
    const content = document.getElementById('announcementContent').value.trim();

    if (!title || !content) {
        showNotification('Judul dan isi pengumuman tidak boleh kosong!', 'error');
        return;
    }

    const user = auth.currentUser;
    if (!user || !checkAdminStatus(user)) {
        showNotification('Anda tidak memiliki izin untuk membuat pengumuman!', 'error');
        return;
    }

    const submitBtn = document.getElementById('submitAnnouncement');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Mengirim... <span class="loading-spinner"></span>';

    try {
        const announcementData = {
            title,
            content,
            userEmail: user.email,
            userName: user.displayName || 'Admin',
            timestamp: serverTimestamp(),
            type: 'announcement',
            pinned: true,
            pinnedAt: serverTimestamp(),
            views: 0,
            likesCount: 0,
            repliesCount: 0
        };

        // Add to Firestore
        const announcementsRef = collection(db, "announcements");
        const docRef = await addDoc(announcementsRef, announcementData);

        // Reset form
        e.target.reset();
        showNotification('Pengumuman berhasil diposting!', 'success');

        // Update cache
        const cachedAnnouncements = JSON.parse(localStorage.getItem('cachedAnnouncements') || '[]');
        cachedAnnouncements.unshift({
            ...announcementData,
            id: docRef.id
        });
        localStorage.setItem('cachedAnnouncements', JSON.stringify(cachedAnnouncements));

        // Reload announcements
        await loadPinnedAnnouncements();

    } catch (error) {
        console.error('Error submitting announcement:', error);
        showNotification('Gagal mengirim pengumuman: ' + error.message, 'error');
        
        // Try to save locally if offline
        if (error.code === 'unavailable') {
            const pendingAnnouncements = JSON.parse(localStorage.getItem('pendingAnnouncements') || '[]');
            pendingAnnouncements.push({
                title,
                content,
                timestamp: new Date().toISOString(),
                userName: user?.displayName || 'Admin'
            });
            localStorage.setItem('pendingAnnouncements', JSON.stringify(pendingAnnouncements));
            showNotification('Pengumuman disimpan offline dan akan dikirim ketika online', 'warning');
        }
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
}




async function loadPinnedAnnouncements() {
    const pinnedContainer = document.getElementById('pinnedAnnouncementsList');
    if (!pinnedContainer) return;

    try {
        // Tampilkan loading state
        pinnedContainer.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Memuat pengumuman...</div>';

        // Query untuk mendapatkan pengumuman yang dipin
        const q = query(
            collection(db, "announcements"),
            where("pinned", "==", true),
            orderBy("pinnedAt", "desc"),
            limit(25)
        );
        
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            console.warn('Pengumuman kosong dari Firebase, coba tampilkan cache');
            displayCachedAnnouncements();
            return;
        }

        const announcements = [];
        
        // Gunakan Promise.all untuk parallel processing
        await Promise.all(querySnapshot.docs.map(async (doc) => {
            const announcement = doc.data();
            announcement.id = doc.id;
            
            // Dapatkan jumlah like dan reply
            const [likesCount, repliesCount] = await Promise.all([
                getAnnouncementLikesCount(doc.id),
                getAnnouncementRepliesCount(doc.id)
            ]);
            
            announcement.likesCount = likesCount;
            announcement.repliesCount = repliesCount;
            announcements.push(announcement);
            
            // Update view count
            await incrementAnnouncementViews(doc.id);
        }));

        // Simpan ke cache dengan timestamp
        const cacheData = {
            data: announcements,
            timestamp: new Date().getTime(),
            source: 'firebase'
        };
        localStorage.setItem('cachedAnnouncements', JSON.stringify(cacheData));
        
        // Render pengumuman
        renderAnnouncements(announcements);

    } catch (error) {
        console.error("Error loading pinned announcements:", error);
        // Fallback ke cache jika error
        displayCachedAnnouncements();
    }
}






















	 
	 
	 // Fungsi untuk toggle pin pengumuman
async function togglePinAnnouncement(announcementId, currentlyPinned) {
    const user = auth.currentUser;
    if (!checkAdminStatus(user)) {
        alert('Hanya admin yang dapat mem-pin pengumuman!');
        return;
    }

    try {
        const announcementRef = doc(db, "announcements", announcementId);
        
        if (currentlyPinned) {
            // Unpin
            await updateDoc(announcementRef, {
                pinned: false,
                pinnedAt: null
            });
        } else {
            // Pin
            await updateDoc(announcementRef, {
                pinned: true,
                pinnedAt: serverTimestamp()
            });
        }
        
        // Refresh daftar pengumuman
        await loadPinnedAnnouncements();
        
    } catch (error) {
        console.error("Error toggling pin:", error);
        alert('Gagal mengubah status pin. Silakan coba lagi.');
    }
}
	 
	 
	 
	 
	 
	 // Fungsi untuk mencoba mengirim pending feedback saat online
async function sendPendingFeedback() {
    const pendingFeedback = JSON.parse(localStorage.getItem('pendingFeedback') || "[]");
    if (pendingFeedback.length === 0) return;

    try {
        const feedbackRef = collection(db, "feedback");
        
        for (const feedback of pendingFeedback) {
            await addDoc(feedbackRef, {
                ...feedback,
                timestamp: serverTimestamp(),
                isCached: true
            });
        }
        
        // Kosongkan cache setelah berhasil dikirim
        localStorage.removeItem('pendingFeedback');
        showNotification(`${pendingFeedback.length} masukan offline berhasil dikirim`, 'success');
        
    } catch (error) {
        console.error('Error sending pending feedback:', error);
    }
}

// Panggil saat online
window.addEventListener('online', sendPendingFeedback);






async function renderAnnouncements(announcements) {
  const pinnedContainer = document.getElementById('pinnedAnnouncementsList');
  if (!pinnedContainer) return;

  pinnedContainer.innerHTML = '';

  for (const announcement of announcements) {
    const waktu = announcement.timestamp?.toDate ? announcement.timestamp.toDate() : new Date(announcement.timestamp);

    // Ambil daftar user yang reply
    const repliers = await getRepliersInfo(announcement.id);
    const avatarListHTML = repliers.map(u => `
      <img src="${u.userPhoto || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(u.userName || 'U')}" 
           alt="${u.userName}" title="${u.userName}" 
           style="width: 28px; height: 28px; border-radius: 50%; border: 2px solid #fff; object-fit: cover; margin-left: -8px;">
    `).join('');

    const announcementItem = document.createElement('div');
    announcementItem.className = 'pinned-item';
    announcementItem.setAttribute('data-id', announcement.id);

    announcementItem.style.cssText = `
        margin-bottom: 15px;
        padding: 15px;
        border-radius: 10px;
        background: rgba(255, 107, 107, 0.1);
        border-left: 4px solid #ff6b6b;
        cursor: pointer;
    `;

    announcementItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
            <h3 style="color: #ff6b6b; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ff6b6b">
                    <path d="M16 12V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v8l-2 2v1h15v-1l-2-2z"/>
                </svg>
                ${announcement.title}
            </h3>
            <div style="color: #aaa; font-size: 12px;">${formatTimeAgo(waktu)}</div>
        </div>

        <div style="margin-top: 10px; display: flex; align-items: center;">
          <div style="display: flex; margin-left: -4px;">
            ${avatarListHTML}
          </div>
          <span style="color: #aaa; font-size: 12px; margin-left: 8px;">
            Telah dibalas oleh ${avatarListHTML ? 'pengguna' : 'tidak ada balasan'}
          </span>
        </div>

        <div style="color: #ddd; margin-top: 8px; line-height: 1.5;">
            ${announcement.content.substring(0, 150)}${announcement.content.length > 150 ? '...' : ''}
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="color: #aaa; font-size: 12px; font-style: italic;">
                Diposting oleh: ${announcement.userName || 'Admin'}
            </div>
            <div style="display: flex; gap: 10px;">
                <span style="color: #ccc; font-size: 12px; display: flex; align-items: center;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span class="view-count" style="margin-left: 5px;">${announcement.views || 0}</span>
                </span>
                <button class="like-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                    </svg>
                    <span class="like-count" style="margin-left: 5px;">${announcement.likesCount || 0}</span>
                </button>
                <button class="reply-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="reply-count" style="margin-left: 5px;">${announcement.repliesCount || 0}</span>
                </button>
            </div>
        </div>
        <button class="view-announcement-btn" style="background: none; border: none; color: #4ea1ff; cursor: pointer; font-size: 14px;">
            Baca Selengkapnya
        </button>
    `;

    // Event listeners
    announcementItem.addEventListener('click', async (e) => {
      if (!e.target.closest('.like-btn, .reply-btn, .view-announcement-btn')) {
        e.preventDefault();
        const id = announcementItem.getAttribute('data-id');
        if (id) {
          history.pushState({ page: "detail-pengumuman" }, "", `/halaman-masukan-${id}`);
          await showAnnouncementDetailById(id);
        }
      }
    });

    const likeBtn = announcementItem.querySelector('.like-btn');
    if (likeBtn) {
      likeBtn.addEventListener('click', async (event) => {
        event.stopPropagation();
        await toggleAnnouncementLike(announcement.id);
        const updatedLikes = await getAnnouncementLikesCount(announcement.id);
        announcementItem.querySelector('.like-count').textContent = updatedLikes;
      });
    }

    const replyBtn = announcementItem.querySelector('.reply-btn');
    if (replyBtn) {
      replyBtn.addEventListener('click', (event) => {
        event.stopPropagation();
        viewAnnouncementDetails(announcement.id);
      });
    }

    const viewBtn = announcementItem.querySelector('.view-announcement-btn');
    if (viewBtn) {
      viewBtn.addEventListener('click', async (event) => {
        event.stopPropagation();
        await viewAnnouncementDetails(announcement.id);
      });
    }

    pinnedContainer.appendChild(announcementItem);
  }
}












// Function to increment announcement views
async function incrementAnnouncementViews(announcementId) {
    try {
        const announcementRef = doc(db, "announcements", announcementId);
        await updateDoc(announcementRef, {
            views: increment(1),
            lastViewed: serverTimestamp()
        });
    } catch (error) {
        console.error("Error incrementing announcement views:", error);
    }
}






// Fungsi untuk toggle like pengumuman
async function toggleAnnouncementLike(announcementId) {
  const user = auth.currentUser;
  if (!user) {
    alert('Silakan login terlebih dahulu untuk memberikan like');
    return;
  }
  
  try {
    const likeRef = doc(db, "announcements", announcementId, "likes", user.uid);
    const likeDoc = await getDoc(likeRef);
    
    if (likeDoc.exists()) {
      // Unlike
      await deleteDoc(likeRef);
      await updateDoc(doc(db, "announcements", announcementId), {
        likesCount: increment(-1)
      });
    } else {
      // Like
      await setDoc(likeRef, {
        userId: user.uid,
        timestamp: serverTimestamp()
      });
      await updateDoc(doc(db, "announcements", announcementId), {
        likesCount: increment(1)
      });
    }
    
  } catch (error) {
    console.error("Error toggling announcement like:", error);
    throw error;
  }
}

// Fungsi untuk mendapatkan jumlah like pengumuman
async function getAnnouncementLikesCount(announcementId) {
  try {
    const docSnap = await getDoc(doc(db, "announcements", announcementId));
    return docSnap.data()?.likesCount || 0;
  } catch (error) {
    console.error("Error getting announcement likes count:", error);
    return 0;
  }
}









	 
	 function loadAnnouncements() {
  const container = document.getElementById("announcementContainer");
  container.innerHTML = "";

  firebase.database().ref('announcements').once('value', snapshot => {
    snapshot.forEach(child => {
      const data = child.val();
      const div = document.createElement("div");
      div.className = "feedback-item announcement-item";
      div.innerHTML = `
        <div class="feedback-title">${data.title}</div>
        <div class="feedback-content">${data.content}</div>
        <div style="margin-top:10px;">
          👁️ <span>${data.views || 0}</span>
          ❤️ <span>${data.likes || 0}</span>
          💬 <span>${(data.replies || []).length}</span>
        </div>
        <button onclick="likeAnnouncement('${child.key}')">Like</button>
        <button onclick="replyToAnnouncement('${child.key}')">Reply</button>
      `;
      container.appendChild(div);

      // Tambah view otomatis
      firebase.database().ref(`announcements/${child.key}/views`).transaction(v => (v || 0) + 1);
    });
  });
}














// Fungsi untuk render balasan terpisah
function renderAnnouncementReplies(replies) {
  const repliesList = document.getElementById('announcementRepliesList');
  if (!repliesList) return;

  repliesList.innerHTML = '';

  if (replies.length === 0) {
    repliesList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Belum ada balasan</div>';
    return;
  }

  replies.forEach(reply => {
    const replyElement = document.createElement('div');
    replyElement.style.cssText = 'padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 10px;';
    
    replyElement.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
        <div style="width: 30px; height: 30px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white;">
          ${reply.userName?.charAt(0).toUpperCase() || 'U'}
        </div>
        <div>
          <div style="color: white; font-size: 14px; font-weight: 500;">${reply.userName || 'User'}</div>
          <div style="color: #aaa; font-size: 12px;">${formatTimeAgo(reply.timestamp)}</div>
        </div>
      </div>
      <div style="margin-top: 10px; font-size: 15px; line-height: 1.5; color: #ddd;">
        ${reply.content}
      </div>
    `;
    
    repliesList.appendChild(replyElement);
  });

  // Update jumlah balasan
  document.getElementById('repliesCount').textContent = replies.length;
  
 const uniqueRepliers = new Map();
replies.forEach(data => {
  if (!uniqueRepliers.has(data.userEmail)) {
    uniqueRepliers.set(data.userEmail, {
      userName: data.userName,
      userPhoto: data.userPhoto || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(data.userName || 'U')
    });
  }
});


const repliersContainer = document.createElement('div');
repliersContainer.style.cssText = 'margin-top: 20px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;';

uniqueRepliers.forEach(user => {
  const avatar = document.createElement('img');
  avatar.src = user.userPhoto;
  avatar.alt = user.userName;
  avatar.title = user.userName;
  avatar.style.cssText = 'width: 32px; height: 32px; border-radius: 50%; border: 2px solid #fff; object-fit: cover;';
  repliersContainer.appendChild(avatar);
});

const container = document.getElementById("announcementRepliesContainer");
if (container) container.insertBefore(repliersContainer, container.children[1]);
}





















async function loadAnnouncementDetail(announcementId) {
    try {
        const container = document.getElementById('announcementDetailContainer');
        container.innerHTML = '<div style="color:#ccc; text-align:center; padding:30px;">Memuat pengumuman...</div>';
        
        const docRef = doc(db, "announcements", announcementId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
            throw new Error("Pengumuman tidak ditemukan");
        }
        
        const announcement = docSnap.data();
        const waktu = announcement.timestamp?.toDate ? announcement.timestamp.toDate() : new Date();
        
        // Render the announcement
        container.innerHTML = `
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                    <h2 style="color: #ff6b6b; font-size: 28px; margin: 0;">${announcement.title}</h2>
                    <div style="color: #aaa; font-size: 14px;">${formatTimeAgo(waktu)}</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div class="feedback-avatar" style="width: 40px; height: 40px; font-size: 18px;">
                        ${announcement.userName?.charAt(0).toUpperCase() || 'A'}
                    </div>
                    <div>
                        <div style="color: white; font-weight: 500;">${announcement.userName || 'Admin'}</div>
                        <div style="color: #aaa; font-size: 12px;">${announcement.userEmail || ''}</div>
                    </div>
                </div>
                
                <div style="color: #ddd; font-size: 16px; line-height: 1.6; white-space: pre-line; margin-bottom: 20px;">
                    ${announcement.content}
                </div>
                
                <div style="display: flex; gap: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="like-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                        </svg>
                        <span class="like-count" style="margin-left: 5px;">${announcement.likesCount || 0}</span>
                    </button>
                    
                    <div style="display: flex; align-items: center; color: #ccc;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span class="view-count" style="margin-left: 5px;">${announcement.views || 0}</span>
                    </div>
                </div>
            </div>
        `;
        
        // Load replies
        await loadAnnouncementReplies(announcementId);
        
        // Setup admin controls if user is admin
        if (isUserAdmin(auth.currentUser)) {
            setupAdminAnnouncementUI(auth.currentUser, announcementId, announcement);
        }
        
    } catch (error) {
        console.error("Error loading announcement:", error);
        const container = document.getElementById('announcementDetailContainer');
        container.innerHTML = `
            <div style="color:#ff6b6b; text-align:center; padding:30px;">
                Gagal memuat pengumuman: ${error.message}
                <button onclick="backToFeedbackPage()" style="margin-top: 15px; padding: 8px 16px; background: none; border: 1px solid #ff6b6b; color: #ff6b6b; cursor: pointer;">
                    Kembali ke Halaman Masukan
                </button>
            </div>
        `;
    }
}






// Fungsi untuk memuat balasan
async function loadAnnouncementReplies(announcementId) {
  const repliesList = document.getElementById('announcementRepliesList');
  if (!repliesList) return;

  repliesList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Memuat balasan...</div>';

  try {
    const q = query(
      collection(db, "announcements", announcementId, "replies"),
      orderBy("timestamp", "asc")
    );
    
    const querySnapshot = await getDocs(q);
    
    repliesList.innerHTML = '';
    
    if (querySnapshot.empty) {
      repliesList.innerHTML = '<div style="color:#ccc; text-align:center; padding:20px;">Belum ada balasan</div>';
      return;
    }
    
    querySnapshot.forEach(doc => {
      const reply = doc.data();
      const waktu = reply.timestamp?.toDate ? reply.timestamp.toDate() : new Date();
      
      const replyElement = document.createElement('div');
      replyElement.style.cssText = 'padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px;';
      
      replyElement.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
          <div style="width: 30px; height: 30px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white;">
            ${reply.userName?.charAt(0).toUpperCase() || 'U'}
          </div>
          <div>
            <div style="color: white; font-size: 14px; font-weight: 500;">${reply.userName || 'User'}</div>
            <div style="color: #aaa; font-size: 12px;">${formatTimeAgo(waktu)}</div>
          </div>
        </div>
        <div style="margin-top: 10px; font-size: 15px; line-height: 1.5; color: #ddd;">
          ${reply.content}
        </div>
      `;
      
      repliesList.appendChild(replyElement);
    });
    
    // Update jumlah balasan
    document.getElementById('repliesCount').textContent = querySnapshot.size;

  } catch (error) {
    console.error("Error loading replies:", error);
    repliesList.innerHTML = '<div style="color:#ff6b6b; text-align:center; padding:20px;">Gagal memuat balasan</div>';
  }
}







async function getAnnouncementLikesCount(announcementId) {
    try {
        const likesRef = collection(db, "announcements", announcementId, "likes");
        const snapshot = await getCountFromServer(likesRef);
        return snapshot.data().count;
    } catch (error) {
        console.error("Error getting likes count:", error);
        return 0;
    }
}

async function toggleAnnouncementLike(announcementId) {
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login untuk memberikan like');
        return;
    }
    
    try {
        const likeRef = doc(db, "announcements", announcementId, "likes", user.uid);
        const likeDoc = await getDoc(likeRef);
        
        if (likeDoc.exists()) {
            await deleteDoc(likeRef);
        } else {
            await setDoc(likeRef, {
                userId: user.uid,
                timestamp: serverTimestamp()
            });
        }
        
        // Update UI
        const likeBtn = document.querySelector('#page9 .like-btn');
        const likeCount = document.querySelector('#page9 .like-count');
        
        if (likeBtn && likeCount) {
            const currentCount = parseInt(likeCount.textContent);
            const isLiked = likeBtn.querySelector('svg').getAttribute('fill') !== 'none';
            
            likeBtn.querySelector('svg').setAttribute('fill', isLiked ? 'none' : 'currentColor');
            likeCount.textContent = isLiked ? currentCount - 1 : currentCount + 1;
        }
    } catch (error) {
        console.error("Error toggling announcement like:", error);
    }
}




// Fungsi untuk menambahkan history edit
async function addEditHistory(announcementId, editedBy, changes) {
  try {
    const historyRef = collection(db, "announcements", announcementId, "editHistory");
    await addDoc(historyRef, {
      editedBy: editedBy,
      changes: changes,
      timestamp: serverTimestamp(),
      userEmail: auth.currentUser.email,
      userName: auth.currentUser.displayName || 'Admin'
    });
  } catch (error) {
    console.error("Error adding edit history:", error);
  }
}

// Fungsi untuk memuat history edit
async function loadEditHistory(announcementId) {
  const historyContainer = document.getElementById('editHistoryContainer');
  const historyList = document.getElementById('editHistoryList');
  
  if (!historyContainer || !historyList) return;

  try {
    const q = query(
      collection(db, "announcements", announcementId, "editHistory"),
      orderBy("timestamp", "desc"),
      limit(5)
    );
    
    const querySnapshot = await getDocs(q);
    historyList.innerHTML = '';
    
    if (querySnapshot.empty) {
      historyList.innerHTML = '<div style="color:#ccc; text-align:center; padding:10px;">Belum ada riwayat perubahan</div>';
      return;
    }

    querySnapshot.forEach(doc => {
      const history = doc.data();
      const waktu = history.timestamp?.toDate ? history.timestamp.toDate() : new Date();
      
      const historyItem = document.createElement('div');
      historyItem.style.cssText = 'padding: 10px; margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;';
      
      historyItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <div style="color: #4ea1ff; font-weight: 500;">${history.userName || 'Admin'}</div>
          <div style="color: #aaa; font-size: 12px;">${formatTimeAgo(waktu)}</div>
        </div>
        <div style="color: #ddd; font-size: 14px;">
          ${renderChanges(history.changes)}
        </div>
      `;
      
      historyList.appendChild(historyItem);
    });
    
    historyContainer.style.display = 'block';
    
  } catch (error) {
    console.error("Error loading edit history:", error);
    historyList.innerHTML = '<div style="color:#ff6b6b; text-align:center; padding:10px;">Gagal memuat riwayat</div>';
  }
}

// Fungsi untuk merender perubahan
function renderChanges(changes) {
  let html = '';
  for (const [field, value] of Object.entries(changes)) {
    html += `
      <div style="margin-bottom: 5px;">
        <span style="color: #ff6b6b;">${fieldToLabel(field)}:</span>
        <div style="background: rgba(255,107,107,0.1); padding: 5px 8px; border-radius: 4px; margin-top: 3px;">
          ${value}
        </div>
      </div>
    `;
  }
  return html || '<span style="color:#aaa;">Tidak ada detail perubahan</span>';
}

// Fungsi untuk mengubah nama field menjadi label
function fieldToLabel(field) {
  const labels = {
    'title': 'Judul',
    'content': 'Isi',
    'pinned': 'Status Pin'
  };
  return labels[field] || field;
}














// Fungsi untuk memuat pengumuman terkait
async function loadRelatedAnnouncements(announcementId) {
  const relatedList = document.getElementById('relatedAnnouncementsList');
  if (!relatedList) return;

  relatedList.innerHTML = '<div style="color:#ccc; text-align:center; padding:10px;">Memuat pengumuman terkait...</div>';

  try {
    const q = query(
      collection(db, "announcements"),
      where("pinned", "==", true),
      orderBy("timestamp", "desc"),
      limit(3)
    );
    
    const querySnapshot = await getDocs(q);
    relatedList.innerHTML = '';
    
    let addedCount = 0;
    querySnapshot.forEach(doc => {
      if (doc.id === announcementId || addedCount >= 3) return;
      
      addedCount++;
      const announcement = doc.data();
      const waktu = announcement.timestamp?.toDate ? announcement.timestamp.toDate() : new Date();
      
      const item = document.createElement('div');
      item.style.cssText = 'padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; cursor: pointer;';
      item.onclick = () => showAnnouncementDetailById(doc.id);
      
      item.innerHTML = `
        <h3 style="color: #4ea1ff; font-size: 16px; margin-bottom: 5px;">
          ${announcement.title.substring(0, 50)}${announcement.title.length > 50 ? '...' : ''}
        </h3>
        <div style="color: #aaa; font-size: 14px;">
          ${announcement.content.substring(0, 80)}${announcement.content.length > 80 ? '...' : ''}
        </div>
        <div style="color: #666; font-size: 12px; margin-top: 5px;">${formatTimeAgo(waktu)}</div>
      `;
      
      relatedList.appendChild(item);
    });
    
    if (addedCount === 0) {
      relatedList.innerHTML = '<div style="color:#ccc; text-align:center; padding:10px;">Tidak ada pengumuman terkait</div>';
    }
  } catch (error) {
    console.error("Error loading related announcements:", error);
    relatedList.innerHTML = '<div style="color:#ff6b6b; text-align:center; padding:10px;">Gagal memuat pengumuman terkait</div>';
  }
}












// Fungsi untuk mendapatkan jumlah balasan
async function getAnnouncementRepliesCount(announcementId) {
  try {
    const repliesRef = collection(db, "announcements", announcementId, "replies");
    const snapshot = await getCountFromServer(repliesRef);
    return snapshot.data().count;
  } catch (error) {
    console.error("Error getting replies count:", error);
    return 0;
  }
}




async function viewAnnouncementDetails(announcementId) {
    try {
        // Ambil data pengumuman dari Firestore
        const docRef = doc(db, "announcements", announcementId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
            throw new Error("Pengumuman tidak ditemukan");
        }
        
        const announcement = docSnap.data();
        const waktu = announcement.timestamp?.toDate ? announcement.timestamp.toDate() : new Date();
        
        // Render ke dalam container yang sama dengan halaman masukan
        const feedbackList = document.getElementById('feedbackListContainer');
        feedbackList.innerHTML = `
            <div class="feedback-item announcement-item" style="border-left: 4px solid #ff6b6b;">
                <div class="feedback-header">
                    <div class="feedback-user">
                        <div class="feedback-avatar">${announcement.userName?.charAt(0).toUpperCase() || 'A'}</div>
                        <div>
                            <div style="color: white; font-weight: 500;">${announcement.userName || 'Admin'}</div>
                            <div style="color: #aaa; font-size: 12px;">${announcement.userEmail || ''}</div>
                        </div>
                    </div>
                    <div class="feedback-time">${formatTimeAgo(waktu)}</div>
                </div>
                
                <div class="feedback-title">${announcement.title}</div>
                <div class="feedback-content" style="white-space: pre-line;">${announcement.content}</div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button id="backToAnnouncements" style="background: none; border: none; color: #4ea1ff; cursor: pointer;">
                        ← Kembali ke Daftar Pengumuman
                    </button>
                </div>
            </div>
            
            <!-- Bagian untuk replies -->
            <div id="announcementRepliesContainer" style="margin-top: 30px;">
                <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                    Balasan (${announcement.repliesCount || 0})
                </h3>
                <div id="announcementRepliesList"></div>
                
                <form id="announcementReplyForm" style="margin-top: 20px;">
                    <textarea id="announcementReplyContent" rows="3" placeholder="Tulis balasan Anda..." 
                              style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); 
                                     border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                                     color: white; margin-bottom: 10px;"></textarea>
                    <button type="submit" style="padding: 8px 15px; background: #4ea1ff; border: none; 
                                                border-radius: 8px; color: white; cursor: pointer;">
                        Kirim Balasan
                    </button>
                </form>
            </div>
        `;
        
        // Load replies
        await loadAnnouncementReplies(announcementId);
        
        // Tambahkan event listener untuk tombol kembali
        document.getElementById('backToAnnouncements').addEventListener('click', () => {
            loadPinnedAnnouncements();
        });
        
        // Tambahkan event listener untuk form reply
        document.getElementById('announcementReplyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await submitAnnouncementReply(announcementId);
        });
        
    } catch (error) {
        console.error("Error loading announcement:", error);
        const feedbackList = document.getElementById('feedbackListContainer');
        feedbackList.innerHTML = `
            <div class="feedback-item" style="color: #ff6b6b; text-align: center; padding: 30px;">
                Gagal memuat pengumuman: ${error.message}
                <button id="backToAnnouncements" style="display: block; margin: 20px auto; padding: 8px 15px; 
                                                     background: none; border: 1px solid #ff6b6b; 
                                                     color: #ff6b6b; cursor: pointer;">
                    Kembali ke Daftar Pengumuman
                </button>
            </div>
        `;
        document.getElementById('backToAnnouncements').addEventListener('click', () => {
            loadPinnedAnnouncements();
        });
    }
}






// Fungsi untuk render detail pengumuman
function renderAnnouncementDetail(announcement, waktu) {
  const container = document.getElementById('announcementDetailContainer');
  
  container.innerHTML = `
    <div style="margin-bottom: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
        <h2 style="color: #ff6b6b; font-size: 28px; margin: 0;">${announcement.title}</h2>
        <div style="color: #aaa; font-size: 14px;">${formatTimeAgo(waktu)}</div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
        <div class="feedback-avatar" style="width: 40px; height: 40px; font-size: 18px;">
          ${announcement.userName?.charAt(0).toUpperCase() || 'A'}
        </div>
        <div>
          <div style="color: white; font-weight: 500;">${announcement.userName || 'Admin'}</div>
          <div style="color: #aaa; font-size: 12px;">${announcement.userEmail || ''}</div>
        </div>
      </div>
      
      <div style="color: #ddd; font-size: 16px; line-height: 1.6; white-space: pre-line; margin-bottom: 20px;">
        ${announcement.content}
      </div>
      
      <div style="display: flex; gap: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
        <button class="like-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
          </svg>
          <span class="like-count" style="margin-left: 5px;">${announcement.likesCount || 0}</span>
        </button>
        
        <div style="display: flex; align-items: center; color: #ccc;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          <span class="view-count" style="margin-left: 5px;">${announcement.views || 0}</span>
        </div>
      </div>
    </div>
  `;
  
  // Tambahkan event listener untuk like button
  container.querySelector('.like-btn').addEventListener('click', () => {
    toggleAnnouncementLike(announcement.id);
  });
}




function renderDetailPengumuman(data) {
  const detailContainer = document.getElementById("page9Content");
  if (!detailContainer) return;

  detailContainer.innerHTML = `
    <h2>${data.title}</h2>
    <p>${data.content}</p>
    <small>Dibuat oleh: ${data.author || "Anonim"}</small>
  `;
}




// Fungsi untuk mengecek status admin
function isUserAdmin(user) {
  if (!user || !user.email) return false;
  const adminEmails = ['faridardiansyah061@gmail.com']; // Ganti dengan email admin yang valid
  return adminEmails.includes(user.email.toLowerCase());
}















// Function to handle admin UI for announcements
function setupAdminAnnouncementUI(user, announcementId, announcement) {
  const adminForm = document.getElementById('adminAnnouncementForm');
  const isAdmin = isUserAdmin(user); // Use the separate function
  
  if (isAdmin) {
    adminForm.style.display = 'block';
    document.getElementById('editAnnouncementTitle').value = announcement.title;
    document.getElementById('editAnnouncementContent').value = announcement.content;

    document.getElementById('editAnnouncementForm').onsubmit = (e) => {
      e.preventDefault();
      updateAnnouncement(announcementId);
    };

    document.getElementById('cancelEditAnnouncement').onclick = () => {
      adminForm.style.display = 'none';
    };

    document.getElementById('deleteAnnouncement').onclick = () => {
      if (confirm('Apakah Anda yakin ingin menghapus pengumuman ini?')) {
        deleteAnnouncement(announcementId);
      }
    };
  } else {
    adminForm.style.display = 'none';
  }
}













// Fungsi untuk mengecek status admin dan menampilkan form edit jika admin
function checkAdminStatus(user, announcementId, announcement) {
const isAdmin = checkAdminStatus(user); // Use the existing function
  const adminForm = document.getElementById('adminAnnouncementForm');
  
  if (isAdmin) {
    adminForm.style.display = 'block';

    // Isi form edit dengan data pengumuman
    document.getElementById('editAnnouncementTitle').value = announcement.title;
    document.getElementById('editAnnouncementContent').value = announcement.content;

    // Setup event listeners untuk form edit
    document.getElementById('editAnnouncementForm').onsubmit = (e) => {
      e.preventDefault();
      updateAnnouncement(announcementId);
    };

    document.getElementById('cancelEditAnnouncement').onclick = () => {
      adminForm.style.display = 'none';
    };

    document.getElementById('deleteAnnouncement').onclick = () => {
      if (confirm('Apakah Anda yakin ingin menghapus pengumuman ini?')) {
        deleteAnnouncement(announcementId);
      }
    };
  } else {
    adminForm.style.display = 'none';
  }
}







// Fungsi untuk setup form balasan
function setupReplyForm(announcementId) {
  const user = auth.currentUser;
  const replyForm = document.getElementById('announcementReplyForm');
  const loginToReply = document.getElementById('loginToReply');
  
  if (user) {
    replyForm.style.display = 'block';
    loginToReply.style.display = 'none';
    
    replyForm.onsubmit = async (e) => {
      e.preventDefault();
      const content = document.getElementById('announcementReplyContent').value.trim();
      
      if (!content) {
        alert('Isi balasan tidak boleh kosong');
        return;
      }
      
      const submitBtn = replyForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = 'Mengirim...';
      
      try {
      await addDoc(collection(db, "announcements", announcementId, "replies"), {
  content,
  userId: user.uid,
  userName: user.displayName || 'Anonymous',
  userEmail: user.email,
  userPhoto: user.photoURL || '',
  timestamp: serverTimestamp()
});
        
        // Update reply count
        await updateDoc(doc(db, "announcements", announcementId), {
          repliesCount: increment(1)
        });
        
        // Refresh replies
        await loadAnnouncementReplies(announcementId);
        
        // Reset form
        document.getElementById('announcementReplyContent').value = '';
        
      } catch (error) {
        console.error("Error submitting reply:", error);
        alert('Gagal mengirim balasan');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    };
  } else {
    replyForm.style.display = 'none';
    loginToReply.style.display = 'block';
    
    document.getElementById('loginLink').onclick = (e) => {
      e.preventDefault();
      // Implement login logic here
      alert('Silakan login terlebih dahulu');
    };
  }
}







// Modifikasi fungsi updateAnnouncement untuk menyimpan history
async function updateAnnouncement(announcementId) {
  const title = document.getElementById('editAnnouncementTitle').value.trim();
  const content = document.getElementById('editAnnouncementContent').value.trim();
  
  if (!title || !content) {
    showNotification('Judul dan isi pengumuman tidak boleh kosong!', 'error');
    return;
  }

  const submitBtn = document.querySelector('#editAnnouncementForm button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = 'Menyimpan...';

  try {
    // Dapatkan data sebelum diubah untuk membandingkan perubahan
    const docRef = doc(db, "announcements", announcementId);
    const docSnap = await getDoc(docRef);
    const oldData = docSnap.data();
    
    const changes = {};
    
    // Catat perubahan judul
    if (oldData.title !== title) {
      changes.title = title;
    }
    
    // Catat perubahan isi
    if (oldData.content !== content) {
      changes.content = content;
    }
    
    // Jika ada perubahan, simpan ke history
    if (Object.keys(changes).length > 0) {
      await addEditHistory(
        announcementId, 
        auth.currentUser.displayName || 'Admin',
        changes
      );
    }
    
    // Update dokumen utama
    await updateDoc(docRef, {
      title,
      content,
      lastUpdated: serverTimestamp()
    });

    showNotification('Pengumuman berhasil diperbarui!', 'success');
    
    // Refresh data pengumuman dan history
    await showAnnouncementDetailById(announcementId);
    await loadEditHistory(announcementId);
    
  } catch (error) {
    console.error("Error updating announcement:", error);
    showNotification('Gagal memperbarui pengumuman: ' + error.message, 'error');
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
  }
}















// Fungsi untuk mengirim balasan
async function submitAnnouncementReply(announcementId) {
  const content = document.getElementById('announcementReplyContent').value.trim();
  if (!content) {
    alert('Isi balasan tidak boleh kosong');
    return;
  }
  
  const user = auth.currentUser;
  if (!user) {
    alert('Silakan login untuk membalas');
    return;
  }
  
  const submitBtn = document.querySelector('#announcementReplyForm button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = 'Mengirim...';
  
  try {
    await addDoc(collection(db, "announcements", announcementId, "replies"), {
  content,
  userId: user.uid,
  userName: user.displayName || 'Anonymous',
  userEmail: user.email,
  userPhoto: user.photoURL || '',
  timestamp: serverTimestamp()
});
    
    // Update reply count
    await updateDoc(doc(db, "announcements", announcementId), {
      repliesCount: increment(1)
    });
    
    // Reset form dan muat ulang balasan
    document.getElementById('announcementReplyContent').value = '';
    await loadAnnouncementReplies(announcementId);
    
  } catch (error) {
    console.error("Error submitting reply:", error);
    alert('Gagal mengirim balasan');
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
  }
}










// Fungsi untuk setup event listeners di halaman detail
function setupAnnouncementDetailEvents(announcementId) {
  // Tombol like
  document.querySelector('#announcementDetailContainer .like-btn')?.addEventListener('click', async () => {
    await toggleAnnouncementLike(announcementId);
    // Update like count
    const likesCount = await getAnnouncementLikesCount(announcementId);
    document.querySelector('#announcementDetailContainer .like-count').textContent = likesCount;
  });

  // Tombol kembali
  document.getElementById('backToAnnouncements')?.addEventListener('click', () => {
    document.getElementById('page9').style.display = 'none';
    document.getElementById('page7').style.display = 'block';
    history.pushState({ page: "masukan" }, "Halaman Masukan", "/halaman-masukan");
  });

  // Form balasan
  document.getElementById('announcementReplyForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    await submitAnnouncementReply(announcementId);
  });
}

// Fungsi untuk menampilkan halaman error
function showErrorPage(message) {
  const container = document.getElementById('announcementDetailContainer');
  if (container) {
    container.innerHTML = `
      <div style="color: #ff6b6b; text-align: center; padding: 30px;">
        <h3 style="margin-bottom: 15px;">Terjadi Kesalahan</h3>
        <p style="margin-bottom: 20px;">${message}</p>
        <button onclick="location.reload()" style="padding: 8px 16px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Muat Ulang Halaman
        </button>
      </div>
    `;
  }
}

// Fungsi untuk mengirim balasan pengumuman
async function submitAnnouncementReply(announcementId) {
  const user = auth.currentUser;
  if (!user) {
    alert('Silakan login untuk membalas pengumuman');
    return;
  }

  const content = document.getElementById('announcementReplyContent').value.trim();
  if (!content) {
    alert('Isi balasan tidak boleh kosong');
    return;
  }

  const submitBtn = document.querySelector('#announcementReplyForm button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = 'Mengirim...';

  try {
    // Tambahkan balasan ke Firestore
    const repliesRef = collection(db, "announcements", announcementId, "replies");
    await addDoc(repliesRef, {
      content,
      userId: user.uid,
      userName: user.displayName || 'Anonymous',
      userEmail: user.email,
      timestamp: serverTimestamp()
    });

    // Update jumlah balasan
    const announcementRef = doc(db, "announcements", announcementId);
    await updateDoc(announcementRef, {
      repliesCount: increment(1)
    });

    // Perbarui tampilan
    const repliesCount = await getAnnouncementRepliesCount(announcementId);
    document.getElementById('repliesCount').textContent = repliesCount;
    await loadAnnouncementReplies(announcementId);

    // Reset form
    document.getElementById('announcementReplyContent').value = '';

  } catch (error) {
    console.error("Error submitting reply:", error);
    alert('Gagal mengirim balasan');
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
  }
}













// Variabel untuk menyimpan data history
let editHistoryData = [];
let currentComparisonIndex = 0;

// Fungsi untuk menampilkan modal perbandingan
async function showEditComparison(announcementId) {
  try {
    // Dapatkan data history dari Firestore
    const q = query(
      collection(db, "announcements", announcementId, "editHistory"),
      orderBy("timestamp", "desc")
    );
    const querySnapshot = await getDocs(q);
    
    if (querySnapshot.empty) {
      throw new Error("Tidak ada riwayat perubahan");
    }
    
    // Simpan data history
    editHistoryData = [];
    querySnapshot.forEach(doc => {
      const history = doc.data();
      editHistoryData.push({
        id: doc.id,
        ...history,
        timestamp: history.timestamp?.toDate ? history.timestamp.toDate() : new Date()
      });
    });
    
    // Reset index
    currentComparisonIndex = 0;
    
    // Tampilkan modal
    document.getElementById('editComparisonModal').style.display = 'flex';
    
    // Tampilkan perubahan pertama
    displayComparison(currentComparisonIndex);
    
  } catch (error) {
    console.error("Error showing edit comparison:", error);
    alert('Gagal memuat riwayat perubahan: ' + error.message);
  }
}

// Fungsi untuk menampilkan perbandingan tertentu
function displayComparison(index) {
  if (index < 0 || index >= editHistoryData.length) return;
  
  const history = editHistoryData[index];
  
  // Update info pengguna
  const userPhoto = document.getElementById('comparisonUserPhoto');
  const userInitial = document.getElementById('comparisonUserInitial');
  const userName = document.getElementById('comparisonUserName');
  const editDate = document.getElementById('comparisonEditDate');
  
  if (history.userPhoto) {
    userPhoto.src = history.userPhoto;
    userPhoto.style.display = 'block';
    userInitial.style.display = 'none';
  } else {
    userInitial.textContent = history.userName?.charAt(0).toUpperCase() || 'A';
    userInitial.style.display = 'flex';
    userPhoto.style.display = 'none';
  }
  
  userName.textContent = history.userName || 'Admin';
  editDate.textContent = formatFullDate(history.timestamp);
  
  // Update counter
  document.getElementById('comparisonCounter').textContent = 
    `Perubahan ${index + 1} dari ${editHistoryData.length}`;
  
  // Update tombol navigasi
  document.getElementById('prevComparison').disabled = index === 0;
  document.getElementById('nextComparison').disabled = index === editHistoryData.length - 1;
  
  // Dapatkan data sebelum perubahan (data sebelumnya dalam array)
  const beforeData = index < editHistoryData.length - 1 ? 
    editHistoryData[index + 1] : 
    { title: history.changes.oldTitle || '', content: history.changes.oldContent || '' };
  
  // Tampilkan perbandingan
  const beforeEdit = document.getElementById('beforeEditContent');
  const afterEdit = document.getElementById('afterEditContent');
  
  // Judul
  beforeEdit.innerHTML = `
    <div style="margin-bottom: 20px;">
      <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Judul:</div>
      <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
        ${beforeData.title || history.changes.oldTitle || '(Tidak ada judul)'}
      </div>
    </div>
    <div>
      <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Isi:</div>
      <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; white-space: pre-line;">
        ${beforeData.content || history.changes.oldContent || '(Tidak ada konten)'}
      </div>
    </div>
  `;
  
  // Highlight perubahan
  afterEdit.innerHTML = `
    <div style="margin-bottom: 20px;">
      <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Judul:</div>
      <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
        ${highlightTextChanges(
          beforeData.title || history.changes.oldTitle || '', 
          history.changes.title || history.changes.newTitle || ''
        )}
      </div>
    </div>
    <div>
      <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Isi:</div>
      <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; white-space: pre-line;">
        ${highlightTextChanges(
          beforeData.content || history.changes.oldContent || '', 
          history.changes.content || history.changes.newContent || ''
        )}
      </div>
    </div>
  `;
}

// Fungsi untuk memformat tanggal lengkap
function formatFullDate(date) {
  if (!date) return 'Tanggal tidak diketahui';
  
  const options = { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  return date.toLocaleDateString('id-ID', options);
}

// Fungsi untuk highlight perubahan teks (versi sederhana)
function highlightTextChanges(oldText, newText) {
  if (oldText === newText) return newText || '(Tidak ada perubahan)';
  
  // Ini adalah implementasi sederhana, Anda bisa menggunakan library diff seperti diff-match-patch
  // untuk hasil yang lebih akurat
  
  // Jika teks baru lebih panjang, anggap ada penambahan
  if (newText.length > oldText.length) {
    const unchangedPart = oldText;
    const addedPart = newText.substring(oldText.length);
    
    return `${unchangedPart}<span style="background-color: rgba(78,161,255,0.3); border-left: 2px solid #4ea1ff; padding-left: 4px;">${addedPart}</span>`;
  } 
  // Jika teks baru lebih pendek, anggap ada penghapusan
  else if (newText.length < oldText.length) {
    const unchangedPart = newText;
    const removedPart = oldText.substring(newText.length);
    
    return `${unchangedPart}<span style="background-color: rgba(255,107,107,0.3); border-left: 2px solid #ff6b6b; padding-left: 4px; text-decoration: line-through;">${removedPart}</span>`;
  }
  // Jika panjang sama tapi berbeda konten
  else {
    return `<span style="background-color: rgba(255,255,0,0.3); border-left: 2px solid yellow; padding-left: 4px;">${newText}</span>`;
  }
}

// Event listeners untuk navigasi
document.getElementById('prevComparison')?.addEventListener('click', () => {
  if (currentComparisonIndex > 0) {
    currentComparisonIndex--;
    displayComparison(currentComparisonIndex);
  }
});

document.getElementById('nextComparison')?.addEventListener('click', () => {
  if (currentComparisonIndex < editHistoryData.length - 1) {
    currentComparisonIndex++;
    displayComparison(currentComparisonIndex);
  }
});

// Event listener untuk tombol close
document.getElementById('closeEditComparison')?.addEventListener('click', () => {
  document.getElementById('editComparisonModal').style.display = 'none';
});

// Event listener untuk klik di luar modal
document.getElementById('editComparisonModal')?.addEventListener('click', function(e) {
  if (e.target === this) {
    document.getElementById('editComparisonModal').style.display = 'none';
  }
});





// Fungsi untuk menutup popup perbandingan
function closeEditComparison() {
  document.getElementById('editComparisonModal').style.display = 'none';
}








































































// Global variables for forum
let allDiscussions = [];
let filteredDiscussions = [];
let currentPage = 1;
const discussionsPerPage = 10;





// Forum Diskusi Functions
function initializeForumPage() {
  // Load discussions from Firebase
  loadDiscussions();
  
  // Event listeners
  document.getElementById('searchForumBtn').addEventListener('click', searchDiscussions);
  document.getElementById('forumSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') searchDiscussions();
  });
  
  // Category filter
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.category-btn').forEach(b => {
        b.style.background = 'rgba(255,255,255,0.05)';
        b.style.border = '1px solid rgba(255,255,255,0.2)';
        b.style.color = 'white';
      });
      
      this.style.background = 'rgba(78, 161, 255, 0.2)';
      this.style.border = '1px solid rgba(78, 161, 255, 0.5)';
      this.style.color = '#4ea1ff';
      
      const category = this.getAttribute('data-category');
      filterDiscussionsByCategory(category);
    });
  });
  
  // Discussion filter
  document.getElementById('filterLatest').addEventListener('click', function() {
    document.getElementById('filterLatest').style.background = 'rgba(78, 161, 255, 0.2)';
    document.getElementById('filterLatest').style.border = '1px solid rgba(78, 161, 255, 0.5)';
    document.getElementById('filterLatest').style.color = '#4ea1ff';
    
    document.getElementById('filterHot').style.background = 'rgba(255,255,255,0.05)';
    document.getElementById('filterHot').style.border = '1px solid rgba(255,255,255,0.2)';
    document.getElementById('filterHot').style.color = 'white';
    
    filterDiscussions('latest');
  });
  
  document.getElementById('filterHot').addEventListener('click', function() {
    document.getElementById('filterHot').style.background = 'rgba(244, 67, 54, 0.2)';
    document.getElementById('filterHot').style.border = '1px solid rgba(244, 67, 54, 0.5)';
    document.getElementById('filterHot').style.color = '#F44336';
    
    document.getElementById('filterLatest').style.background = 'rgba(255,255,255,0.05)';
    document.getElementById('filterLatest').style.border = '1px solid rgba(255,255,255,0.2)';
    document.getElementById('filterLatest').style.color = 'white';
    
    filterDiscussions('hot');
  });
  
  // New discussion modal
  document.getElementById('newDiscussionBtn').addEventListener('click', function() {
    const user = auth.currentUser;
    if (!user) {
      alert('Silakan login terlebih dahulu untuk membuat diskusi baru');
      return;
    }
    document.getElementById('newDiscussionModal').style.display = 'flex';
  });
  
  document.getElementById('cancelDiscussion').addEventListener('click', function() {
    document.getElementById('newDiscussionModal').style.display = 'none';
    document.getElementById('newDiscussionForm').reset();
  });
  
  document.getElementById('newDiscussionForm').addEventListener('submit', function(e) {
    e.preventDefault();
    createNewDiscussion();
  });
  
  // Pagination
  document.getElementById('prevPageBtn').addEventListener('click', goToPrevPage);
  document.getElementById('nextPageBtn').addEventListener('click', goToNextPage);
}


// Load discussions from Firebase
async function loadDiscussions() {
  try {
    const q = query(collection(db, "discussions"), orderBy("createdAt", "desc"));
    const querySnapshot = await getDocs(q);
    
    allDiscussions = [];
    querySnapshot.forEach(doc => {
      const discussion = doc.data();
      discussion.id = doc.id;
      allDiscussions.push(discussion);
    });
    
    filteredDiscussions = [...allDiscussions];
    displayDiscussions();
  } catch (error) {
    console.error("Error loading discussions:", error);
    alert("Gagal memuat diskusi. Silakan coba lagi nanti.");
  }
}

// Display discussions with pagination
function displayDiscussions() {
  const startIndex = (currentPage - 1) * discussionsPerPage;
  const endIndex = startIndex + discussionsPerPage;
  const paginatedDiscussions = filteredDiscussions.slice(startIndex, endIndex);
  
  const discussionList = document.getElementById('discussionList');
  discussionList.innerHTML = '';
  
  if (paginatedDiscussions.length === 0) {
    discussionList.innerHTML = '<div style="color: #ccc; text-align: center; padding: 40px;">Tidak ada diskusi yang ditemukan</div>';
    return;
  }
  
  paginatedDiscussions.forEach(discussion => {
    const discussionItem = document.createElement('div');
    discussionItem.className = 'bab-card discussion-item';
    discussionItem.style.marginBottom = '20px';
    discussionItem.style.padding = '20px';
    discussionItem.style.transition = 'all 0.3s';
    discussionItem.style.cursor = 'pointer';
    discussionItem.dataset.id = discussion.id;
    discussionItem.dataset.category = discussion.category;
    discussionItem.dataset.views = discussion.views || 0;
    discussionItem.dataset.replies = discussion.replyCount || 0;
    discussionItem.dataset.createdAt = discussion.createdAt?.toDate().getTime() || new Date().getTime();
    
    // Get first letter of author name for avatar
    const authorInitial = discussion.authorName ? discussion.authorName.charAt(0).toUpperCase() : 'A';
    
    // Format time
    const createdAt = discussion.createdAt?.toDate() || new Date();
    const timeAgo = formatTimeAgo(createdAt);
    
    discussionItem.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #4ea1ff; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
            ${authorInitial}
          </div>
          <div>
            <div style="color: white; font-weight: bold;">${discussion.authorName || 'Anonymous'}</div>
            <div style="color: #aaa; font-size: 12px;">${timeAgo}</div>
          </div>
        </div>
        <span style="color: ${getCategoryColor(discussion.category)}; font-size: 14px; background: ${getCategoryBackground(discussion.category)}; padding: 5px 10px; border-radius: 10px;">
          ${getCategoryLabel(discussion.category)}
        </span>
      </div>
      
      <h3 style="color: white; font-size: 20px; margin-bottom: 10px;">
        ${discussion.title}
      </h3>
      
      <p style="color: #ccc; margin-bottom: 15px; line-height: 1.6;">
        ${discussion.content.substring(0, 150)}${discussion.content.length > 150 ? '...' : ''}
      </p>
      
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; gap: 15px;">
          <div style="display: flex; align-items: center; gap: 5px; color: #ccc;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
            </svg>
            ${discussion.likes || 0}
          </div>
          <div style="display: flex; align-items: center; gap: 5px; color: #ccc;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            ${discussion.replyCount || 0}
          </div>
          <div style="display: flex; align-items: center; gap: 5px; color: #ccc;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            ${discussion.views || 0}
          </div>
        </div>
        
        <a href="#" class="view-discussion" style="color: #4ea1ff; text-decoration: none; display: flex; align-items: center; gap: 5px;">
          Lihat diskusi
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>
    `;
    
    discussionList.appendChild(discussionItem);
    
    // Add click event to view discussion
    discussionItem.querySelector('.view-discussion').addEventListener('click', function(e) {
      e.preventDefault();
      viewDiscussion(discussion.id);
    });
  });
  
  // Update pagination
  updatePagination();
}

// Filter discussions by category
function filterDiscussionsByCategory(category) {
  if (category === 'all') {
    filteredDiscussions = [...allDiscussions];
  } else {
    filteredDiscussions = allDiscussions.filter(discussion => discussion.category === category);
  }
  
  currentPage = 1;
  displayDiscussions();
}

// Filter discussions by type (latest/hot)
function filterDiscussions(type) {
  if (type === 'latest') {
    filteredDiscussions.sort((a, b) => {
      const dateA = a.createdAt?.toDate() || new Date(0);
      const dateB = b.createdAt?.toDate() || new Date(0);
      return dateB - dateA;
    });
  } else if (type === 'hot') {
    filteredDiscussions.sort((a, b) => {
      const popularityA = (a.replyCount || 0) + (a.likes || 0) + (a.views || 0);
      const popularityB = (b.replyCount || 0) + (b.likes || 0) + (b.views || 0);
      return popularityB - popularityA;
    });
  }
  
  currentPage = 1;
  displayDiscussions();
}

// Search discussions
function searchDiscussions() {
  const searchTerm = document.getElementById('forumSearch').value.toLowerCase();
  
  if (!searchTerm) {
    filteredDiscussions = [...allDiscussions];
  } else {
    filteredDiscussions = allDiscussions.filter(discussion => {
      return discussion.title.toLowerCase().includes(searchTerm) || 
             discussion.content.toLowerCase().includes(searchTerm);
    });
  }
  
  currentPage = 1;
  displayDiscussions();
}


// View discussion details
function viewDiscussion(discussionId) {
  // Increment view count
  const discussionRef = doc(db, "discussions", discussionId);
  updateDoc(discussionRef, {
    views: increment(1)
  });
  
  // TODO: Implement detailed view page or modal
  alert(`Membuka diskusi dengan ID: ${discussionId}`);
}

// Pagination functions
function updatePagination() {
  const totalPages = Math.ceil(filteredDiscussions.length / discussionsPerPage);
  const pageNumbers = document.getElementById('pageNumbers');
  pageNumbers.innerHTML = '';
  
  for (let i = 1; i <= totalPages; i++) {
    const pageBtn = document.createElement('button');
    pageBtn.textContent = i;
    pageBtn.style.padding = '8px 15px';
    pageBtn.style.borderRadius = '8px';
    pageBtn.style.cursor = 'pointer';
    
    if (i === currentPage) {
      pageBtn.style.background = 'rgba(78, 161, 255, 0.2)';
      pageBtn.style.border = '1px solid rgba(78, 161, 255, 0.5)';
      pageBtn.style.color = '#4ea1ff';
    } else {
      pageBtn.style.background = 'rgba(255,255,255,0.05)';
      pageBtn.style.border = '1px solid rgba(255,255,255,0.2)';
      pageBtn.style.color = 'white';
    }
    
    pageBtn.addEventListener('click', () => {
      currentPage = i;
      displayDiscussions();
    });
    
    pageNumbers.appendChild(pageBtn);
  }
  
  // Update prev/next buttons
  document.getElementById('prevPageBtn').disabled = currentPage === 1;
  document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
}

function goToPrevPage() {
  if (currentPage > 1) {
    currentPage--;
    displayDiscussions();
  }
}

function goToNextPage() {
  const totalPages = Math.ceil(filteredDiscussions.length / discussionsPerPage);
  if (currentPage < totalPages) {
    currentPage++;
    displayDiscussions();
  }
}

// Helper functions
function getCategoryLabel(category) {
  const labels = {
    arduino: 'Arduino',
    iot: 'IoT',
    pemrograman: 'Pemrograman',
    elektronik: 'Elektronik',
    lainnya: 'Lainnya'
  };
  return labels[category] || labels.lainnya;
}

function getCategoryColor(category) {
  const colors = {
    arduino: '#4ea1ff',
    iot: '#FFC107',
    pemrograman: '#F44336',
    elektronik: '#4CAF50',
    lainnya: '#9C27B0'
  };
  return colors[category] || '#9C27B0';
}

function getCategoryBackground(category) {
  const colors = {
    arduino: 'rgba(78, 161, 255, 0.1)',
    iot: 'rgba(255, 193, 7, 0.1)',
    pemrograman: 'rgba(244, 67, 54, 0.1)',
    elektronik: 'rgba(76, 175, 80, 0.1)',
    lainnya: 'rgba(156, 39, 176, 0.1)'
  };
  return colors[category] || 'rgba(156, 39, 176, 0.1)';
}

function formatTimeAgo(date) {
  const now = new Date();
  const diffInSeconds = Math.floor((now - date) / 1000);
  
  if (diffInSeconds < 60) return 'baru saja';
  if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit yang lalu`;
  if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam yang lalu`;
  if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} hari yang lalu`;
  
  return date.toLocaleDateString('id-ID', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
  });
}

// Initialize forum when page is shown
document.addEventListener('DOMContentLoaded', function() {
  // Check if we're on the forum page
  if (window.location.pathname.includes('/halaman-forum') || 
      (window.history.state && window.history.state.page === 'forum')) {
    initializeForumPage();
  }
  
  // Also initialize when navigating to forum via popstate
  window.addEventListener('popstate', function(event) {
    if (event.state && event.state.page === 'forum') {
      initializeForumPage();
    }
  });
});



// Event listener untuk tombol Diskusi Baru
document.getElementById('newDiscussionBtn').addEventListener('click', function() {
  const user = auth.currentUser;
  if (!user) {
    alert('Silakan login terlebih dahulu untuk membuat diskusi baru');
    return;
  }
  document.getElementById('newDiscussionModal').style.display = 'flex';
});

// Event listener untuk tombol Batal
document.getElementById('cancelDiscussion').addEventListener('click', function() {
  document.getElementById('newDiscussionModal').style.display = 'none';
  document.getElementById('newDiscussionForm').reset();
});

// Event listener untuk submit form
document.getElementById('newDiscussionForm').addEventListener('submit', function(e) {
  e.preventDefault();
  createNewDiscussion();
});





async function createNewDiscussion() {
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login terlebih dahulu untuk membuat diskusi baru');
        return;
    }

    const title = document.getElementById('discussionTitle').value.trim();
    const category = document.getElementById('discussionCategory').value;
    const content = document.getElementById('discussionContent').value.trim();

    if (!title || !category || !content) {
        alert('Semua field harus diisi');
        return;
    }

    const submitBtn = document.getElementById('submitDiscussion');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Membuat...';

    try {
        const newDiscussion = {
            title,
            category,
            content,
            authorId: user.uid,
            authorName: user.displayName || 'Anonymous',
            authorEmail: user.email,
            createdAt: serverTimestamp(),
            views: 0,
            likes: 0,
            replyCount: 0
        };

        const docRef = await addDoc(collection(db, "discussions"), newDiscussion);
        newDiscussion.id = docRef.id;
        newDiscussion.createdAt = new Date();

        // Create notification for followers of this category
        await createNotification(
            'followers-of-' + category, // You'll need to implement getting followers
            'discussion',
            `Diskusi baru dalam ${category}: ${title}`,
            docRef.id,
            `/discussions/${docRef.id}`
        );

        // Update UI
        allDiscussions.unshift(newDiscussion);
        filteredDiscussions.unshift(newDiscussion);
        document.getElementById('newDiscussionForm').reset();
        document.getElementById('newDiscussionModal').style.display = 'none';
        currentPage = 1;
        displayDiscussions();
        
        alert('Diskusi berhasil dibuat!');
    } catch (error) {
        console.error("Error creating discussion:", error);
        alert('Gagal membuat diskusi. Silakan coba lagi nanti.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
}























// Hapus event listener ganda untuk form diskusi
// Pastikan hanya ada satu event listener untuk form
document.getElementById('newDiscussionForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const user = auth.currentUser;
    if (!user) {
        alert('Silakan login terlebih dahulu untuk membuat diskusi baru');
        return;
    }

    const title = document.getElementById('discussionTitle').value.trim();
    const category = document.getElementById('discussionCategory').value;
    const content = document.getElementById('discussionContent').value.trim();

    if (!title || !category || !content) {
        alert('Semua field harus diisi');
        return;
    }

    const submitBtn = document.getElementById('submitDiscussion');
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Membuat... <span class="loading-spinner"></span>';

    try {
        const newDiscussion = {
            title,
            category,
            content,
            authorId: user.uid,
            authorName: user.displayName || 'Anonymous',
            authorEmail: user.email,
            createdAt: serverTimestamp(),
            views: 0,
            likes: 0,
            replyCount: 0,
            status: 'active'
        };

        // Tambahkan diskusi ke Firestore
        const docRef = await addDoc(collection(db, "discussions"), newDiscussion);
        
        // Tambahkan ke array lokal untuk tampilan langsung
        newDiscussion.id = docRef.id;
        newDiscussion.createdAt = new Date();
        allDiscussions.unshift(newDiscussion);
        filteredDiscussions.unshift(newDiscussion);

        // Reset form dan tutup modal
        document.getElementById('newDiscussionForm').reset();
        document.getElementById('newDiscussionModal').style.display = 'none';

        // Tampilkan notifikasi sukses
        alert('Diskusi berhasil dibuat!');
        
        // Perbarui tampilan diskusi
        currentPage = 1;
        displayDiscussions();

    } catch (error) {
        console.error("Error creating discussion:", error);
        alert('Gagal membuat diskusi. Silakan coba lagi nanti.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
    }
});










	 
	 
	  
	  
	  
        // Blog search and pagination
        if (document.getElementById('searchBtn')) {
            document.getElementById('searchBtn').addEventListener('click', searchBlogs);
        }

        if (document.getElementById('blogSearch')) {
            document.getElementById('blogSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    searchBlogs();
                }
            });
        }

        // Initialize blog pagination
        function initializeBlogPagination() {
            const blogItems = document.querySelectorAll('.blog-item');
            if (blogItems.length === 0) return;
            
            let currentPage = 1;
            const blogsPerPage = 6;
            const totalBlogs = blogItems.length;
            const totalPages = Math.ceil(totalBlogs / blogsPerPage);

            function showPage(page) {
                currentPage = page;
                const startIndex = (page - 1) * blogsPerPage;
                const endIndex = startIndex + blogsPerPage;
                
                blogItems.forEach((item, index) => {
                    if (index >= startIndex && index < endIndex) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // Update active button
                document.querySelectorAll('.page-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (parseInt(btn.getAttribute('data-page')) === page) {
                        btn.classList.add('active');
                    }
                });
                
                // Update pagination text
                const blogCountDisplay = document.getElementById('blogCountDisplay');
                if (blogCountDisplay) {
                    blogCountDisplay.textContent = 
                        `Menampilkan ${Math.min(endIndex, totalBlogs)} dari ${totalBlogs} Blog (Halaman ${page} dari ${totalPages})`;
                }
            }

            // Set up pagination controls
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showPage(parseInt(this.getAttribute('data-page')));
                });
            });

            if (document.getElementById('prevPage')) {
                document.getElementById('prevPage').addEventListener('click', function() {
                    if (currentPage > 1) {
                        showPage(currentPage - 1);
                    }
                });
            }

            if (document.getElementById('nextPage')) {
                document.getElementById('nextPage').addEventListener('click', function() {
                    if (currentPage < totalPages) {
                        showPage(currentPage + 1);
                    }
                });
            }

            // Show first page initially
            showPage(1);
            updateBlogCount();
        }
		
		
		
		
		
		
		
		
		
   // Add this to your event listeners setup
document.addEventListener('click', async (e) => {
    // Handle clicks on announcement titles
    const announcementTitle = e.target.closest('.announcement-title');
    if (announcementTitle) {
        e.preventDefault();
        const announcementId = announcementTitle.getAttribute('data-id');
        if (announcementId) {
            history.pushState({ page: "detail-pengumuman" }, "", `/halaman-masukan-${announcementId}`);
            await showAnnouncementDetailById(announcementId);
        }
    }
    
    // Handle clicks on "View Details" buttons
    const viewDetailsBtn = e.target.closest('.view-details-btn, .view-announcement-btn');
    if (viewDetailsBtn) {
        e.preventDefault();
        const feedbackItem = viewDetailsBtn.closest('.feedback-item, .pinned-item');
        if (feedbackItem) {
            const announcementId = feedbackItem.getAttribute('data-id');
            if (announcementId) {
                history.pushState({ page: "detail-pengumuman" }, "", `/halaman-masukan-${announcementId}`);
                await showAnnouncementDetailById(announcementId);
            }
        }
    }
});
   
   
   
   async function findAnnouncementById(id) {
    try {
        const docRef = doc(db, "announcements", id);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            return { id: docSnap.id, ...docSnap.data() };
        }

        return null;
    } catch (error) {
        console.error("Error finding announcement by ID:", error);
        return null;
    }
}
   





window.onload = async function () {
    // Biarkan handlePageLoad menangani semua routing, termasuk detail pengumuman
	    console.log("DEBUG: window.onload dipanggil.");
    await handlePageLoad();
    initializeBlogPagination();
};


// Fungsi untuk menangani perubahan URL (back/forward browser)
window.addEventListener("popstate", function(event) {
    handlePageLoad(false); // false berarti bukan initial load
});

// Variabel untuk menyimpan state saat ini
let currentState = {
    page: "home",
    announcementId: null
};






async function handlePageLoad(isInitialLoad = true) {
  const path = window.location.pathname || "/";
  console.log('[Debug] Handling page load for path:', path);

  try {
    // Handle announcement detail from URL
    if (path.includes('halaman-masukan-')) {
      const id = path.split('halaman-masukan-')[1];
      if (id) {
        console.log('[Debug] Showing announcement detail for ID:', id);
        await showAnnouncementDetailById(id);
        return;
      }
    }

    // Handle other pages
    const pageMap = {
      "halaman-arduino": "page2",
      "halaman-iot": "page3",
      "halaman-blog": "page4",
      "halaman-kumpulan-blog": "page5",
      "halaman-tentang-kami": "page6",
      "halaman-masukan": "page7",
      "halaman-forum": "page8",
      "halaman-detail-pengumuman": "page9",
	  "halaman-sejarah": "page10" 
    };

    let pageToShow = "page1"; // default
    for (const [pathPart, pageId] of Object.entries(pageMap)) {
      if (path.includes(pathPart)) {
        pageToShow = pageId;
        break;
      }
    }

    const pageElement = document.getElementById(pageToShow);
    if (pageElement) {
      showPageContent(pageElement);
      
      // Load data khusus untuk halaman tertentu
      if (pageToShow === "page7") {
        await loadFeedback().catch(console.error);
      }
    } else {
      console.error(`Halaman ${pageToShow} tidak ditemukan`);
      showPageContent(document.getElementById("page1"));
    }

  } catch (error) {
    console.error('[Error] handlePageLoad failed:', error);
    showPageContent(document.getElementById("page1"));
  }
}




function handleInitialNavigation() {
  const hash = window.location.hash;
  const path = window.location.pathname;
  const urlParams = new URLSearchParams(window.location.search);
  const announcementId = urlParams.get("id");

  if (announcementId && path.includes("halaman-masukan-halo")) {
    // Jika URL mengandung ?id= dan sedang di halaman masukan
    showAnnouncementDetail(announcementId);
  } else if (path.includes("halaman-masukan-halo")) {
    // Jika hanya buka halaman masukan tanpa ?id
    showPageContent(document.getElementById("page7"));
  } else if (hash) {
    // Navigasi via hash seperti #page3
    showPageByHash(hash);
  } else {
    // Default: tampilkan halaman utama
    showPageContent(document.getElementById("page1"));
  }
}





// Setup event listeners for announcements
function setupAnnouncementEventListeners() {
    // Back button handlers
    document.getElementById('backToAnnouncements')?.addEventListener('click', backToFeedbackPage);
    document.getElementById('backToFeedbackPage')?.addEventListener('click', backToFeedbackPage);

    // Delegated click listener for dynamic announcement items
    document.addEventListener("click", async function (e) {
        const announcementItem = e.target.closest(".announcement-title, .pinned-item, .view-announcement-btn");

        if (announcementItem) {
            e.preventDefault();
            const id = announcementItem.getAttribute("data-id");

            if (id) {
                history.pushState({ page: "detail-pengumuman", id }, "", `/halaman-masukan-${id}`);
                showPageContent(document.getElementById("page9")); // pastikan ditampilkan
                await showAnnouncementDetailById(id);
            }
        }
    });
}





document.addEventListener("DOMContentLoaded", () => {
  const backToMasukan = document.getElementById("backToFeedbackPage");
  const backToPengumuman = document.getElementById("backToAnnouncements");

  if (backToMasukan) {
    backToMasukan.addEventListener("click", () => {
      history.pushState({ page: "masukan" }, "Masukan", "/halaman-masukan");
      handlePageLoad(false);
    });
  }

  if (backToPengumuman) {
    backToPengumuman.addEventListener("click", () => {
      history.pushState({ page: "masukan" }, "Masukan", "/halaman-masukan");
      handlePageLoad(false);
    });
  }
});





async function showDetailPengumumanById(id) {
  if (!id) {
    console.error("ID pengumuman tidak valid");
    return;
  }

  const db = getFirestore();

  try {
    const docRef = doc(db, "announcements", id); // Pastikan koleksi ini benar: "announcements"
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      // Jika pengumuman tidak ditemukan
      const container = document.getElementById("announcementDetailContainer");
      container.innerHTML = `
        <h2 style="color: white;">Pengumuman tidak ditemukan</h2>
        <p style="color: #ccc;">ID: ${id}</p>
      `;
      showPage(page9);
      return;
    }

    const data = docSnap.data();

    // Tampilkan konten ke dalam kontainer detail
    const container = document.getElementById("announcementDetailContainer");
    container.innerHTML = `
      <h2 style="color: white; font-size: 28px; margin-bottom: 10px;">${data.title}</h2>
      <p style="color: #ccc; font-size: 14px; margin-bottom: 20px;">Diposting: ${formatTimestamp(data.timestamp)}</p>
      <div style="color: white; font-size: 16px; line-height: 1.6;">${data.content}</div>
    `;

    showPage(page9); // Tampilkan halaman 9

  } catch (err) {
    console.error("Gagal mengambil pengumuman berdasarkan ID:", err);
    alert("Gagal memuat detail pengumuman.");
  }
}





async function renderMasukanDetailById(id) {
    if (!id) {
        showNotification("ID masukan tidak valid.", "error");
        return;
    }

    try {
        const docRef = doc(db, "masukan", id);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
            showNotification("Masukan tidak ditemukan.", "error");
            return;
        }

        const data = docSnap.data();

        // Tampilkan halaman 9
        showPage(page9);

        // Render konten ke elemen yang sesuai
        const titleElement = document.getElementById("masukanDetailTitle");
        const contentElement = document.getElementById("masukanDetailContent");

        if (titleElement) {
            titleElement.textContent = data.title || "(Tanpa Judul)";
        }

        if (contentElement) {
            contentElement.innerHTML = data.content || "<p>Tidak ada konten tersedia.</p>";
        }

        // Update judul halaman
        document.title = `${data.title || "Masukan"} - Life Is What It Is Learn`;

    } catch (error) {
        console.error("Gagal memuat detail masukan:", error);
        showNotification("Gagal memuat detail masukan: " + error.message, "error");
    }
}







// Variabel untuk menyimpan data balasan sementara
let currentAnnouncementReplies = [];





// Fungsi untuk setup form edit pengumuman (show edit icon for all users)
function setupAdminAnnouncementForm(announcementId, announcementData) {
  const adminForm = document.getElementById('adminAnnouncementForm');
  const user = auth.currentUser;
  
  // Show edit icon for all logged in users
  if (user) {
    // Create edit icon
    const editIcon = document.createElement('span');
    editIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-left: 10px; cursor: pointer;" title="Lihat perbandingan">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
    `;
    editIcon.style.cursor = 'pointer';
    editIcon.addEventListener('click', () => showEditComparison(announcementId));
    
    // Find announcement title and insert edit icon
    const announcementTitle = document.querySelector('#announcementDetailContainer h2');
    if (announcementTitle) {
      announcementTitle.appendChild(editIcon);
    }
  }

  // Only show admin form for admin users
  if (isUserAdmin(user)) {
    adminForm.style.display = 'block';
    document.getElementById('editAnnouncementTitle').value = announcementData.title || '';
    document.getElementById('editAnnouncementContent').value = announcementData.content || '';
    
    // Setup event listeners
    document.getElementById('editAnnouncementForm').onsubmit = async (e) => {
      e.preventDefault();
      await updateAnnouncement(announcementId);
    };

    document.getElementById('cancelEditAnnouncement').onclick = () => {
      adminForm.style.display = 'none';
    };

    document.getElementById('deleteAnnouncement').onclick = async () => {
      if (confirm('Apakah Anda yakin ingin menghapus pengumuman ini?')) {
        await deleteAnnouncement(announcementId);
      }
    };
  } else {
    adminForm.style.display = 'none';
  }
}

// Fungsi untuk menampilkan detail pengumuman
async function showAnnouncementDetailById(announcementId) {
  try {
    // Pastikan halaman 9 ada sebelum melanjutkan
    const page9 = document.getElementById("page9");
    if (!page9) {
      console.error('Halaman detail pengumuman tidak ditemukan');
      return;
    }

    // Sembunyikan semua halaman lain dan tampilkan halaman 9
    const pages = ["page1", "page2", "page3", "page4", "page5", "page6", "page7", "page8"];
    pages.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    });
    page9.style.display = "block";

    const container = document.getElementById('announcementDetailContainer');
    if (!container) {
      console.error('Container detail tidak ditemukan');
      return;
    }

    // Tampilkan loading state
    container.innerHTML = '<div style="color:#ccc; text-align:center; padding:30px;">Memuat pengumuman...</div>';

    // Muat data pengumuman dan balasan secara paralel
    const [announcementSnap, repliesSnap] = await Promise.all([
      getDoc(doc(db, "announcements", announcementId)),
      getDocs(collection(db, "announcements", announcementId, "replies"))
    ]);

    if (!announcementSnap.exists()) {
      throw new Error("Pengumuman tidak ditemukan");
    }

    const announcement = announcementSnap.data();
    const waktu = announcement.timestamp?.toDate ? announcement.timestamp.toDate() : new Date();

    // Simpan balasan ke variabel sementara
    currentAnnouncementReplies = repliesSnap.docs.map(doc => ({
      id: doc.id,
      ...doc.data(),
      timestamp: doc.data().timestamp?.toDate ? doc.data().timestamp.toDate() : new Date()
    }));

    // Render konten pengumuman
    container.innerHTML = `
     <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
          <h2 style="color: #ff6b6b; font-size: 28px; margin: 0; line-height: 1.3;">
            ${announcement.title || 'Tanpa Judul'}
            ${announcement.lastUpdated ? '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#4ea1ff" stroke="#4ea1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-left: 8px;" title="Telah diedit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>' : ''}
          </h2>
          <div style="color: #aaa; font-size: 14px; white-space: nowrap;">${formatTimeAgo(waktu)}</div>
        </div>
        
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
          <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: white;">
            ${announcement.userName?.charAt(0).toUpperCase() || 'A'}
          </div>
          <div>
            <div style="color: white; font-weight: 500;">${announcement.userName || 'Admin'}</div>
            <div style="color: #aaa; font-size: 12px;">${announcement.userEmail || ''}</div>
          </div>
        </div>
        
        <div style="color: #ddd; font-size: 16px; line-height: 1.6; white-space: pre-line; margin-bottom: 20px;">
          ${announcement.content || 'Tidak ada konten'}
        </div>
        
        <div style="display: flex; gap: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
          <button class="like-btn" style="display: flex; align-items: center; background: none; border: none; color: #ccc; cursor: pointer;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
            </svg>
            <span class="like-count" style="margin-left: 5px;">${announcement.likesCount || 0}</span>
          </button>
          
          <div style="display: flex; align-items: center; color: #ccc;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <span class="view-count" style="margin-left: 5px;">${announcement.views || 0}</span>
          </div>
        </div>
      </div>
    `;

    // Setup admin controls and edit icon for all users
    setupAdminAnnouncementForm(announcementSnap.id, announcement);
	
	  // Muat history edit
    await loadEditHistory(announcementId);
    
    // Render balasan yang sudah disimpan
    renderAnnouncementReplies(currentAnnouncementReplies);

    // Muat pengumuman terkait
    await loadRelatedAnnouncements(announcementId);

    // Setup form balasan
    setupReplyForm(announcementId);

  } catch (error) {
    console.error("Error loading announcement:", error);
    const container = document.getElementById('announcementDetailContainer');
    if (container) {
      container.innerHTML = `
        <div style="color:#ff6b6b; text-align:center; padding:30px;">
          <h3 style="margin-bottom: 15px;">Gagal Memuat Pengumuman</h3>
          <p style="margin-bottom: 20px;">${error.message}</p>
          <button onclick="backToFeedbackPage()" style="padding: 8px 16px; background: none; border: 1px solid #ff6b6b; color: #ff6b6b; cursor: pointer;">
            Kembali ke Daftar Pengumuman
          </button>
        </div>
      `;
    }
  }
}



























async function loadAnnouncementDetailById(id) {
    if (!id) {
        throw new Error("ID pengumuman tidak valid");
    }

    try {
        const docRef = doc(db, "announcements", id);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
            throw new Error("Pengumuman tidak ditemukan");
        }

        const data = docSnap.data();
        const waktu = data.timestamp?.toDate ? data.timestamp.toDate() : new Date();

        // Kembalikan data lengkap pengumuman
        return {
            id: doc.id,
            ...data,
            formattedDate: formatTimeAgo(waktu)
        };

    } catch (error) {
        console.error("Error loading announcement:", error);
        throw error;
    }
}





// Fungsi untuk kembali ke halaman masukan
function backToFeedbackPage() {
  const page7 = document.getElementById("page7");
  if (page7) {
    // Sembunyikan semua halaman lain
    const pages = ["page1", "page2", "page3", "page4", "page5", "page6", "page8", "page9, page10"];
    pages.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    });
    
    // Tampilkan halaman 7
    page7.style.display = "block";
    
    // Muat ulang data jika diperlukan
    loadPinnedAnnouncements();
    loadFeedback().catch(console.error);
  }
  
  history.pushState({ page: "masukan" }, "Halaman Masukan", "/halaman-masukan");
  document.title = "Masukan - Life Is What It Is Learn";
}








// Improved formatTimeAgo function
function formatTimeAgo(timestamp) {
    if (!timestamp) return 'baru saja';
    
    const now = new Date();
    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    if (diffInSeconds < 60) return 'baru saja';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} menit yang lalu`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} jam yang lalu`;
    if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} hari yang lalu`;
    
    return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
}








// Event listener untuk tombol kembali
document.getElementById('backToAnnouncements')?.addEventListener('click', backToFeedbackPage);

// Event listener untuk klik pada item pengumuman
document.addEventListener('click', (e) => {
  if (e.target.closest('.view-details-btn, .announcement-title, .pinned-item')) {
    e.preventDefault();
    const item = e.target.closest('[data-id]');
    if (item) {
      const announcementId = item.getAttribute('data-id');
      if (announcementId) {
        showAnnouncementDetailById(announcementId);
      }
    }
  }
});













window.addEventListener('popstate', async function(event) {
    console.log('[Debug] popstate event triggered', event.state);

    try {
        const path = window.location.pathname || "/";
        
        // Cek apakah URL mengandung detail pengumuman berbasis path (tanpa state)
        if (!event.state && path.includes('halaman-masukan-')) {
            const id = path.split('halaman-masukan-')[1];
            console.log('[Debug] Found announcement ID in URL:', id);
            if (id) {
                showPageContent(document.getElementById("page9"));
                await showAnnouncementDetailById(id);
                return;
            }
        }

        if (event.state) {
            const currentState = event.state;
            console.log('[Debug] Current state:', currentState);

            switch (currentState.page) {
                case "detail-pengumuman":
                    const idFromState = currentState.announcementId || currentState.id;
                    console.log('[Debug] Showing announcement detail for ID:', idFromState);
                    if (idFromState) {
                        showPageContent(document.getElementById("page9"));
                        await showAnnouncementDetailById(idFromState);
                    }
                    break;

                case "arduino":
                    showPageContent(document.getElementById("page2"));
                    break;

                case "iot":
                    showPageContent(document.getElementById("page3"));
                    break;

                case "blog":
                    showPageContent(document.getElementById("page4"));
                    break;

                case "kumpulan-blog":
                    showPageContent(document.getElementById("page5"));
                    break;

                case "tentang-kami":
                    showPageContent(document.getElementById("page6"));
                    break;

                case "masukan":
                    showPageContent(document.getElementById("page7"));
                    await loadFeedback().catch(console.error);
                    break;

                case "forum":
                    showPageContent(document.getElementById("page8"));
                    break;
					
				case "sejarah":
                showPageContent(document.getElementById("page10"));
                break;	

                default:
                    showPageContent(document.getElementById("page1"));
            }
        } else {
            // Jika tidak ada state dan tidak mengandung halaman detail
            await handlePageLoad(false);
        }

    } catch (error) {
        console.error('[Error] popstate handler failed:', error);
        showPageContent(document.getElementById("page1"));
    }
});



async function getRepliersInfo(announcementId) {
  const q = query(
    collection(db, "announcements", announcementId, "replies"),
    orderBy("timestamp", "desc"),
    limit(5)
  );
  const snapshot = await getDocs(q);
  const usersMap = new Map();

  snapshot.forEach(doc => {
    const { userName, userPhoto, userEmail } = doc.data();
    if (!usersMap.has(userEmail)) {
      usersMap.set(userEmail, { userName, userPhoto });
    }
  });

  return Array.from(usersMap.values());
}





function renderAnnouncementDetail(data) {
  const container = document.getElementById("page9");
  container.innerHTML = `
    <div class="line-box">
      <div style="max-width: 800px;">
        <h1 style="color: white;">${data.title}</h1>
        <p style="color: #ccc; line-height: 1.6;">${data.content}</p>
      </div>
    </div>
  `;
}



async function loadAnnouncementById(id) {
    if (!id) {
        console.error("ID pengumuman tidak valid");
        return;
    }

    try {
        const docRef = doc(db, "announcements", id);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
            // Tampilkan pesan pengumuman tidak ditemukan
            const container = document.getElementById("page9");
            if (container) {
                container.innerHTML = "<h2 style='color:white'>Pengumuman tidak ditemukan.</h2>";
            }
            return;
        }

        // Ambil data dan tampilkan
        const data = docSnap.data();
        renderAnnouncementDetail({ ...data, id: docSnap.id });

    } catch (error) {
        console.error("Gagal memuat pengumuman:", error);
        const container = document.getElementById("page9");
        if (container) {
            container.innerHTML = "<h2 style='color:white'>Gagal memuat pengumuman.</h2>";
        }
    }
}
}
   
  
</script>
</body>
</html>







